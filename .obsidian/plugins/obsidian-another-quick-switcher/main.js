/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var Ss=Object.create;var ve=Object.defineProperty;var xs=Object.getOwnPropertyDescriptor;var Cs=Object.getOwnPropertyNames;var _s=Object.getPrototypeOf,Is=Object.prototype.hasOwnProperty;var Fs=(n,i)=>()=>(i||n((i={exports:{}}).exports,i),i.exports),As=(n,i)=>{for(var e in i)ve(n,e,{get:i[e],enumerable:!0})},Et=(n,i,e,t)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of Cs(i))!Is.call(n,s)&&s!==e&&ve(n,s,{get:()=>i[s],enumerable:!(t=xs(i,s))||t.enumerable});return n};var St=(n,i,e)=>(e=n!=null?Ss(_s(n)):{},Et(i||!n||!n.__esModule?ve(e,"default",{value:n,enumerable:!0}):e,n)),Ts=n=>Et(ve({},"__esModule",{value:!0}),n);var Ye=Fs($=>{"use strict";var Xe=$&&$.__assign||function(){return Xe=Object.assign||function(n){for(var i,e=1,t=arguments.length;e<t;e++){i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])}return n},Xe.apply(this,arguments)},Ps=$&&$.__read||function(n,i){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var t=e.call(n),s,r=[],a;try{for(;(i===void 0||i-- >0)&&!(s=t.next()).done;)r.push(s.value)}catch(l){a={error:l}}finally{try{s&&!s.done&&(e=t.return)&&e.call(t)}finally{if(a)throw a.error}}return r},Ds=$&&$.__spreadArray||function(n,i,e){if(e||arguments.length===2)for(var t=0,s=i.length,r;t<s;t++)(r||!(t in i))&&(r||(r=Array.prototype.slice.call(i,0,t)),r[t]=i[t]);return n.concat(r||Array.prototype.slice.call(i))};Object.defineProperty($,"__esModule",{value:!0});var xt=function(n){if(typeof n=="object"&&n!==null){if(typeof Object.getPrototypeOf=="function"){var i=Object.getPrototypeOf(n);return i===Object.prototype||i===null}return Object.prototype.toString.call(n)==="[object Object]"}return!1},X=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return n.reduce(function(e,t){if(Array.isArray(t))throw new TypeError("Arguments provided to ts-deepmerge must be objects, not arrays.");return Object.keys(t).forEach(function(s){["__proto__","constructor","prototype"].includes(s)||(Array.isArray(e[s])&&Array.isArray(t[s])?e[s]=X.options.mergeArrays?Array.from(new Set(e[s].concat(t[s]))):t[s]:xt(e[s])&&xt(t[s])?e[s]=X(e[s],t[s]):e[s]=t[s])}),e},{})},Ct={mergeArrays:!0};X.options=Ct;X.withOptions=function(n){for(var i=[],e=1;e<arguments.length;e++)i[e-1]=arguments[e];X.options=Xe({mergeArrays:!0},n);var t=X.apply(void 0,Ds([],Ps(i),!1));return X.options=Ct,t};$.default=X});var Mi={};As(Mi,{default:()=>Je});module.exports=Ts(Mi);var Es=require("obsidian"),bt=St(Ye());var F=require("obsidian"),Nt=St(Ye());var j=class extends Error{constructor(i,e=`Unsupported type: ${i}`){super(e)}};function Ze(n,i,e){let t=new RegExp(i),s=a=>t?!!a.match(t):!1,r=a=>t?a.replace(t,e):a;return s(n)?r(n):n}var et=n=>[...Array(n).keys()],tt=(n,i)=>Object.fromEntries(Object.entries(n).map(([e,t])=>[e,i(t)])),_t=(n,i)=>Object.fromEntries(Object.entries(n).map(([e,t])=>[i(e),t])),I=(n,i="asc")=>(e,t)=>i==="asc"?n(e)>n(t)?1:n(t)>n(e)?-1:0:n(e)<n(t)?1:n(t)<n(e)?-1:0,st=(n,i)=>{let e={};for(let t of n){let s=i(t);e[s]||(e[s]=[]),e[s].push(t)}return e},It=(n,i)=>{let e={};for(let t of n){let s=i(t);e[s]=t}return e},it=n=>{let i={};for(let e of n)i[e]?i[e]++:i[e]=1;return i};function nt(n){return n.reduce((i,e)=>(i.push(...e),i),[])}function q(n){return[...new Set(n)]}function be(n,i){let e=new Map;for(let t of n){let s=i(t);e.has(s)||e.set(s,t)}return Array.from(e.values())}function Ee(n,i){return q(nt(n.map(i)))}function Ft(n){return n.length===0?[]:n.reduce((i,e)=>i.filter(t=>e.includes(t)))}var oe=(n,i)=>{let e=(t,s)=>i(t)<=i(s)?t:s;return n.reduce(e)};function At(n,i,e){return i.length===0?n:n.filter(t=>i.some(s=>e(t).startsWith(s)))}function Se(n,i,e){return i.length===0?n:n.filter(t=>!i.some(s=>e(t).startsWith(s)))}function Tt(n,i){return[...n].sort().join()===[...i].sort().join()}function Ms(n,i){return n.reduce((e,t)=>{let s=i(t);return e[s]=s,e},{})}function rt(n){return Ms(n,i=>i)}function se(n,i){let e={...n};for(let[t,s]of Object.entries(e))i(t,s)&&delete e[t];return e}var Pt=n=>(i,e)=>n(i)>=n(e)?i:e;function de(n,i){var t,s;let e=(s=(t=n.match(/.+[\\/]([^\\/]+)[\\/]?$/))==null?void 0:t[1])!=null?s:n;return i&&e.endsWith(i)?e.replace(i,""):e}function Dt(n){let i=de(n).split(".").slice(1).pop();return i?`.${i}`:""}function ge(n){var i,e;return(e=(i=n.match(/(.+)[\\/].+$/))==null?void 0:i[1])!=null?e:"."}function V(n){return n.replace(/\\/g,"/").replace(/\/+/g,"/")}function Mt(n,i){let e=/[\\/]/,t=[];n.split(e).forEach((r,a)=>{if(a===0&&r==="."){t=i.split("/");return}if(r===".."){a===0&&(t=i.split("/")),t=ge(t.join("/")).split("/").filter(l=>l!==".");return}t=[...t,r]});let s=t.filter(r=>r!=="").join("/");return i[0]==="/"?`/${s}`:s}function Y(n){return n?n.path.endsWith(".excalidraw.md")||n.path.endsWith(".excalidraw"):!1}var at=[{base:"A",letters:"A\u24B6\uFF21\xC0\xC1\xC2\u1EA6\u1EA4\u1EAA\u1EA8\xC3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\xC4\u01DE\u1EA2\xC5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F"},{base:"AA",letters:"\uA732"},{base:"AE",letters:"\xC6\u01FC\u01E2"},{base:"AO",letters:"\uA734"},{base:"AU",letters:"\uA736"},{base:"AV",letters:"\uA738\uA73A"},{base:"AY",letters:"\uA73C"},{base:"B",letters:"B\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181"},{base:"C",letters:"C\u24B8\uFF23\u0106\u0108\u010A\u010C\xC7\u1E08\u0187\u023B\uA73E"},{base:"D",letters:"D\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779\xD0"},{base:"DZ",letters:"\u01F1\u01C4"},{base:"Dz",letters:"\u01F2\u01C5"},{base:"E",letters:"E\u24BA\uFF25\xC8\xC9\xCA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\xCB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E"},{base:"F",letters:"F\u24BB\uFF26\u1E1E\u0191\uA77B"},{base:"G",letters:"G\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E"},{base:"H",letters:"H\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D"},{base:"I",letters:"I\u24BE\uFF29\xCC\xCD\xCE\u0128\u012A\u012C\u0130\xCF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197"},{base:"J",letters:"J\u24BF\uFF2A\u0134\u0248"},{base:"K",letters:"K\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2"},{base:"L",letters:"L\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780"},{base:"LJ",letters:"\u01C7"},{base:"Lj",letters:"\u01C8"},{base:"M",letters:"M\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C"},{base:"N",letters:"N\u24C3\uFF2E\u01F8\u0143\xD1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4"},{base:"NJ",letters:"\u01CA"},{base:"Nj",letters:"\u01CB"},{base:"O",letters:"O\u24C4\uFF2F\xD2\xD3\xD4\u1ED2\u1ED0\u1ED6\u1ED4\xD5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\xD6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\xD8\u01FE\u0186\u019F\uA74A\uA74C"},{base:"OI",letters:"\u01A2"},{base:"OO",letters:"\uA74E"},{base:"OU",letters:"\u0222"},{base:"OE",letters:"\x8C\u0152"},{base:"oe",letters:"\x9C\u0153"},{base:"P",letters:"P\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754"},{base:"Q",letters:"Q\u24C6\uFF31\uA756\uA758\u024A"},{base:"R",letters:"R\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782"},{base:"S",letters:"S\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784"},{base:"T",letters:"T\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786"},{base:"TZ",letters:"\uA728"},{base:"U",letters:"U\u24CA\uFF35\xD9\xDA\xDB\u0168\u1E78\u016A\u1E7A\u016C\xDC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244"},{base:"V",letters:"V\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245"},{base:"VY",letters:"\uA760"},{base:"W",letters:"W\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72"},{base:"X",letters:"X\u24CD\uFF38\u1E8A\u1E8C"},{base:"Y",letters:"Y\u24CE\uFF39\u1EF2\xDD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE"},{base:"Z",letters:"Z\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762"},{base:"a",letters:"a\u24D0\uFF41\u1E9A\xE0\xE1\xE2\u1EA7\u1EA5\u1EAB\u1EA9\xE3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\xE4\u01DF\u1EA3\xE5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250"},{base:"aa",letters:"\uA733"},{base:"ae",letters:"\xE6\u01FD\u01E3"},{base:"ao",letters:"\uA735"},{base:"au",letters:"\uA737"},{base:"av",letters:"\uA739\uA73B"},{base:"ay",letters:"\uA73D"},{base:"b",letters:"b\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253"},{base:"c",letters:"c\u24D2\uFF43\u0107\u0109\u010B\u010D\xE7\u1E09\u0188\u023C\uA73F\u2184"},{base:"d",letters:"d\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A"},{base:"dz",letters:"\u01F3\u01C6"},{base:"e",letters:"e\u24D4\uFF45\xE8\xE9\xEA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\xEB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD"},{base:"f",letters:"f\u24D5\uFF46\u1E1F\u0192\uA77C"},{base:"g",letters:"g\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F"},{base:"h",letters:"h\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265"},{base:"hv",letters:"\u0195"},{base:"i",letters:"i\u24D8\uFF49\xEC\xED\xEE\u0129\u012B\u012D\xEF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131"},{base:"j",letters:"j\u24D9\uFF4A\u0135\u01F0\u0249"},{base:"k",letters:"k\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3"},{base:"l",letters:"l\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747"},{base:"lj",letters:"\u01C9"},{base:"m",letters:"m\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F"},{base:"n",letters:"n\u24DD\uFF4E\u01F9\u0144\xF1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5"},{base:"nj",letters:"\u01CC"},{base:"o",letters:"o\u24DE\uFF4F\xF2\xF3\xF4\u1ED3\u1ED1\u1ED7\u1ED5\xF5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\xF6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\xF8\u01FF\u0254\uA74B\uA74D\u0275"},{base:"oi",letters:"\u01A3"},{base:"ou",letters:"\u0223"},{base:"oo",letters:"\uA74F"},{base:"p",letters:"p\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755"},{base:"q",letters:"q\u24E0\uFF51\u024B\uA757\uA759"},{base:"r",letters:"r\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783"},{base:"s",letters:"s\u24E2\uFF53\xDF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B"},{base:"t",letters:"t\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787"},{base:"tz",letters:"\uA729"},{base:"u",letters:"u\u24E4\uFF55\xF9\xFA\xFB\u0169\u1E79\u016B\u1E7B\u016D\xFC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289"},{base:"v",letters:"v\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C"},{base:"vy",letters:"\uA761"},{base:"w",letters:"w\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73"},{base:"x",letters:"x\u24E7\uFF58\u1E8B\u1E8D"},{base:"y",letters:"y\u24E8\uFF59\u1EF3\xFD\u0177\u1EF9\u0233\u1E8F\xFF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF"},{base:"z",letters:"z\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763"},{base:"2",letters:"\xB2"},{base:"3",letters:"\xB3"}],Ht={};for(let n=0;n<at.length;n++){let i=at[n].letters;for(let e=0;e<i.length;e++)Ht[i[e]]=at[n].base}var ot=Ht;var Lt=new RegExp(/[\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF]|[\uFE0E-\uFE0F]/,"g");function ie(n){return n.replace(/ /g,"")}function ne(n){return n.replace(Lt,"")}function lt(n){return n.replace(/[^\u0000-\u007E]/g,i=>{var e;return(e=ot[i])!=null?e:i})}function L(n,i){let e=n.toLowerCase();return i?lt(e):e}function xe(n){return n.replace(/[.*+?^=!:${}()|[\]\/\\]/g,"\\$&")}function Hs(n,i,e){return L(n,e).includes(L(i,e))}function Ls(n,i){var s;let e=n.toLowerCase();return!i||e.charCodeAt(0)<=126?e:(s=ot[e])!=null?s:e}function Rs(n,i,e){let t=new Array(e),s=0;for(let r=0;r<n.length;r++){let a=Ls(n[r],i);for(let l=0;l<a.length;l++)t[s++]=r}return t}function ct(n,i,e){let t=L(n,e),s=L(i,e);if(s.length===0)return{start:0,end:-1};let r=t.indexOf(s);if(r===-1)return null;let a=Rs(n,e,t.length),l=r+s.length-1;return{start:a[r],end:a[l]}}function Rt(n,i,e){return me(i)?e?lt(n).includes(lt(i)):n.includes(i):Hs(n,i,e)}function S(n,i,e){return ie(L(n,e)).includes(ie(L(i,e)))}function Bt(n,i,e){return ie(ne(L(n,e))).startsWith(ie(L(i,e)))}function zt(n,i,e){return ie(ne(L(n,e)))===L(i,e)}function re(n){return n.replace(/\[\[[^\]]+\|(.*?)]]/g,"$1").replace(/\[\[([^\]]+)]]/g,"$1").replace(/\[([^\]]+)]\(https?[^)]+\)/g,"$1").replace(/\[([^\]]+)]/g,"$1").replace(/`([^`]+)`/g,"$1").replace(/~~([^~]+)~~/g,"$1").replace(/==([^=]+)==/g,"$1").replace(/\*\*([^*]+)\*\*/g,"$1").replace(/\*([^*]+)\*/g,"$1").replace(/__([^_]+)__/g,"$1").replace(/_([^_]+)_/g,"$1").replace(/<[^>]+>([^<]+)<\/[^>]+>/g,"$1")}function ut(n){return n.split(",").filter(i=>i)}function Z(n){return n.split(`
`).filter(i=>i)}function W(n){let i=[],e="",t=!1;for(let s=0;s<n.length;s++){let r=n[s],a=n[s+1];switch(r){case"\\":a==='"'?(e+='"',s++):e+=r;break;case'"':t=!t;break;case" ":t?e+=r:(i.push(e),e="");break;default:e+=r}}return i.push(e),i.filter(s=>s)}function R(n){return n.charAt(0).toUpperCase()+n.slice(1)}function me(n){return n.toLowerCase()!==n}function ht(n,i){if(n.startsWith(i))return{type:"starts-with",score:2**i.length/n.length,ranges:[{start:0,end:i.length-1}]};let e=ne(n);if(e.startsWith(i))return{type:"starts-with",score:2**i.length/n.length,ranges:[{start:0,end:i.length-1}]};let t=n.indexOf(i);if(t!==-1)return{type:"includes",score:2**i.length/n.length,ranges:[{start:t,end:t+i.length-1}]};let s=0,r=0,a=0,l=[],c=-1;for(let o=0;o<e.length;o++)if(e[o]===i[s]?(a===0&&(c=o),a++,s++):a>0&&(r+=2**a,l.push({start:c,end:c+a-1}),a=0),s===i.length)return a>0&&(r+=2**a,l.push({start:c,end:c+a-1})),{type:"fuzzy",score:r/n.length,ranges:l};return{type:"none",score:0}}function le(n,i,e){let t=L(n,e),s=ie(t),r=ne(s),a=ie(L(i,e)),l=ne(a);if(l===""&&a!==""){if(s.startsWith(a))return{type:"starts-with",score:.25,ranges:[{start:0,end:Array.from(a).length}]};if(s.includes(a)){let m=s.indexOf(a),p=Array.from(a).length;return{type:"includes",score:.5,ranges:[{start:m,end:m+p}]}}return{type:"none",score:0}}let c=ht(r,l);if(!c.ranges)return c;if(a!==l&&s.startsWith(a)){let m=Array.from(a).length;return{type:"starts-with",score:c.score*2,ranges:[{start:0,end:m}]}}let o=[],u=[],h=0;s.replace(Lt,(m,p)=>{let g=p,y=p+m.length;for(let v=h;v<g;v++)u[u.length]=v;return h=y,""});for(let m=h;m<s.length;m++)u[u.length]=m;let d=[];for(let m=0,p=0;m<t.length;m++)t[m]!==" "&&(d[p]=m,p++);for(let m of c.ranges){let p=u[m.start],g;if(m.start===m.end?g=p:g=u[m.end-1],p===void 0||g===void 0)continue;let y=d[p],v;if(m.start===m.end?v=y:v=d[g]+1,y===void 0||v===void 0)continue;let b=y;for(let k=y;k<=v;k++)if(t[k]===" "){for(k>b&&o.push({start:b,end:k-1});k<=v&&t[k]===" ";)k++;b=k,k--}b<=v&&o.push({start:b,end:v})}return{...c,ranges:o}}function N(n,i){return n.length>i*2?`${n.slice(0,i)} ... ${n.slice(n.length-i)}`:n}function Ot(n,i){return Array.from(n.matchAll(i)).map(e=>({text:e[0],range:{start:e.index,end:e.index+e[0].length-1}}))}function pt(n){try{return new RegExp(n),!0}catch(i){return!1}}function ee(n){return n.position==null}var x=class{constructor(i){this.unsafeApp=i}getActiveFile(){return this.unsafeApp.workspace.getActiveFile()}getViewInActiveLeaf(){return this.unsafeApp.workspace.getActiveViewOfType(F.View)}getFileViewInActiveLeaf(){return this.unsafeApp.workspace.getActiveViewOfType(F.FileView)}getActiveFileLeaf(){var i,e;return(e=(i=this.getFileViewInActiveLeaf())==null?void 0:i.leaf)!=null?e:null}getMarkdownViewInActiveLeaf(){return this.unsafeApp.workspace.getActiveViewOfType(F.MarkdownView)}getCanvasViewInActiveLeaf(){return this.getViewInActiveLeaf()}getCurrentEditor(){var i,e;return(e=(i=this.getMarkdownViewInActiveLeaf())==null?void 0:i.editor)!=null?e:null}getCurrentDirPath(){var i,e,t;return(t=(e=(i=this.getActiveFile())==null?void 0:i.parent)==null?void 0:e.path)!=null?t:""}getCurrentOffset(){var t;let i=this.getCurrentEditor();if(!i)return null;let e=(t=this.getCurrentEditor())==null?void 0:t.getCursor();return e?i.posToOffset(e):null}getHeadersInActiveFile(){var e,t;let i=this.getActiveFile();return i?(t=(e=this.unsafeApp.metadataCache.getFileCache(i))==null?void 0:e.headings)!=null?t:[]:[]}getFolders(){return this.unsafeApp.vault.getAllLoadedFiles().filter(i=>i instanceof F.TFolder)}getLayout(){return this.unsafeApp.workspace.getLayout()}getLeftSideBarWidth(){return this.getLayout().left.collapsed?0:this.getLayout().left.width}getRightSideBarWidth(){return this.getLayout().right.collapsed?0:this.getLayout().right.width}async findExternalLinkUrls(i){let e=await this.unsafeApp.vault.read(i);return Array.from(e.matchAll(/https?:\/\/[^ \n)]+/g)).map(s=>s[0])}findFirstLinkOffset(i,e){var c,o,u;let t=this.unsafeApp.metadataCache.getFileCache(i),s=(c=t==null?void 0:t.links)!=null?c:[],r=(o=t==null?void 0:t.frontmatterLinks)!=null?o:[],a=(u=t==null?void 0:t.embeds)!=null?u:[],l=[...s,...r,...a].find(h=>{var m;return(this.isPhantomFile(e)?this.getPathToBeCreated(h.link):(m=this.unsafeApp.metadataCache.getFirstLinkpathDest((0,F.getLinkpath)(h.link),i.path))==null?void 0:m.path)===e.path});return!l||ee(l)?0:l.position.start.offset}findFirstHeaderOffset(i,e){var r,a;let t=this.unsafeApp.metadataCache.getFileCache(i);if(!t)return null;let s=(r=t.headings)==null?void 0:r.find(l=>re(l.heading)===re(e));return(a=s==null?void 0:s.position.start.offset)!=null?a:null}getBacklinksByFilePathInActiveFile(){let i=this.getActiveFile();return i?Object.fromEntries(this.unsafeApp.metadataCache.getBacklinksForFile(i).data):null}createBacklinksMap(){let i={},e=tt(this.unsafeApp.metadataCache.unresolvedLinks,t=>_t(t,s=>this.getPathToBeCreated(s)));for(let[t,s]of Object.entries((0,Nt.default)(this.unsafeApp.metadataCache.resolvedLinks,e)))for(let r of Object.keys(s))i[r]||(i[r]=new Set),i[r].add(t);return i}createLinksMap(i){var t,s,r;let e=this.unsafeApp.metadataCache.getFileCache(i);return tt(st([...(t=e==null?void 0:e.embeds)!=null?t:[],...(s=e==null?void 0:e.links)!=null?s:[],...(r=e==null?void 0:e.frontmatterLinks)!=null?r:[]],a=>{var l;return(l=this.linkText2Path(a.link))!=null?l:this.getPathToBeCreated(a.link)}),a=>a[0])}getLinksByFilePathInActiveFile(){var t,s,r;let i=this.getActiveFile();if(!i)return null;let e=this.unsafeApp.metadataCache.getFileCache(i);return st([...(t=e==null?void 0:e.embeds)!=null?t:[],...(s=e==null?void 0:e.links)!=null?s:[],...(r=e==null?void 0:e.frontmatterLinks)!=null?r:[]],a=>{var l;return(l=this.linkText2Path(a.link))!=null?l:this.getPathToBeCreated(a.link)})}async moveTo(i,e,t){var u;let s=typeof i=="number",r=this.getActiveFile(),a=this.unsafeApp.workspace.activeLeaf;if(!r||!a||!((u=this.getMarkdownViewInActiveLeaf())==null?void 0:u.currentMode))return;let c=e!=null?e:this.getCurrentEditor();if(!c)return;let o=s?c.offsetToPos(i).line:i.start.line;t&&this.addToJumpList(c,t,{line:o,ch:0}),c.setCursor(c.offsetToPos(s?i:i.start.offset)),await a.openFile(r,{eState:{line:o},active:!1})}getFileByPath(i){let e=this.unsafeApp.vault.getAbstractFileByPath(i);return e||null}getFilePathsInActiveWindow(){return this.unsafeApp.workspace.getLeavesOfType("markdown").filter(i=>{var e;return i.getContainer()===((e=this.unsafeApp.workspace.activeLeaf)==null?void 0:e.getContainer())}).map(i=>i.getViewState().state.file)}captureState(i){let e=this.unsafeApp.workspace.getLeaf(),t=this.unsafeApp.workspace.getLeaf(),s=t.getViewState(),r=t.getEphemeralState(),a=this.unsafeApp;return{leaf:t,async restore(){t&&(!i||i.getViewState().pinned?t.detach():(await t.setViewState({...s,active:t===e,popstate:!0},r),t!==e&&a.workspace.setActiveLeaf(e,{focus:!0})),this.leaf=void 0)}}}captureStateInFile(i){let e=this.unsafeApp.workspace.getMostRecentLeaf(),t=e.getViewState(),s=e.getEphemeralState(),r=this.unsafeApp;return{async restore(){await e.setViewState({...t,active:!0,popstate:!0},s),r.workspace.setActiveLeaf(e,{focus:!0}),this.leaf=void 0}}}getOpenState(i,e){let t=this.unsafeApp.viewRegistry.getTypeByExtension(e.extension);return i.view instanceof F.FileView&&i.view.canAcceptExtension(e.extension)&&(t=i.view.getViewType()),{type:t,state:{file:e.path}}}findLeaf(i){return this.unsafeApp.workspace.getLeavesOfType("markdown").find(e=>e.getViewState().state.file===i.path)}async openFile(i,e={},t){var c,o,u;let s={leafType:"same-tab",inplace:!1,...e},r=e!=null&&e.preventDuplicateTabs?this.findLeaf(i):void 0,a,l=!1;switch(s.leafType){case"same-tab":a=(o=(c=e.leafPriorToSameTab)!=null?c:t==null?void 0:t.leaf)!=null?o:this.unsafeApp.workspace.getLeaf();break;case"new-tab":a=r!=null?r:this.unsafeApp.workspace.getLeaf(!0);break;case"new-tab-background":a=r!=null?r:this.unsafeApp.workspace.getLeaf(!0),l=!0;break;case"new-pane-horizontal":a=this.unsafeApp.workspace.getLeaf("split","horizontal");break;case"new-pane-vertical":a=this.unsafeApp.workspace.getLeaf("split","vertical");break;case"new-window":a=this.unsafeApp.workspace.openPopoutLeaf();break;case"popup":{let h=this.unsafeApp.plugins.plugins["obsidian-hover-editor"];a=(u=h==null?void 0:h.spawnPopover())!=null?u:this.unsafeApp.workspace.getLeaf(!0);break}default:throw new j(s.leafType)}if(s.inplace&&s.leafType==="same-tab"?await a.setViewState({...a.getViewState(),active:!1,popstate:!0,...this.getOpenState(a,i)}):await a.openFile(i,{...a.getViewState(),active:!l}),a.view instanceof F.MarkdownView){let h=a.view;if(s.offset!=null)this.moveTo(s.offset,h.editor);else if(s.line!=null){let d={line:s.line,offset:0,col:0};this.moveTo({start:d,end:d},h.editor)}}}openFileInDefaultApp(i){this.unsafeApp.openWithDefaultApp(i.path)}openFolderInDefaultApp(i){this.unsafeApp.openWithDefaultApp(i.path)}openInSystemExplorer(i){this.unsafeApp.showInFolder(i.path)}closeFile(i){let e=this.unsafeApp.workspace.getLeavesOfType("markdown").filter(t=>{var s;return((s=t.getViewState().state)==null?void 0:s.file)===i.path});for(let t of e)t.detach()}getStarredFilePaths(){return this.unsafeApp.internalPlugins.plugins.bookmarks.instance.getBookmarks().map(i=>i.type==="file"?i.path:void 0).filter(i=>i!==void 0)}searchPhantomFiles(){return q(nt(Object.values(this.unsafeApp.metadataCache.unresolvedLinks).map(Object.keys))).map(i=>this.createPhantomFile(i))}insertStringToActiveFile(i){let e=this.unsafeApp.workspace.getActiveViewOfType(F.MarkdownView);if(!e)return;e.editor.replaceSelection(i)}insertLinkToActiveFileBy(i,e){var c;let t=this.unsafeApp.workspace.getActiveViewOfType(F.MarkdownView);if(!(t!=null&&t.file))return;let s=this.unsafeApp.fileManager.generateMarkdownLink(i,t.file.path),r=e==null?void 0:e.displayedString,a=e==null?void 0:e.aliasTranformer;if(this.unsafeApp.vault.config.useMarkdownLinks){let{text:o,link:u}=Array.from(s.matchAll(/\[(?<text>[^\]]+)]\((?<link>.+)\)/g))[0].groups,h=r!=null?r:o;a&&(h=Ze(h,a.pattern,a.format)),s=`[${h}](${u})`}else{let o=(c=Array.from(s.matchAll(/\[\[(?<text>[^\]]+)]]/g))[0].groups)==null?void 0:c.text,u=r!=null?r:o;a&&(u=Ze(u,a.pattern,a.format)),s=o===u?`[[${o}]]`:`[[${o}|${u}]]`,e!=null&&e.phantom&&(s=`[[${s.replace("[[","").replace("]]","").split("|").map(d=>d.replace(/.*\/([^\]]+)/,"$1")).unique().join("|")}]]`)}t.editor.replaceSelection(s.endsWith(".excalidraw]]")?`!${s}`:s.endsWith(".pdf]]")?s.replace("!",""):s)}async createMarkdown(i){let e=this.getPathToBeCreated(i);if(await this.exists(e))return null;let t=ge(e);return await this.exists(t)||await this.unsafeApp.vault.createFolder(t),this.unsafeApp.vault.create(e,"")}exists(i){return this.unsafeApp.vault.adapter.exists(i)}isPopWindow(){return!fish(".modal-bg")}removeCommand(i){this.unsafeApp.commands.removeCommand(i)}getCommandIds(i){return Object.keys(this.unsafeApp.commands.commands).filter(e=>e.startsWith(i))}getNormalizeVaultRootPath(){return V(this.unsafeApp.vault.adapter.basePath)}getPathToBeCreated(i){var t,s,r;let e=(0,F.getLinkpath)(i);if(Dt(e)!==".md"&&(e+=".md"),e.includes("/"))return e;switch(this.unsafeApp.vault.config.newFileLocation){case"root":return`/${e}`;case"current":return`${(r=(s=(t=this.getActiveFile())==null?void 0:t.parent)==null?void 0:s.path)!=null?r:""}/${e}`;case"folder":return`${this.unsafeApp.vault.config.newFileFolderPath}/${e}`;default:return`/${e}`}}linkText2Path(i){var t,s;let e=this.getActiveFile();return e&&(s=(t=this.unsafeApp.metadataCache.getFirstLinkpathDest(i,e.path))==null?void 0:t.path)!=null?s:null}isPhantomFile(i){return i.stat.ctime===0}isActiveLeafCanvas(){var i;return((i=this.getViewInActiveLeaf())==null?void 0:i.getViewType())==="canvas"}isCacheInitialized(){return this.unsafeApp.metadataCache.initialized}addFileToCanvas(i,e={x:0,y:0}){let t=this.getCanvasViewInActiveLeaf(),{x:s,y:r}=t.canvas.posCenter();return t.canvas.createFileNode({file:i,pos:{x:s+e.x,y:r+e.y}})}enableFileExplorer(){return this.unsafeApp.internalPlugins.getEnabledPluginById("file-explorer")}revealInFolder(i){this.unsafeApp.internalPlugins.plugins["file-explorer"].instance.revealInFolder(i)}createPhantomFile(i){let e=this.getPathToBeCreated(i);return{path:e,name:de(e),vault:this.unsafeApp.vault,extension:"md",basename:de(e,".md"),parent:{name:de(ge(e)),path:ge(e),vault:this.unsafeApp.vault,children:[],parent:null,isRoot:()=>!0},stat:{mtime:0,ctime:0,size:0}}}addToJumpList(i,e,t){var a,l,c,o,u;let s=(a=i.cm)==null?void 0:a.cm,r=(u=(o=(c=(l=s==null?void 0:s.constructor)==null?void 0:l.Vim)==null?void 0:c.getVimGlobalState_)==null?void 0:o.call(c))==null?void 0:u.jumpList;r&&r.add(s,e,t)}};var D=require("obsidian");function Kt(){return Object.values(app.commands.commands).filter(n=>!n.checkCallback||n.checkCallback(!0))}function qt(n,i){return n!=null?i(n):null}function Vt(n){return app.vault.adapter.exists(n)}async function Bs(n){return await Vt(n)?app.vault.adapter.read(n):null}async function Ut(n){return qt(await Bs(n),i=>JSON.parse(i))}async function zs(n,i,e){if(!(e!=null&&e.overwrite)&&await Vt(n))throw new Error(`Cannot overwrite because the file already exists: ${n}`);app.vault.adapter.write(n,i)}async function Qt(n,i,e){await zs(n,JSON.stringify(i),e)}var A=require("obsidian");var fe=require("obsidian");var $t=fe.Platform.isMacOS?"Cmd":"Ctrl",jt=fe.Platform.isMacOS?"Option":"Alt",U=n=>n?jt:$t;function Ce(n){if(!n)return"";let i=n.modifiers.join(" ");return i?`${i} ${n.key}`:n.key}function Wt(n,i){let e=n.split(" ");return e.length===1?e[0]===""?null:{modifiers:[],key:e[0],hideHotkeyGuide:i}:{modifiers:e.slice(0,-1),key:e.at(-1),hideHotkeyGuide:i}}function C(n){return Object.keys(n).filter(i=>n[i].length>0).map(i=>dt(i,n[i][0])).filter(i=>i!==null)}function dt(n,i){if(!i||i.hideHotkeyGuide)return null;let e=i.modifiers.map(r=>r==="Mod"?$t:r==="Alt"?jt:r).join(" "),t=i.key==="Enter"?"\u21B5":i.key==="ArrowUp"?"\u2191":i.key==="ArrowDown"?"\u2193":i.key==="Escape"?"ESC":i.key;return{command:e?`[${e} ${t}]`:`[${t}]`,purpose:n}}function gt(n,i){let e={modifiers:[],key:Os(i.key)};return i.shiftKey&&e.modifiers.push("Shift"),i.altKey&&e.modifiers.push("Alt"),i.ctrlKey&&e.modifiers.push(fe.Platform.isMacOS?"Ctrl":"Mod"),i.metaKey&&e.modifiers.push(fe.Platform.isMacOS?"Mod":"Meta"),n.key.toLowerCase()===e.key.toLowerCase()&&Tt(n.modifiers,e.modifiers)}function Os(n){return n===" "?"Space":n}function B(n){return n==="Space"?" ":n}function Ns(n,i,e){var v,b;let{searchByTags:t,searchByHeaders:s,searchByLinks:r,keysOfPropertyToSearch:a,isNormalizeAccentsDiacritics:l}=e;if(t&&i.startsWith("#")){let k=n.tags.filter(f=>S(f.slice(1),i.slice(1),l));return[{type:k.length>0?"tag":"not found",meta:k,query:i}]}let c=i.split("/"),o=c.pop();if(!c.every(k=>{var f;return S((f=n.file.parent)==null?void 0:f.path,k,l)}))return[{type:"not found",query:i}];if(o.length===0)return[{type:"directory",meta:[n.file.path],query:i}];let d=[];n.tokens.some(k=>zt(k,o,l))&&d.push({type:"word-perfect",meta:[n.file.name],query:i});let m=le(n.file.extension==="md"?n.file.basename:n.file.name,i,l);switch(m.type){case"starts-with":d.push({type:"prefix-name",meta:[n.file.name],query:i,ranges:m.ranges});case"includes":d.push({type:"name",meta:[n.file.name],query:i,ranges:m.ranges});case"fuzzy":e.fuzzyTarget&&m.score>e.minFuzzyScore&&d.push({type:"fuzzy-name",meta:[n.file.name],query:i,score:m.score,ranges:m.ranges})}let p=[],g=[],y=[];for(let k of n.aliases){let f=le(k,o,l);switch(f.type){case"starts-with":p.push({value:k,ranges:f.ranges});case"includes":g.push({value:k,ranges:f.ranges});case"fuzzy":e.fuzzyTarget&&f.score>e.minFuzzyScore&&y.push({value:k,score:f.score,ranges:f.ranges})}}if(p.length>0){let k=oe(p,f=>f.value.length);d.push({type:"prefix-name",meta:p.map(f=>f.value),alias:k.value,query:i,ranges:void 0,allAliasRanges:p.map(f=>({alias:f.value,ranges:f.ranges||[]}))})}if(g.length>0){let k=oe(g,f=>f.value.length);d.push({type:"name",meta:g.map(f=>f.value),alias:k.value,query:i,ranges:void 0,allAliasRanges:g.map(f=>({alias:f.value,ranges:f.ranges||[]}))})}if(e.fuzzyTarget&&y.length>0){let k=oe(y,f=>f.score);d.push({type:"fuzzy-name",meta:y.map(f=>f.value),alias:k.value,score:k.score,query:i,ranges:void 0,allAliasRanges:y.map(f=>({alias:f.value,ranges:f.ranges||[]}))})}if(S((v=n.file.parent)==null?void 0:v.path,i,l)&&d.push({type:"directory",meta:[n.file.path],query:i}),s){let k=n.headers.filter(f=>S(f,i,l));k.length>0&&d.push({type:"header",meta:k,query:i})}if(r){let k=n.links.filter(f=>S(f,i,l));k.length>0&&d.push({type:"link",meta:k,query:i})}if(t){let k=n.tags.filter(f=>S(f.slice(1),i,l));k.length>0&&d.push({type:"tag",meta:k,query:i})}if(a.length>0){let k={};for(let E of a){let K=(b=n.frontMatter)==null?void 0:b[E];if(K)if(Array.isArray(K)){let M=K.map(H=>ct(H.toString(),i,l));M.length>0&&M.some(H=>H!==null)&&(k[E]=M)}else{let M=ct(K.toString(),i,l);M&&(k[E]=[M])}}let f=Object.keys(k);f.length>0&&d.push({type:"property",meta:f,frontMatterRanges:k,query:i})}return d.length===0?[{type:"not found",query:i}]:d}function Ks(n,i,e){return i.flatMap(t=>{var l;let[s,r]=e.excludePrefix&&t.startsWith(e.excludePrefix)?[t.slice(e.excludePrefix.length),!0]:[t,!1],a=Ns(n,s,e);return((l=a[0])==null?void 0:l.type)==="not found"?r?[]:a:r?[{type:"not found",query:s}]:a})}function Gt(n,i,e){return{...n,matchResults:Ks(n,i,e)}}function _e(n){let i=n.matchResults.find(t=>["word-perfect","prefix-name","name","fuzzy-name"].includes(t.type)&&!t.alias),e=Ee(n.matchResults.filter(t=>t.alias),t=>{var s;return(s=t.meta)!=null?s:[]});return{title:i?n.file.basename:void 0,aliases:e}}var w=require("obsidian");var qs=["Header match","Last modified","Last opened","Created earliest","Created latest","Length","Link match","Name match","Perfect word match","Prefix name match","Fuzzy name match","Star","Tag match","Property match","Alphabetical","Alphabetical reverse"];function Jt(n){return qs.includes(n)||n.split(",").every(i=>i.startsWith("#"))||n.split(",").every(i=>i.startsWith("."))}function Xt(n){return n.filter(i=>["Last opened","Last modified","Created earliest","Created latest","Star","Alphabetical","Alphabetical reverse"].includes(i)||i.startsWith("#")||i.startsWith("."))}function Vs(n){switch(n){case"Header match":return Js;case"Last modified":return ei;case"Last opened":return Zs;case"Created latest":return ti;case"Created earliest":return si;case"Length":return Ys;case"Link match":return Xs;case"Name match":return $s;case"Perfect word match":return Us;case"Prefix name match":return Qs;case"Fuzzy name match":return js;case"Star":return ii;case"Tag match":return Ws;case"Property match":return Gs;case"Alphabetical":return ni;case"Alphabetical reverse":return ri;default:if(n.startsWith("#")){let i=n.split(",");return(e,t)=>ai(e,t,i)}if(n.startsWith(".")){let i=n.split(",").map(e=>e.slice(1));return(e,t)=>oi(e,t,i)}throw new j(n)}}function Yt(n,i,e){let t=i.map(Vs);return n.sort((s,r)=>{let a;for(let l of t)if(a=l(s,r,e),a!==0)return a;return 0})}function _(n,i,e,t="asc"){let s=e(n),r=e(i);if(s===r)return 0;switch(t){case"asc":return s>r?1:r>s?-1:0;case"desc":return s<r?1:r<s?-1:0}}function Us(n,i){return _(n,i,e=>e.matchResults.filter(t=>t.type==="word-perfect").map(t=>t.query).unique().length,"desc")}function Qs(n,i){return _(n,i,e=>e.matchResults.filter(t=>t.type==="prefix-name").map(t=>t.query).unique().length,"desc")}function $s(n,i){return _(n,i,e=>e.matchResults.filter(t=>t.type==="name").map(t=>t.query).unique().length,"desc")}function js(n,i){return _(n,i,e=>Math.max(...e.matchResults.map(t=>{var s;return(s=t.score)!=null?s:0})),"desc")}function Ws(n,i){return _(n,i,e=>e.matchResults.filter(t=>t.type==="tag").map(t=>t.query).unique().length,"desc")}function Gs(n,i){return _(n,i,e=>e.matchResults.filter(t=>t.type==="property").map(t=>t.query).unique().length,"desc")}function Js(n,i){return _(n,i,e=>e.matchResults.filter(t=>t.type==="header").map(t=>t.query).unique().length,"desc")}function Xs(n,i){return _(n,i,e=>e.matchResults.filter(t=>t.type==="link").map(t=>t.query).unique().length,"desc")}function Ys(n,i){return _(n,i,e=>e.matchResults[0].alias?e.matchResults[0].alias.length:e.file.basename.length,"asc")}function Zs(n,i,e){return _(n,i,t=>{var s;return(s=e[t.file.path])!=null?s:999999},"asc")}function ei(n,i){return _(n,i,e=>e.file.stat.mtime,"desc")}function ti(n,i){return _(n,i,e=>e.file.stat.ctime,"desc")}function si(n,i){return _(n,i,e=>e.file.stat.ctime||Number.MAX_SAFE_INTEGER,"asc")}function ii(n,i){return _(n,i,e=>Number(e.starred),"desc")}var Ie=n=>{var i,e;return ne((e=(i=n.matchResults[0])==null?void 0:i.alias)!=null?e:n.file.basename).toLowerCase()};function ni(n,i){return Ie(n).localeCompare(Ie(i))}function ri(n,i){return Ie(i).localeCompare(Ie(n))}function ai(n,i,e){return _(n,i,t=>Ft([e,t.tags]).length,"desc")}function oi(n,i,e){return _(n,i,t=>Number(e.contains(t.file.extension)),"desc")}var li=["file","opened file","backlink","link","2-hop-link"],ci=["Recently used","Alphabetical","Alphabetical reverse"],mt=()=>({main:{up:[{modifiers:["Mod"],key:"p"}],down:[{modifiers:["Mod"],key:"n"}],"clear input":[{modifiers:["Mod"],key:"d"}],"replace input":[{modifiers:[],key:"Tab"}],open:[{modifiers:[],key:"Enter"}],"open in new tab":[{modifiers:["Mod"],key:"Enter"}],"open in new pane (horizontal)":[{modifiers:["Mod"],key:"-"}],"open in new pane (vertical)":[{modifiers:["Mod"],key:"i"}],"open in new window":[{modifiers:["Mod"],key:"o"}],"open in popup":[],"open in new tab in background":[{modifiers:["Alt"],key:"o"}],"open all in new tabs":[{modifiers:["Mod","Shift","Alt"],key:"o"}],"check/uncheck":[],"check/uncheck and next":[],"check all":[],"uncheck all":[],preview:[{modifiers:["Mod"],key:","}],create:[{modifiers:["Shift"],key:"Enter"}],"create in new tab":[{modifiers:["Mod","Shift"],key:"Enter"}],"create in new pane (horizontal)":[],"create in new pane (vertical)":[],"create in new window":[{modifiers:["Mod","Shift"],key:"o"}],"create in new popup":[],"open in default app":[],"show in system explorer":[],"open in google":[{modifiers:["Mod"],key:"g"}],"open first URL":[{modifiers:["Mod"],key:"]"}],"insert to editor":[{modifiers:["Alt"],key:"Enter"}],"insert to editor in background":[],"insert all to editor":[{modifiers:["Alt","Shift"],key:"Enter"}],"show backlinks":[{modifiers:["Mod"],key:"h"}],"show links":[{modifiers:["Mod"],key:"l"}],"show all results":[{modifiers:["Shift","Alt"],key:"a"}],"navigate forward":[{modifiers:["Alt"],key:"ArrowRight"}],"navigate back":[{modifiers:["Alt"],key:"ArrowLeft"}],"close if opened":[],"copy file vault path":[],"copy absolute file path":[],"launch grep":[],dismiss:[{modifiers:[],key:"Escape"}]},folder:{up:[{modifiers:["Mod"],key:"p"}],down:[{modifiers:["Mod"],key:"n"}],"open in default app":[],dismiss:[{modifiers:[],key:"Escape"}]},move:{up:[{modifiers:["Mod"],key:"p"}],down:[{modifiers:["Mod"],key:"n"}],"open in default app":[],dismiss:[{modifiers:[],key:"Escape"}]},command:{up:[{modifiers:["Mod"],key:"p"}],down:[{modifiers:["Mod"],key:"n"}],"copy command id":[],dismiss:[{modifiers:[],key:"Escape"}]},header:{up:[{modifiers:["Mod"],key:"p"}],down:[{modifiers:["Mod"],key:"n"}],"clear input":[{modifiers:["Mod"],key:"d"}],"move to next hit":[{modifiers:[],key:"Tab"}],"move to previous hit":[{modifiers:["Shift"],key:"Tab"}],"toggle auto preview":[{modifiers:["Mod"],key:","}],"insert all to editor":[{modifiers:["Alt","Shift"],key:"Enter"}],dismiss:[{modifiers:[],key:"Escape"}]},backlink:{up:[{modifiers:["Mod"],key:"p"}],down:[{modifiers:["Mod"],key:"n"}],open:[{modifiers:[],key:"Enter"}],"open in new tab":[{modifiers:["Mod"],key:"Enter"}],"open in new pane (horizontal)":[{modifiers:["Mod"],key:"-"}],"open in new pane (vertical)":[{modifiers:["Mod"],key:"i"}],"open in new window":[{modifiers:["Mod"],key:"o"}],"open in popup":[],"open in new tab in background":[{modifiers:["Alt"],key:"o"}],"open all in new tabs":[{modifiers:["Mod","Shift","Alt"],key:"o"}],"check/uncheck":[],"check/uncheck and next":[],"check all":[],"uncheck all":[],"show all results":[{modifiers:["Shift","Alt"],key:"a"}],preview:[{modifiers:["Mod"],key:","}],dismiss:[{modifiers:[],key:"Escape"}]},link:{up:[{modifiers:["Mod"],key:"p"}],down:[{modifiers:["Mod"],key:"n"}],open:[{modifiers:[],key:"Enter"}],"open in new tab":[{modifiers:["Mod"],key:"Enter"}],"open in new pane (horizontal)":[{modifiers:["Mod"],key:"-"}],"open in new pane (vertical)":[{modifiers:["Mod"],key:"i"}],"open in new window":[{modifiers:["Mod"],key:"o"}],"open in popup":[],"open in new tab in background":[{modifiers:["Alt"],key:"o"}],"open all in new tabs":[{modifiers:["Mod","Shift","Alt"],key:"o"}],"show all results":[{modifiers:["Shift","Alt"],key:"a"}],preview:[{modifiers:["Mod"],key:","}],dismiss:[{modifiers:[],key:"Escape"}]},"in-file":{up:[{modifiers:["Mod"],key:"p"}],down:[{modifiers:["Mod"],key:"n"}],"insert to editor":[],"show all results":[{modifiers:["Shift","Alt"],key:"a"}],"toggle auto preview":[{modifiers:["Mod"],key:","}],dismiss:[{modifiers:[],key:"Escape"}]},grep:{search:[{modifiers:[],key:"Tab"}],up:[{modifiers:["Mod"],key:"p"}],down:[{modifiers:["Mod"],key:"n"}],"clear input":[{modifiers:["Mod"],key:"d"}],"clear path":[{modifiers:["Alt"],key:"d"}],"set ./ to path":[{modifiers:["Alt"],key:"c"}],"toggle input":[],open:[{modifiers:[],key:"Enter"}],"open in new tab":[{modifiers:["Mod"],key:"Enter"}],"open in new pane (horizontal)":[{modifiers:["Mod"],key:"-"}],"open in new pane (vertical)":[{modifiers:["Mod"],key:"i"}],"open in new window":[{modifiers:["Mod"],key:"o"}],"open in popup":[],"open in new tab in background":[{modifiers:["Alt"],key:"o"}],"open all in new tabs":[{modifiers:["Mod","Shift","Alt"],key:"o"}],"check/uncheck":[],"check/uncheck and next":[],"check all":[],"uncheck all":[],preview:[{modifiers:["Mod"],key:","}],dismiss:[{modifiers:[],key:"Escape"}]}}),G=()=>["aliases","alias","tag","tags","cssclass","publish"],ft=()=>({name:"",searchBy:{tag:!1,link:!1,header:!1,property:!1},keysOfPropertyToSearch:[],searchTarget:"file",allowFuzzySearchForSearchTarget:!1,minFuzzyMatchScore:.5,targetExtensions:[],includeCurrentFile:!1,floating:!1,showFrontMatter:!1,excludeFrontMatterKeys:G(),defaultInput:"",restoreLastInput:!1,commandPrefix:"",sortPriorities:[],includePrefixPathPatterns:[],excludePrefixPathPatterns:[],expand:!0}),Zt=()=>({name:"Link search",searchBy:{tag:!1,link:!1,header:!1,property:!1},keysOfPropertyToSearch:[],searchTarget:"link",allowFuzzySearchForSearchTarget:!1,minFuzzyMatchScore:.5,targetExtensions:[],includeCurrentFile:!1,floating:!1,showFrontMatter:!1,excludeFrontMatterKeys:G(),defaultInput:"",restoreLastInput:!1,commandPrefix:"",sortPriorities:[],includePrefixPathPatterns:[],excludePrefixPathPatterns:[],expand:!1}),es=()=>({name:"Backlink search",searchBy:{tag:!1,link:!1,header:!1,property:!1},keysOfPropertyToSearch:[],searchTarget:"backlink",allowFuzzySearchForSearchTarget:!1,minFuzzyMatchScore:.5,targetExtensions:["md"],includeCurrentFile:!1,floating:!1,showFrontMatter:!1,excludeFrontMatterKeys:G(),defaultInput:"",restoreLastInput:!1,commandPrefix:"",sortPriorities:["Last opened","Last modified"],includePrefixPathPatterns:[],excludePrefixPathPatterns:[],expand:!1}),ui=()=>({name:"2 hop link search",searchBy:{tag:!0,link:!1,header:!1,property:!1},keysOfPropertyToSearch:[],searchTarget:"2-hop-link",allowFuzzySearchForSearchTarget:!1,minFuzzyMatchScore:.5,targetExtensions:[],includeCurrentFile:!1,floating:!1,showFrontMatter:!1,excludeFrontMatterKeys:G(),defaultInput:"",restoreLastInput:!1,commandPrefix:"",sortPriorities:["Prefix name match","Alphabetical",".md","Last opened","Last modified"],includePrefixPathPatterns:[],excludePrefixPathPatterns:[],expand:!1}),ts=()=>[{name:"Recent search",searchBy:{tag:!0,header:!1,link:!1,property:!1},keysOfPropertyToSearch:[],searchTarget:"file",allowFuzzySearchForSearchTarget:!1,minFuzzyMatchScore:.5,targetExtensions:[],includeCurrentFile:!1,floating:!1,showFrontMatter:!1,excludeFrontMatterKeys:G(),defaultInput:"",restoreLastInput:!1,commandPrefix:":e ",sortPriorities:["Name match",".md","Last opened","Last modified"],includePrefixPathPatterns:[],excludePrefixPathPatterns:[],expand:!0},{name:"File name search",searchBy:{tag:!1,link:!1,header:!1,property:!1},keysOfPropertyToSearch:[],searchTarget:"file",allowFuzzySearchForSearchTarget:!1,minFuzzyMatchScore:.5,targetExtensions:[],includeCurrentFile:!1,floating:!1,showFrontMatter:!1,excludeFrontMatterKeys:G(),defaultInput:"",restoreLastInput:!1,commandPrefix:":f ",sortPriorities:["Prefix name match","Alphabetical",".md","Last opened","Last modified"],includePrefixPathPatterns:[],excludePrefixPathPatterns:[],expand:!1},{name:"File name fuzzy search",searchBy:{tag:!1,link:!1,header:!1,property:!1},keysOfPropertyToSearch:[],searchTarget:"file",allowFuzzySearchForSearchTarget:!0,minFuzzyMatchScore:.5,targetExtensions:[],includeCurrentFile:!1,floating:!1,showFrontMatter:!1,excludeFrontMatterKeys:G(),defaultInput:"",restoreLastInput:!1,commandPrefix:"",sortPriorities:["Prefix name match","Fuzzy name match",".md","Last opened","Last modified"],includePrefixPathPatterns:[],excludePrefixPathPatterns:[],expand:!1},{name:"Landmark search",searchBy:{tag:!0,link:!0,header:!0,property:!1},keysOfPropertyToSearch:[],searchTarget:"file",allowFuzzySearchForSearchTarget:!1,minFuzzyMatchScore:.5,targetExtensions:[],includeCurrentFile:!1,floating:!1,showFrontMatter:!1,excludeFrontMatterKeys:G(),defaultInput:"",restoreLastInput:!1,commandPrefix:":l ",sortPriorities:["Prefix name match","Name match","Tag match","Header match","Link match",".md","Last opened","Last modified"],includePrefixPathPatterns:[],excludePrefixPathPatterns:[],expand:!1},{name:"Star search",searchBy:{tag:!1,link:!1,header:!1,property:!1},keysOfPropertyToSearch:[],searchTarget:"file",allowFuzzySearchForSearchTarget:!1,minFuzzyMatchScore:.5,targetExtensions:[],includeCurrentFile:!1,floating:!1,showFrontMatter:!1,excludeFrontMatterKeys:G(),defaultInput:"",restoreLastInput:!1,commandPrefix:":s ",sortPriorities:["Star",".md","Last opened","Last modified"],includePrefixPathPatterns:[],excludePrefixPathPatterns:[],expand:!1},ui()],ss={searchDelayMilliSeconds:0,maxNumberOfSuggestions:50,normalizeAccentsAndDiacritics:!1,useSelectionWordsAsDefaultInputQuery:!1,preventDuplicateTabs:!1,showDirectory:!0,showDirectoryAtNewLine:!1,showFullPathOfDirectory:!1,showAliasesOnTop:!1,displayAliaseAsTitle:!1,displayDescriptionBelowTitle:!1,showExistingFilesOnly:!1,hideGutterIcons:!1,hideHotkeyGuides:!1,userAltInsteadOfModForQuickResultSelection:!1,hotkeys:mt(),searchCommands:ts(),searchesExcludePrefix:"-",searchesAutoAliasTransform:{enabled:!1,aliasPattern:"",aliasFormat:""},autoPreviewInFloatingHeaderSearch:!0,backlinkExcludePrefixPathPatterns:[],inFileContextLines:2,autoPreviewInFloatingInFileSearch:!1,inFileMaxDisplayLengthAroundMatchedWord:64,ripgrepCommand:"rg",grepSearchDelayMilliSeconds:0,grepMinQueryLength:1,grepExtensions:["md"],maxDisplayLengthAroundMatchedWord:64,includeFilenameInGrepSearch:!1,defaultGrepFolder:"",autoPreviewInGrepSearch:!1,grepAutoPreviewDelayMilliSeconds:300,autoPreviewInBacklinkSearch:!1,backlinkAutoPreviewDelayMilliSeconds:300,moveFileExcludePrefixPathPatterns:[],moveFolderSortPriority:"Recently used",moveFileRecentlyUsedFilePath:"",moveFileMaxRecentlyUsedFolders:10,commandPaletteHistoryPath:"",commandPaletteMaxHistoryRetentionDays:10,showLogAboutPerformanceInConsole:!1,showFuzzyMatchScore:!1},Fe=class extends w.PluginSettingTab{constructor(e,t){super(e,t);this.resetLock=!0;this.hotkeyExpandedStatus={main:!1,folder:!1,move:!1,header:!1,backlink:!1,link:!1,"in-file":!1,grep:!1,command:!1};this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Another Quick Switcher - Settings"}),this.addGeneralSettings(e),this.addAppearanceSettings(e),this.addHotKeysInDialogSettings(e),this.addSearchSettings(e),this.addHeaderSearchSettings(e),this.addBacklinkSettings(e),this.addInFileSettings(e),this.addGrepSettings(e),this.addMoveSettings(e),this.addCommandPalleteSettings(e),this.addDebugSettings(e)}addGeneralSettings(e){new w.Setting(e).setName("Search delay milli-seconds").setDesc("If keyboard operation is slow, try increasing the value").addSlider(t=>t.setLimits(0,1e3,10).setValue(this.plugin.settings.searchDelayMilliSeconds).setDynamicTooltip().onChange(async s=>{this.plugin.settings.searchDelayMilliSeconds=s,await this.plugin.saveSettings()})),new w.Setting(e).setName("Max number of suggestions").addSlider(t=>t.setLimits(1,255,1).setValue(this.plugin.settings.maxNumberOfSuggestions).setDynamicTooltip().onChange(async s=>{this.plugin.settings.maxNumberOfSuggestions=s,await this.plugin.saveSettings()})),new w.Setting(e).setName("Normalize accents/diacritics").addToggle(t=>{t.setValue(this.plugin.settings.normalizeAccentsAndDiacritics).onChange(async s=>{this.plugin.settings.normalizeAccentsAndDiacritics=s,await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.normalizeAccentsAndDiacritics&&e.createEl("div",{text:"! If enabled, it is about 2 to 5 times slower than disabled",cls:"another-quick-switcher__settings__warning"}),new w.Setting(e).setName("Use selection words as a default input query").addToggle(t=>{t.setValue(this.plugin.settings.useSelectionWordsAsDefaultInputQuery).onChange(async s=>{this.plugin.settings.useSelectionWordsAsDefaultInputQuery=s,await this.plugin.saveSettings()})}),new w.Setting(e).setName("Prevent duplicate tabs").setDesc("If a file is already opened as a tab, it will not open in a new tab; instead, the existing tab will be activated. This option is enabled for three commands: 'open in new tab', 'open in new tab in background', and 'open all in new tabs'.").addToggle(t=>{t.setValue(this.plugin.settings.preventDuplicateTabs).onChange(async s=>{this.plugin.settings.preventDuplicateTabs=s,await this.plugin.saveSettings()})})}addAppearanceSettings(e){e.createEl("h3",{text:"\u{1F441}Appearance"}),new w.Setting(e).setName("Show directory").addToggle(t=>{t.setValue(this.plugin.settings.showDirectory).onChange(async s=>{this.plugin.settings.showDirectory=s,await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.showDirectory&&(new w.Setting(e).setName("Show directory at the new line").setClass("another-quick-switcher__settings__nested").addToggle(t=>{t.setValue(this.plugin.settings.showDirectoryAtNewLine).onChange(async s=>{this.plugin.settings.showDirectoryAtNewLine=s,await this.plugin.saveSettings()})}),new w.Setting(e).setName("Show full path of directory").setClass("another-quick-switcher__settings__nested").addToggle(t=>{t.setValue(this.plugin.settings.showFullPathOfDirectory).onChange(async s=>{this.plugin.settings.showFullPathOfDirectory=s,await this.plugin.saveSettings()})})),new w.Setting(e).setName("Display alias as title on keyword match").setDesc("When a keyword matches an alias, display the alias as the title.").addToggle(t=>{t.setValue(this.plugin.settings.showAliasesOnTop).onChange(async s=>{this.plugin.settings.showAliasesOnTop=s,await this.plugin.saveSettings()})}),new w.Setting(e).setName("Display the alias as the title").addToggle(t=>{t.setValue(this.plugin.settings.displayAliaseAsTitle).onChange(async s=>{this.plugin.settings.displayAliaseAsTitle=s,await this.plugin.saveSettings()})}),new w.Setting(e).setName("Display the 'description' property below the title").setDesc("When enabled, it will no longer appear in the property display area of the search results.").addToggle(t=>{t.setValue(this.plugin.settings.displayDescriptionBelowTitle).onChange(async s=>{this.plugin.settings.displayDescriptionBelowTitle=s,await this.plugin.saveSettings()})}),new w.Setting(e).setName("Show existing files only").addToggle(t=>{t.setValue(this.plugin.settings.showExistingFilesOnly).onChange(async s=>{this.plugin.settings.showExistingFilesOnly=s,await this.plugin.saveSettings()})}),new w.Setting(e).setName("Hide gutter icons").addToggle(t=>{t.setValue(this.plugin.settings.hideGutterIcons).onChange(async s=>{this.plugin.settings.hideGutterIcons=s,await this.plugin.saveSettings()})}),new w.Setting(e).setName("Hide hotkey guides").addToggle(t=>{t.setValue(this.plugin.settings.hideHotkeyGuides).onChange(async s=>{this.plugin.settings.hideHotkeyGuides=s,await this.plugin.saveSettings()})})}addHotKeysInDialogSettings(e){e.createEl("h3",{text:"\u2328Hot keys in dialog"}),new w.Setting(e).setName("Use `alt 1\uFF5E9` instead of `ctrl/cmd 1\uFF5E9` for quick result selection").addToggle(r=>{r.setValue(this.plugin.settings.userAltInsteadOfModForQuickResultSelection).onChange(async a=>{this.plugin.settings.userAltInsteadOfModForQuickResultSelection=a,await this.plugin.saveSettings()})});let t=(r,a)=>{if(!this.hotkeyExpandedStatus[r])return;let l=(o,u)=>{new w.Setting(a).setName(o).setClass("another-quick-switcher__settings__dialog-hotkey-item").addText(h=>{let d=this.plugin.settings.hotkeys[r];return h.setValue(Ce(d[u][0])).onChange(async m=>{var g,y;let p=Wt(m,(y=(g=d[u][0])==null?void 0:g.hideHotkeyGuide)!=null?y:!1);d[u]=p?[p]:[],await this.plugin.saveSettings()})}).addToggle(h=>{var m;let d=this.plugin.settings.hotkeys[r];return h.setTooltip("Show hotkey guide if enabled").setValue(!((m=d[u][0])!=null&&m.hideHotkeyGuide)).onChange(async p=>{d[u]=d[u][0]?[{...d[u][0],hideHotkeyGuide:!p}]:[],await this.plugin.saveSettings()})})},c=Object.keys(this.plugin.settings.hotkeys[r]);for(let o of c)l(o,o)},s=(r,a)=>{let l=createDiv({cls:"another-quick-switcher__settings__dialog-hotkey"});e.append(l);let c=createEl("li");c.append("You can know the keycode at ",createEl("a",{text:"keycode.info",href:"https://keycode.info/"}),". (Press any key and show 'event.key')"),c.createEl("ul").createEl("li",{text:"For the space key, please set the value to 'Space'."});let o=createEl("ul");o.createEl("li",{text:"'Ctrl a' means pressing the Ctrl key and the A key."}),o.createEl("li",{text:"Use 'Mod' instead of 'Ctrl' on Windows or 'Cmd' on macOS."}),o.append(c);let u=document.createDocumentFragment();u.append(o),new w.Setting(l).setHeading().setName(a).setDesc(u).addExtraButton(h=>h.setIcon(this.hotkeyExpandedStatus[r]?"chevron-up":"chevron-down").setTooltip(this.hotkeyExpandedStatus[r]?"fold":"unfold").onClick(()=>{this.hotkeyExpandedStatus[r]=!this.hotkeyExpandedStatus[r],this.display()})),t(r,l)};s("main","Main dialog"),s("folder","Folder dialog"),s("header","Header dialog"),s("backlink","Backlink dialog"),s("link","Link dialog"),s("in-file","In File dialog"),s("grep","Grep dialog"),s("command","Command palette")}addSearchSettings(e){if(e.createEl("h3",{text:"\u{1F50D} Search commands"}),this.plugin.settings.searchCommands.forEach((t,s)=>{this.addSearchCommandSetting(e,this.plugin.settings.searchCommands[s])}),new w.Setting(e).setHeading().addButton(t=>{t.setButtonText("Add").setTooltip("Add a new command").setCta().setClass("another-quick-switcher__settings__search-command__add-button").onClick(async s=>{this.plugin.settings.searchCommands.push(ft()),this.display()})}).addButton(t=>{t.setButtonText("Save").setTooltip("You must click this button to save settings before closing Obsidian").setCta().setClass("another-quick-switcher__settings__search-command__save-button").onClick(async s=>{this.plugin.settings.searchCommands=this.plugin.settings.searchCommands.filter(a=>a.name);let r=this.plugin.settings.searchCommands.flatMap(a=>a.sortPriorities).filter(a=>!Jt(a));if(r.length>0){new w.Notice(`
Invalid sort priorities:
${r.map(a=>`- ${a}`).join(`
`)}
`.trim(),0);return}await this.plugin.saveSettings(),this.display(),this.plugin.reloadCommands(),new w.Notice("Save and reload commands")})}),new w.Setting(e).setName("Reset all search commands").setClass("another-quick-switcher__settings__danger").setDesc("It means your customized commands will be removed. If you reset unintentionally, you can restore the search commands by closing settings and Obsidian immediately, then restart Obsidian.").addToggle(t=>{t.setValue(this.resetLock).onChange(s=>{this.resetLock=s,this.display()}),this.resetLock&&t.setTooltip("Turn off the lock, if you want to reset all search commands")}).addButton(t=>{t.setButtonText("Reset").setTooltip("Reset all search commands!!").setDisabled(this.resetLock).onClick(()=>{this.plugin.settings.searchCommands=ts(),this.display()}),this.resetLock||t.setCta()}),new w.Setting(e).setName("Exclude prefix").setDesc("Adding this at the beginning of a query excludes matching results.").addText(t=>{t.setValue(this.plugin.settings.searchesExcludePrefix).onChange(async s=>{this.plugin.settings.searchesExcludePrefix=s,await this.plugin.saveSettings()})}),new w.Setting(e).setName("Auto alias transform").setDesc("Transforms a selected link candidate into an internal link with an aliase based on a regex-defined rule when using the insert to editor command.").addToggle(t=>{t.setValue(this.plugin.settings.searchesAutoAliasTransform.enabled).onChange(async s=>{this.plugin.settings.searchesAutoAliasTransform.enabled=s,await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.searchesAutoAliasTransform.enabled){let t=String.raw`Ex: (?<name>.+) \(.+\)$`;new w.Setting(e).setName("Alias pattern").setDesc(`Specifies the regex pattern to identify parts of the link candidate for transformation into an alias. ${t}`).setClass("another-quick-switcher__settings__nested").addText(s=>{s.setValue(this.plugin.settings.searchesAutoAliasTransform.aliasPattern).onChange(async r=>{this.plugin.settings.searchesAutoAliasTransform.aliasPattern=r,await this.plugin.saveSettings()})}),new w.Setting(e).setName("Alias format").setDesc("Defines the format for the alias after transformation, using regex-captured groups from the candidate name. Ex: $<name>").setClass("another-quick-switcher__settings__nested").addText(s=>{s.setValue(this.plugin.settings.searchesAutoAliasTransform.aliasFormat).onChange(async r=>{this.plugin.settings.searchesAutoAliasTransform.aliasFormat=r,await this.plugin.saveSettings()})})}}addSearchCommandSetting(e,t){let s=createDiv({cls:"another-quick-switcher__settings__search-command"});if(e.append(s),new w.Setting(s).setClass("another-quick-switcher__settings__search-command__header").setHeading().addText(o=>{let u=o.setPlaceholder("Command name").setValue(t.name).onChange(async h=>{t.name=h});return u.inputEl.setAttribute("style","text-align: left"),u}).addExtraButton(o=>(o.setTooltip("Delete a command (!! it will never be restored !!)").setIcon("trash-2").onClick(()=>{this.plugin.settings.searchCommands.remove(t),this.display()}),o.extraSettingsEl.addClass("another-quick-switcher__settings__search-command__header__delete"),o)).addExtraButton(o=>(o.setIcon(t.expand?"chevron-up":"chevron-down").setTooltip(t.expand?"fold":"unfold").onClick(()=>{t.expand=!t.expand,this.display()}),o.extraSettingsEl.addClass("another-quick-switcher__settings__search-command__header__fold-button"),o)),!t.expand)return;let r="another-quick-switcher__settings__search-command__search-by-button",a="another-quick-switcher__settings__search-command__search-by-button_enabled",l="another-quick-switcher__settings__search-command__search-by-button_disabled";new w.Setting(s).setName("Search by").setDesc("Click the button to enable/disable the search target").addButton(o=>{let u=()=>{o.buttonEl.removeClass(a,l),o.buttonEl.addClass(t.searchBy.tag?a:l)};return o.setButtonText("Tag").setClass(r).onClick(async()=>{t.searchBy.tag=!t.searchBy.tag,u()}),u(),o}).addButton(o=>{let u=()=>{o.buttonEl.removeClass(a,l),o.buttonEl.addClass(t.searchBy.header?a:l)};return o.setButtonText("Header").setClass(r).onClick(async()=>{t.searchBy.header=!t.searchBy.header,u()}),u(),o}).addButton(o=>{let u=()=>{o.buttonEl.removeClass(a,l),o.buttonEl.addClass(t.searchBy.link?a:l)};return o.setButtonText("Link").setClass(r).onClick(async()=>{t.searchBy.link=!t.searchBy.link,u()}),u(),o}).addButton(o=>{let u=()=>{o.buttonEl.removeClass(a,l),o.buttonEl.addClass(t.searchBy.property?a:l)};return o.setButtonText("Property").setClass(r).onClick(async()=>{t.searchBy.property=!t.searchBy.property,u(),this.display()}),u(),o}),t.searchBy.property&&new w.Setting(s).setName("Keys of the property to search").setDesc("Multiple entries can be specified, separated by line breaks.").addTextArea(o=>{let u=o.setValue(t.keysOfPropertyToSearch.join(`
`)).onChange(async h=>{t.keysOfPropertyToSearch=Z(h)});return u.inputEl.className="another-quick-switcher__settings__keys_of_property_to_search",u}),new w.Setting(s).setName("Search target").addDropdown(o=>{o.addOptions(rt([...li])).setValue(t.searchTarget).onChange(async u=>{t.searchTarget=u})}),new w.Setting(s).setName('Allow fuzzy search for "Search target"').addToggle(o=>{o.setValue(t.allowFuzzySearchForSearchTarget).onChange(async u=>{t.allowFuzzySearchForSearchTarget=u})}),new w.Setting(s).setName("Min fuzzy match score").setDesc("Only show suggestion those score is more than the specific score").addSlider(o=>o.setLimits(0,10,.1).setValue(t.minFuzzyMatchScore).setDynamicTooltip().onChange(async u=>{t.minFuzzyMatchScore=u})),new w.Setting(s).setName("Target extensions").setDesc("If set, only files whose extension equals will be suggested. If empty, all files will be suggested. It can set multi extensions using comma.").addTextArea(o=>o.setPlaceholder("(ex: md,png,canvas)").setValue(t.targetExtensions.join(",")).onChange(async u=>{t.targetExtensions=ut(u)})),new w.Setting(s).setName("Include current file").addToggle(o=>{o.setValue(t.includeCurrentFile).onChange(async u=>{t.includeCurrentFile=u})}),new w.Setting(s).setName("Floating").addToggle(o=>{o.setValue(t.floating).onChange(async u=>{t.floating=u,this.display()})}),new w.Setting(s).setName("Show front matter").addToggle(o=>{o.setValue(t.showFrontMatter).onChange(async u=>{t.showFrontMatter=u,this.display()})}),t.showFrontMatter&&new w.Setting(s).setName("Exclude front matter keys").setDesc("It can set multi patterns by line breaks.").addTextArea(o=>{let u=o.setValue(t.excludeFrontMatterKeys.join(`
`)).onChange(async h=>{t.excludeFrontMatterKeys=Z(h)});return u.inputEl.className="another-quick-switcher__settings__exclude_front_matter_keys",u}),new w.Setting(s).setName("Default input").setDesc("Default input strings when it opens the dialog").addText(o=>o.setValue(t.defaultInput).setPlaceholder("(ex: #todo )").onChange(async u=>{t.defaultInput=u})),new w.Setting(s).setName("Restore last input").setDesc("If enabled, this option will restore the last input, shared across all searches where it is enabled.").addToggle(o=>{o.setValue(t.restoreLastInput).onChange(async u=>{t.restoreLastInput=u})}),new w.Setting(s).setName("Command prefix").setDesc("For example, if it sets ':r ', a query starts with ':r ' means that search as this command").addText(o=>o.setValue(t.commandPrefix).setPlaceholder("(ex: :r )").onChange(async u=>{t.commandPrefix=u}));let c=document.createDocumentFragment();c.append("Valid sort priorities refer to ",createEl("a",{text:"README",href:"https://github.com/tadashi-aikawa/obsidian-another-quick-switcher#sort-priorities"})),new w.Setting(s).setName("Sort priorities").setDesc(c).addTextArea(o=>{let u=o.setPlaceholder("").setValue(t.sortPriorities.join(`
`)).onChange(async h=>{let d=Z(h);t.sortPriorities=d});return u.inputEl.addClass("another-quick-switcher__settings__search-command__sort-priority"),u}),new w.Setting(s).setName("Include prefix path patterns").setDesc("If set, only files whose paths start with one of the patterns will be suggested. It can set multi patterns by line breaks. <current_dir> means current directory.").addTextArea(o=>{let u=o.setPlaceholder("(ex: Notes/Private)").setValue(t.includePrefixPathPatterns.join(`
`)).onChange(async h=>{t.includePrefixPathPatterns=Z(h)});return u.inputEl.className="another-quick-switcher__settings__include_path_patterns",u}),new w.Setting(s).setName("Exclude prefix path patterns").setDesc("If set, files whose paths start with one of the patterns will not be suggested. It can set multi patterns by line breaks. <current_dir> means current directory.").addTextArea(o=>{let u=o.setPlaceholder("(ex: Notes/Private)").setValue(t.excludePrefixPathPatterns.join(`
`)).onChange(async h=>{t.excludePrefixPathPatterns=Z(h)});return u.inputEl.className="another-quick-switcher__settings__exclude_path_patterns",u})}addHeaderSearchSettings(e){e.createEl("h3",{text:"\u{1F4D2} Header search"}),new w.Setting(e).setName("Auto preview in the floating mode").addToggle(t=>{t.setValue(this.plugin.settings.autoPreviewInFloatingHeaderSearch).onChange(async s=>{this.plugin.settings.autoPreviewInFloatingHeaderSearch=s,await this.plugin.saveSettings()})})}addBacklinkSettings(e){e.createEl("h3",{text:"\u{1F50D} Backlink search"}),new w.Setting(e).setName('Exclude prefix path patterns for "Backlink search"').setDesc("If set, folders whose paths start with one of the patterns will not be suggested. It can set multi patterns by line breaks").addTextArea(t=>{let s=t.setPlaceholder("Prefix match patterns").setValue(this.plugin.settings.backlinkExcludePrefixPathPatterns.join(`
`)).onChange(async r=>{this.plugin.settings.backlinkExcludePrefixPathPatterns=Z(r),await this.plugin.saveSettings()});return s.inputEl.className="another-quick-switcher__settings__ignore_path_patterns",s}),new w.Setting(e).setName("Auto preview").setDesc("If enabled, automatically shows preview when selecting candidates.").addToggle(t=>{t.setValue(this.plugin.settings.autoPreviewInBacklinkSearch).onChange(async s=>{this.plugin.settings.autoPreviewInBacklinkSearch=s,await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.autoPreviewInBacklinkSearch&&new w.Setting(e).setName("Auto preview delay milli-seconds").setDesc("Delay before auto preview is triggered when selection changes.").addSlider(t=>t.setLimits(0,1e3,50).setValue(this.plugin.settings.backlinkAutoPreviewDelayMilliSeconds).setDynamicTooltip().onChange(async s=>{this.plugin.settings.backlinkAutoPreviewDelayMilliSeconds=s,await this.plugin.saveSettings()}))}addInFileSettings(e){e.createEl("h3",{text:"\u{1F50D} In file search"}),new w.Setting(e).setName("Context Lines").setDesc("Specifies the number of lines to display before and after the target line. For instance, setting this to '2' would display two lines before and two lines after the target line, providing context to the selected text").addSlider(t=>t.setLimits(0,10,1).setValue(this.plugin.settings.inFileContextLines).setDynamicTooltip().onChange(async s=>{this.plugin.settings.inFileContextLines=s,await this.plugin.saveSettings()})),new w.Setting(e).setName("Auto preview in the floating mode").addToggle(t=>{t.setValue(this.plugin.settings.autoPreviewInFloatingInFileSearch).onChange(async s=>{this.plugin.settings.autoPreviewInFloatingInFileSearch=s,await this.plugin.saveSettings()})}),new w.Setting(e).setName("Max display length around matched word").setDesc("Maximum display character count before or after the matched word.").addSlider(t=>t.setLimits(1,255,1).setValue(this.plugin.settings.inFileMaxDisplayLengthAroundMatchedWord).setDynamicTooltip().onChange(async s=>{this.plugin.settings.inFileMaxDisplayLengthAroundMatchedWord=s,await this.plugin.saveSettings()}))}addGrepSettings(e){e.createEl("h3",{text:"\u{1F50D} Grep"}),new w.Setting(e).setName("Ripgrep command").setDesc("A command that can execute ripgrep").addText(t=>t.setValue(this.plugin.settings.ripgrepCommand).onChange(async s=>{this.plugin.settings.ripgrepCommand=s,await this.plugin.saveSettings()})),e.createEl("div",{text:"! Please note that on Windows, the initial file access speed may be significantly slower.",cls:"another-quick-switcher__settings__warning"}),new w.Setting(e).setName("Grep search delay milli-seconds").setDesc("If set to 1 or more, the search will be executed automatically after the specified milliseconds have passed since entering a keyword. If set to 0, the search will only be executed when the hotkey is pressed.").addSlider(t=>t.setLimits(0,1e3,10).setValue(this.plugin.settings.grepSearchDelayMilliSeconds).setDynamicTooltip().onChange(async s=>{this.plugin.settings.grepSearchDelayMilliSeconds=s,await this.plugin.saveSettings()})),new w.Setting(e).setName("Minimum query length for auto search").setDesc("The minimum number of characters required to start an automatic search.").addSlider(t=>t.setLimits(1,10,1).setValue(this.plugin.settings.grepMinQueryLength).setDynamicTooltip().onChange(async s=>{this.plugin.settings.grepMinQueryLength=s,await this.plugin.saveSettings()})),new w.Setting(e).setName("Extensions").addText(t=>t.setPlaceholder("(ex: md,html,css)").setValue(this.plugin.settings.grepExtensions.join(",")).onChange(async s=>{this.plugin.settings.grepExtensions=ut(s),await this.plugin.saveSettings()})),new w.Setting(e).setName("Default folder").setDesc("Default folder path for grep searches. Leave empty to use vault root. Use ./ for current directory.").addText(t=>t.setPlaceholder("(ex: ./, folder/subfolder)").setValue(this.plugin.settings.defaultGrepFolder).onChange(async s=>{this.plugin.settings.defaultGrepFolder=s,await this.plugin.saveSettings()})),new w.Setting(e).setName("Max display length around matched word").setDesc("Maximum display character count before or after the matched word.").addSlider(t=>t.setLimits(1,255,1).setValue(this.plugin.settings.maxDisplayLengthAroundMatchedWord).setDynamicTooltip().onChange(async s=>{this.plugin.settings.maxDisplayLengthAroundMatchedWord=s,await this.plugin.saveSettings()})),new w.Setting(e).setName("Include file name in search").setDesc("If enabled, file names are also included in the search target.").addToggle(t=>{t.setValue(this.plugin.settings.includeFilenameInGrepSearch).onChange(async s=>{this.plugin.settings.includeFilenameInGrepSearch=s,await this.plugin.saveSettings(),this.display()})}),new w.Setting(e).setName("Auto preview").setDesc("If enabled, automatically shows preview when selecting candidates.").addToggle(t=>{t.setValue(this.plugin.settings.autoPreviewInGrepSearch).onChange(async s=>{this.plugin.settings.autoPreviewInGrepSearch=s,await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.autoPreviewInGrepSearch&&new w.Setting(e).setName("Auto preview delay milli-seconds").setClass("another-quick-switcher__settings__nested").setDesc("Delay before auto preview is triggered when selection changes.").addSlider(t=>t.setLimits(0,1e3,50).setValue(this.plugin.settings.grepAutoPreviewDelayMilliSeconds).setDynamicTooltip().onChange(async s=>{this.plugin.settings.grepAutoPreviewDelayMilliSeconds=s,await this.plugin.saveSettings()}))}addMoveSettings(e){e.createEl("h3",{text:"\u{1F4C1} Move file to another folder"}),new w.Setting(e).setName('Exclude prefix path patterns for "Move file to another folder"').setDesc("If set, folders whose paths start with one of the patterns will not be suggested. It can set multi patterns by line breaks").addTextArea(t=>{let s=t.setPlaceholder("Prefix match patterns").setValue(this.plugin.settings.moveFileExcludePrefixPathPatterns.join(`
`)).onChange(async r=>{this.plugin.settings.moveFileExcludePrefixPathPatterns=Z(r),await this.plugin.saveSettings()});return s.inputEl.className="another-quick-switcher__settings__ignore_path_patterns",s}),new w.Setting(e).setName("Folder sort priority").setDesc("How to sort folders in move dialog").addDropdown(t=>t.addOptions(rt([...ci])).setValue(this.plugin.settings.moveFolderSortPriority).onChange(async s=>{this.plugin.settings.moveFolderSortPriority=s,await this.plugin.saveSettings()})),new w.Setting(e).setName("Recently used folders file path").setDesc("Path within vault to store recently used folders history").addText(t=>{t.setPlaceholder(".obsidian/plugins/obsidian-another-quick-switcher/recently-used-folders.json").setValue(this.plugin.settings.moveFileRecentlyUsedFilePath).onChange(async s=>{this.plugin.settings.moveFileRecentlyUsedFilePath=s,await this.plugin.saveSettings()})}),new w.Setting(e).setName("Max recently used folders").setDesc("Maximum number of recently used folders to remember").addSlider(t=>{t.setLimits(5,50,5).setValue(this.plugin.settings.moveFileMaxRecentlyUsedFolders).setDynamicTooltip().onChange(async s=>{this.plugin.settings.moveFileMaxRecentlyUsedFolders=s,await this.plugin.saveSettings()})})}addCommandPalleteSettings(e){e.createEl("h3",{text:"\u2318 Command pallete"}),new w.Setting(e).setName("History mapping file path").setDesc("Path within vault to store command history data").addText(t=>{t.setPlaceholder(".obsidian/plugins/obsidian-another-quick-switcher/command-history.json").setValue(this.plugin.settings.commandPaletteHistoryPath).onChange(async s=>{this.plugin.settings.commandPaletteHistoryPath=s,await this.plugin.saveSettings()})}),new w.Setting(e).setName("Max history retention days").setDesc("Commands not used within this number of days will be removed. Set to 0 to retain all history.").addSlider(t=>{t.setLimits(0,30,1).setValue(this.plugin.settings.commandPaletteMaxHistoryRetentionDays).setDynamicTooltip().onChange(async s=>{this.plugin.settings.commandPaletteMaxHistoryRetentionDays=s,await this.plugin.saveSettings()})})}addDebugSettings(e){e.createEl("h3",{text:"Debug"}),new w.Setting(e).setName("Show log about performance in a console").addToggle(t=>{t.setValue(this.plugin.settings.showLogAboutPerformanceInConsole).onChange(async s=>{this.plugin.settings.showLogAboutPerformanceInConsole=s,await this.plugin.saveSettings()})}),new w.Setting(e).setName("Show fuzzy match score in the dialog").addToggle(t=>{t.setValue(this.plugin.settings.showFuzzyMatchScore).onChange(async s=>{this.plugin.settings.showFuzzyMatchScore=s,await this.plugin.saveSettings()})})}};function hi(n,i){return`${n}: ${Math.round(i)}[ms]`}var z=class n{constructor(i){this.settings=i}static of(i){return new n(i)}showDebugLog(i,e){this.settings.showLogAboutPerformanceInConsole&&console.log(hi(i,performance.now()-e))}};var is=require("obsidian");function pi(n){return n.ctrlKey||is.Platform.isMacOS&&n.metaKey}function te(n){return pi(n)?"new-tab":"same-tab"}var ns=require("obsidian"),Q=class extends ns.SuggestModal{constructor(){super(...arguments);this.selectedItemMap={}}getItems(){var e;return(e=this.chooser.values)!=null?e:null}getSelectedItem(){var e,t;return(t=(e=this.getItems())==null?void 0:e[this.chooser.selectedItem])!=null?t:null}getSelectedElement(){var e,t;return(t=(e=this.chooser.suggestions)==null?void 0:e[this.chooser.selectedItem])!=null?t:null}getSelected(){return{item:this.getSelectedItem(),element:this.getSelectedElement()}}selectNextItem(){this.chooser.setSelectedItem(this.chooser.selectedItem+1)}getCheckedItems(){return Object.values(this.selectedItemMap)}async actionMultiItems(e,t){let s=this.getCheckedItems();if(s.length>0){for(let a of s)await e(a,"check");return}let r=this.getSelectedItem();if(!r){t&&await t();return}e(r,"select")}async toggleCheckedItem(e){let{item:t,element:s}=this.getSelected();if(!t||!s)return;let r=this.toKey(t);this.selectedItemMap[r]?delete this.selectedItemMap[r]:this.selectedItemMap[r]=t,s.empty(),this.renderSuggestion(t,s),e!=null&&e.moveNext&&this.selectNextItem()}checkAll(){var e;this.selectedItemMap={};for(let t of(e=this.chooser.values)!=null?e:[]){let s=this.toKey(t);this.selectedItemMap[s]=t}this.updateSuggestions()}uncheckAll(){this.selectedItemMap={},this.updateSuggestions()}};var rs='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="15" height="15"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 3v4a1 1 0 0 0 1 1h4"></path><path d="M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2z"></path></g></svg>',P='<svg viewBox="0 0 100 100" class="folder" width="17" height="17"><path fill="currentColor" stroke="currentColor" d="M6.1,8c-3.3,0-6,2.7-6,6v73.8c-0.1,0.5-0.1,0.9,0.1,1.4c0.6,2.7,3,4.8,5.9,4.8h78c3,0,5.4-2.2,5.9-5.1 c0-0.1,0.1-0.2,0.1-0.4c0,0,0-0.1,0-0.1l0.1-0.3c0,0,0,0,0-0.1l9.9-53.6l0.1-0.2V34c0-3.3-2.7-6-6-6v-6c0-3.3-2.7-6-6-6H36.1 c0,0,0,0-0.1,0c-0.1,0-0.2-0.2-0.6-0.6c-0.5-0.6-1.1-1.5-1.7-2.5c-0.6-1-1.3-2.1-2.1-3C30.9,9,29.7,8,28.1,8L6.1,8z M6.1,12h22 c-0.1,0,0.1,0,0.6,0.6c0.5,0.6,1.1,1.5,1.7,2.5c0.6,1,1.3,2.1,2.1,3c0.8,0.9,1.9,1.9,3.6,1.9h52c1.1,0,2,0.9,2,2v6h-74 c-3.1,0-5.7,2.5-5.9,5.6h-0.1L10.1,34l-6,32.4V14C4.1,12.9,4.9,12,6.1,12z M16.1,32h78c1.1,0,2,0.9,2,2l-9.8,53.1l-0.1,0.1 c0,0.1,0,0.2-0.1,0.2c0,0.1,0,0.2-0.1,0.2c0,0,0,0.1,0,0.1c0,0,0,0,0,0.1c0,0.1,0,0.2-0.1,0.3c0,0.1,0,0.1,0,0.2 c0,0.1,0,0.2,0,0.2c-0.3,0.8-1,1.4-1.9,1.4h-78c-1.1,0-2-0.9-2-2L14,34.4l0.1-0.2V34C14.1,32.9,14.9,32,16.1,32L16.1,32z"></path></svg>',yt='<svg viewBox="0 0 100 100" class="forward-arrow" width="16" height="16"><path fill="currentColor" stroke="currentColor" d="m9.9,89.09226c-0.03094,0 -0.05414,0 -0.08508,0c-1.06734,-0.04641 -1.91039,-0.92812 -1.89492,-1.99547c0.00774,-0.48726 1.14469,-48.13101 47.52,-49.44586l0,-13.89094c0,-0.7657 0.44086,-1.4618 1.12922,-1.78664c0.68062,-0.33258 1.5082,-0.23203 2.09601,0.2475l31.68,25.74c0.46406,0.37899 0.73476,0.9436 0.73476,1.53914c0,0.59555 -0.2707,1.16016 -0.72703,1.53914l-31.68,25.74c-0.59555,0.47953 -1.41539,0.57234 -2.10375,0.2475c-0.68836,-0.32485 -1.12922,-1.02094 -1.12922,-1.78664l0,-13.84453c-41.26289,0.75024 -43.49039,24.81961 -43.56773,25.85601c-0.06961,1.04414 -0.93586,1.84078 -1.97226,1.84078z"></path></svg>',Ae='<svg viewBox="0 0 100 100" class="hashtag" width="17" height="17"><path fill="currentColor" stroke="currentColor" d="M36,18l-1.5,16H20l-0.4,4h14.5l-2.4,26H17.2l-0.4,4h14.5L30,82h4l1.3-14h26L60,82h4l1.3-14h15.5l0.4-4H65.7l2.4-26h15.5 l0.4-4H68.5L70,18h-4l-1.5,16h-26L40,18L36,18z M38.1,38h26l-2.4,26h-26L38.1,38z"></path></svg>',Te='<svg viewBox="0 0 100 100" class="links-going-out" width="15" height="15"><path fill="currentColor" stroke="currentColor" d="M76.4,11.7c3.7,3.8,5.6,8.9,5,14.3c-0.5,4-2.4,7.6-5.2,10.5c-2.6,2.6-6.7,6.7-9.2,9.2c-2,2-4.4,3.6-7.1,4.5 c-4.5,1.4-9,1-12.8-0.9l2.9-2.9c1.4,0.5,3,0.8,4.5,0.8c3.6,0,7-1.4,9.5-3.9l9.6-9.6c3.3-3.3,4.7-8.1,3.5-13 c-0.3-1.2-0.8-2.4-1.5-3.5C73,13,68.7,10.6,64,10.6c-3.6,0-7,1.4-9.5,3.9L45,24c-2.5,2.5-3.9,5.9-3.9,9.5c0,1.6,0.3,3.1,0.8,4.5 l-3,3c-1.1-2.3-1.7-4.8-1.7-7.5c0-0.7,0-1.4,0.1-2.1c0.5-3.8,2.2-7.4,5-10.2l9.4-9.4C54.5,9,58.2,7,62.1,6.6 C67.5,6.1,72.6,7.9,76.4,11.7L76.4,11.7z M54.4,34.7c0.3,0.7,0.1,1.6-0.4,2.1L30.9,59.9c-0.5,0.5-1.2,0.7-1.9,0.5 s-1.2-0.7-1.4-1.4s0-1.4,0.5-1.9L51.2,34c0.3-0.4,0.8-0.6,1.3-0.6C53.4,33.5,54.1,34,54.4,34.7z M35.1,44.9l-2.9,2.9 c-1.4-0.5-3-0.8-4.5-0.8c-3.6,0-7,1.4-9.5,3.9l-9.6,9.6c-3.3,3.4-4.7,8.1-3.5,13c0.3,1.2,0.8,2.4,1.5,3.5 c2.6,4.2,6.9,6.6,11.6,6.6c3.6,0,7-1.4,9.5-3.9l9.6-9.6c2.5-2.5,3.9-5.9,3.9-9.5c0-1.6-0.3-3.1-0.8-4.5l2.9-2.9 c1.1,2.3,1.7,4.8,1.7,7.5c0,3-0.8,5.9-2.2,8.5c-0.8,1-1.5,1.9-2.1,2.9c-0.3,0.3-0.5,0.6-0.8,0.8l-9.4,9.4 c-2.9,2.9-6.6,4.8-10.6,5.2c-6.2,0.6-12-1.9-15.8-6.9c-2.4-3.2-3.6-7.2-3.4-11.2c0-0.1,0-0.2,0-0.3c0.3-4.2,2-8.1,5-11.1l9.4-9.4 c2-2,4.4-3.6,7.1-4.5C26.8,42.6,31.3,43,35.1,44.9L35.1,44.9z"></path><path fill="currentColor" stroke="currentColor" d="M99.2,69.3c0-0.2,0-0.2,0-0.4c0-0.2,0-0.2,0-0.4s0-0.2-0.2-0.4c0-0.2,0-0.2-0.2-0.4l0,0l-0.2-0.2l-0.2-0.2L79.2,53 c-0.6-0.4-1.3-0.6-1.9-0.2c-0.8,0.4-1.2,1-1.2,1.7V62c-8.1,0.4-14.6,3.1-19.2,8.1c-8.5,9-7.7,22.5-7.7,23.1c0,0.2,0,0.2,0,0.4 c0,0.2,0,0.2,0,0.4s0.2,0.2,0.2,0.4l0.2,0.2c0.2,0.2,0.2,0.2,0.4,0.2l0.2,0.2c0.2,0,0.4,0,0.6,0.2H51l0,0l0,0c0,0,0,0,0.2,0 s0.2,0,0.4,0s0.2,0,0.4-0.2c0.2,0,0.2-0.2,0.4-0.2s0.2-0.2,0.4-0.2c0,0,0.2-0.2,0.2-0.4c0-0.2,0.2-0.2,0.2-0.4s0-0.2,0-0.4 c0-0.2,0-0.2,0-0.4c0-0.8,0.6-16.6,23.1-17.5v7.3c0,0.8,0.4,1.3,1,1.7c0.6,0.4,1.3,0.2,1.9-0.2l19.2-14l0.2-0.2l0.2-0.2l0,0 c0-0.2,0.2-0.2,0.2-0.4L99.2,69.3L99.2,69.3z"></path></svg>',Pe='<svg viewBox="0 0 100 100" class="bullet-list" width="15" height="15"><path fill="currentColor" stroke="currentColor" d="M16.4,16.4c-3.5,0-6.4,2.9-6.4,6.4s2.9,6.4,6.4,6.4s6.4-2.9,6.4-6.4S19.9,16.4,16.4,16.4z M16.4,19.6 c1.8,0,3.2,1.4,3.2,3.2c0,1.8-1.4,3.2-3.2,3.2s-3.2-1.4-3.2-3.2C13.2,21,14.6,19.6,16.4,19.6z M29.2,21.2v3.2H90v-3.2H29.2z M16.4,43.6c-3.5,0-6.4,2.9-6.4,6.4s2.9,6.4,6.4,6.4s6.4-2.9,6.4-6.4S19.9,43.6,16.4,43.6z M16.4,46.8c1.8,0,3.2,1.4,3.2,3.2 s-1.4,3.2-3.2,3.2s-3.2-1.4-3.2-3.2S14.6,46.8,16.4,46.8z M29.2,48.4v3.2H90v-3.2H29.2z M16.4,70.8c-3.5,0-6.4,2.9-6.4,6.4 c0,3.5,2.9,6.4,6.4,6.4s6.4-2.9,6.4-6.4C22.8,73.7,19.9,70.8,16.4,70.8z M16.4,74c1.8,0,3.2,1.4,3.2,3.2c0,1.8-1.4,3.2-3.2,3.2 s-3.2-1.4-3.2-3.2C13.2,75.4,14.6,74,16.4,74z M29.2,75.6v3.2H90v-3.2H29.2z"></path></svg>',as=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="M4 22h14a2 2 0 0 0 2-2V7.5L14.5 2H6a2 2 0 0 0-2 2v3"></path>
  <polyline points="14 2 14 8 20 8"></polyline>
  <path d="M5 17a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"></path>
  <path d="m9 18-1.5-1.5"></path>
</svg>`,os=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
</svg>`,ls='<svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 20 20"><g fill="none"><path d="M10.32 2.013A4 4 0 0 0 6.162 7.13l-3.987 3.986a.6.6 0 0 0-.176.424V14.4a.6.6 0 0 0 .6.6h2.8a.6.6 0 0 0 .6-.6V13h1.9a.6.6 0 0 0 .6-.6v-1.693l.735-.735a5.51 5.51 0 0 1-.569-.846l-.99.991a.6.6 0 0 0-.176.424V12H5.6a.6.6 0 0 0-.6.6V14H3v-2.293l4.32-4.32l-.118-.303a3.001 3.001 0 0 1 1.96-3.965c.33-.423.72-.796 1.157-1.106zM13.5 6.25a.75.75 0 1 0 0-1.5a.75.75 0 0 0 0 1.5zM9 6.5a4.5 4.5 0 1 1 7 3.742v2.05l.783.784a.6.6 0 0 1 0 .848L15.707 15l1.068 1.067a.6.6 0 0 1-.05.893l-2.35 1.88a.6.6 0 0 1-.75 0l-2.4-1.92a.6.6 0 0 1-.225-.468v-6.21A4.496 4.496 0 0 1 9 6.5zM13.5 3a3.5 3.5 0 0 0-1.75 6.532a.5.5 0 0 1 .25.433v6.295l2 1.6l1.751-1.401l-1.034-1.035a.6.6 0 0 1 0-.848l1.076-1.076l-.617-.617a.6.6 0 0 1-.176-.424V9.965a.5.5 0 0 1 .25-.433A3.5 3.5 0 0 0 13.5 3z" fill="currentColor"></path></g></svg>',De='<svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 20 20"><g fill="none"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5a2 2 0 0 0-2-2zm0 16H5V7h14v12zm-5.5-6c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5s1.5.67 1.5 1.5zM12 9c-2.73 0-5.06 1.66-6 4c.94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4zm0 6.5a2.5 2.5 0 0 1 0-5a2.5 2.5 0 0 1 0 5z" fill="currentColor"></path></g></svg>',cs='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="16" viewBox="0 0 20 20"><g fill="none"><path d="M11 6H9V4h2v2zm4-2h-2v2h2V4zM9 14h2v-2H9v2zm10-4V8h-2v2h2zm0 4v-2h-2v2h2zm-6 0h2v-2h-2v2zm6-10h-2v2h2V4zm-6 4V6h-2v2h2zm-6 2V8h2V6H7V4H5v16h2v-8h2v-2H7zm8 2h2v-2h-2v2zm-4-2v2h2v-2h-2zM9 8v2h2V8H9zm4 2h2V8h-2v2zm2-4v2h2V6h-2z" fill="currentColor"></path></g></svg>';function O(n){var t;(t=activeWindow.activeDocument.querySelector(".modal-bg"))==null||t.addClass("another-quick-switcher__floating-modal-bg");let i=activeWindow.activeDocument.querySelector(".prompt");i==null||i.addClass("another-quick-switcher__floating-prompt");let e=n.getFileViewInActiveLeaf();if(e){let s=activeWindow.innerWidth,r=activeWindow.innerHeight,a=activeWindow.activeDocument.querySelector(".another-quick-switcher__floating-prompt");if(!a){console.error("Unexpected error.");return}let l=e.getState().mode==="preview"?".markdown-preview-sizer":".cm-sizer",c=e.contentEl.querySelector(l);if(!c){console.error("Unexpected error.");return}let{width:o,height:u}=a.getBoundingClientRect(),{x:h,width:d}=c.getBoundingClientRect(),{y:m}=e.containerEl.getBoundingClientRect(),{y:p}=i.getBoundingClientRect(),g=h+d,y=s-g-30>o?g-30:h-o-30>0?h-o:s-o-30,v=Math.min(r-u-10,m+p);i==null||i.setAttribute("style",`left: ${y}px; top: ${v}px`)}}function ae(n){return n!=null}function us(n,i){let e=10**i;return Math.round(n*e)/e}function di(n){if(n.length===0)return[];let i=[...n].sort((s,r)=>s.start-r.start),e=[],t=i[0];for(let s=1;s<i.length;s++){let r=i[s];r.start<=t.end+1?t={start:t.start,end:Math.max(t.end,r.end)}:(e.push(t),t=r)}return e.push(t),e}function Me(n,i){let e=document.createDocumentFragment();if(!i||i.length===0)return e.appendChild(document.createTextNode(n)),e;let t=di(i),s=-1;for(let r of t){if(r.start>s+1){let l=n.slice(s+1,r.start);if(l){let c=createSpan({text:l});e.appendChild(c)}}let a=n.slice(r.start,r.end+1);if(a){let l=createSpan({cls:"another-quick-switcher__hit_word",text:a});e.appendChild(l)}s=r.end}if(s+1<n.length){let r=n.slice(s+1);if(r){let a=createSpan({text:r});e.appendChild(a)}}return e}function gi(n,i,e,t){var d,m;let s=createDiv({cls:["another-quick-switcher__item",t.selected?"another-quick-switcher__item__selected":"",n.phantom?"another-quick-switcher__phantom_item":"",n.starred?"another-quick-switcher__starred_item":"",t.hideGutterIcons?"another-quick-switcher__gutter_hidden":""].filter(p=>p),attr:{extension:n.file.extension}}),r=createDiv({cls:"another-quick-switcher__item__entry"}),a=createDiv({cls:["another-quick-switcher__item__title","another-quick-switcher__custom__item__title"]}),l=i.length>0&&(t.displayAliaseAsTitle||!e&&t.displayAliasAsTitleOnKeywordMatched),c=l?i.join(" | "):n.file.basename,o=[];for(let p of n.matchResults)if(l){if(p.allAliasRanges)for(let g of i){let y=p.allAliasRanges.find(v=>v.alias===g);if(y){let v=i.slice(0,i.indexOf(g)).reduce((b,k)=>b+k.length+3,0);for(let b of y.ranges)o.push({start:b.start+v,end:b.end+v})}}}else p.ranges&&o.push(...p.ranges);l&&a.insertAdjacentHTML("beforeend",yt);let u=Me(c,o.length>0?o:void 0);a.appendChild(u),r.appendChild(a);let h=Y(n.file);if(n.file.extension!=="md"||h){let p=createDiv({cls:"another-quick-switcher__item__extension",text:h?"excalidraw":n.file.extension});a.appendChild(p)}if(n.order<9){let p=createSpan({cls:"another-quick-switcher__item__hot-key-guide",text:`${n.order+1}`});r.appendChild(p)}if(t.showDirectory){let p=createDiv({cls:"another-quick-switcher__item__directory"});p.insertAdjacentHTML("beforeend",P);let g=t.showFullPathOfDirectory?(d=n.file.parent)==null?void 0:d.path:(m=n.file.parent)==null?void 0:m.name;if(p.appendText(` ${g}`),r.appendChild(p),t.showDirectoryAtNewLine)return s.appendChild(r),s.appendChild(p),s}return s.appendChild(r),s}function mi(n){var r,a,l;let{frontMatter:i,options:e,frontMatterRanges:t}=n,s=createDiv({cls:"another-quick-switcher__item__metas"});if(e.displayDescriptionBelowTitle&&i.description){let c=createDiv({cls:"another-quick-switcher__item__meta"}),o=createSpan({cls:"another-quick-switcher__item__meta__description"}),u=String(i.description),h=Me(u,(a=(r=t==null?void 0:t.description)==null?void 0:r.at(0))!=null?a:[]);o.appendChild(h),c.appendChild(o),s.appendChild(c)}if(e.showFuzzyMatchScore&&n.score>0){let c=createDiv({cls:"another-quick-switcher__item__meta"}),o=createSpan({cls:"another-quick-switcher__item__meta__score"});o.insertAdjacentHTML("beforeend",cs),o.appendText(String(n.score)),c.appendChild(o),s.appendChild(c)}if(e.showFrontMatter&&Object.keys(i).length>0){let c=createDiv({cls:"another-quick-switcher__item__meta"});for(let[o,u]of Object.entries(i)){if(o==="description"&&e.displayDescriptionBelowTitle)continue;let h=createDiv({cls:"another-quick-switcher__item__meta__front_matter",title:`${o}: ${u}`});h.insertAdjacentHTML("beforeend",ls),h.createSpan({cls:"another-quick-switcher__item__meta__front_matter__key",title:o,text:o});let d=createDiv({cls:"another-quick-switcher__item__meta__front_matter__values"}),m=Array.isArray(u)?u:[u];for(let p=0;p<m.length;p++){let g=m[p];if(g==null)continue;let y=Me(g.toString(),(l=t==null?void 0:t[o])==null?void 0:l.at(p)),v=d.createSpan({cls:"another-quick-switcher__item__meta__front_matter__value"});v.appendChild(y),d.appendChild(v)}h.appendChild(d),c.appendChild(h)}s.appendChild(c)}return s}function fi(n){let{item:i,aliases:e,tags:t,countByLink:s,countByHeader:r,linkResultsNum:a,headerResultsNum:l,isTitleMatched:c,options:o}=n,u=createDiv({cls:"another-quick-switcher__item__descriptions"}),h=!c&&o.displayAliasAsTitleOnKeywordMatched||o.displayAliaseAsTitle;if(e.length>0){let d=createDiv({cls:"another-quick-switcher__item__description"}),m=h?[i.file.basename]:e;for(let p of m){let g=createSpan({cls:"another-quick-switcher__item__description__alias"});g.insertAdjacentHTML("beforeend",h?rs:yt);let y=[];for(let k of i.matchResults)if(h){if(k.ranges)for(let f of k.ranges)y.push(f)}else if(k.allAliasRanges)for(let f of k.allAliasRanges)f.alias===p&&y.push(...f.ranges);let v=Me(p,y),b=createSpan({cls:"another-quick-switcher__item__description__alias__inner"});b.appendChild(v),g.appendChild(b),d.appendChild(g)}u.appendChild(d)}if(t.length>0){let d=createDiv({cls:"another-quick-switcher__item__description"});for(let m of t){let p=createSpan({cls:"another-quick-switcher__item__description__tag"});p.insertAdjacentHTML("beforeend",Ae),p.appendText(m.replace("#","")),d.appendChild(p)}u.appendChild(d)}if(Object.keys(s).length>0){let d=createDiv({cls:"another-quick-switcher__item__description"}),m=Object.entries(s).map(([p,g])=>({link:p,n:g})).sort((p,g)=>g.n-p.n);for(let{link:p,n:g}of m){let y=createSpan({cls:["another-quick-switcher__item__description__link",g!==a?"another-quick-switcher__item__description__link__dimmed":""]});y.insertAdjacentHTML("beforeend",Te),y.appendChild(createSpan({text:p,attr:{style:"padding-left: 3px"}})),d.appendChild(y)}u.appendChild(d)}if(Object.keys(r).length>0){let d=createDiv({cls:"another-quick-switcher__item__description"}),m=Object.entries(r).map(([p,g])=>({header:p,n:g})).sort((p,g)=>g.n-p.n);for(let{header:p,n:g}of m){let y=createSpan({cls:["another-quick-switcher__item__description__header",g!==l?"another-quick-switcher__item__description__header__dimmed":""]});y.insertAdjacentHTML("beforeend",Pe),y.appendChild(createSpan({text:p,attr:{style:"padding-left: 3px"}})),d.appendChild(y)}u.appendChild(d)}return u}function hs(n,i){var k;let{title:e,aliases:t}=_e(n),s=!!e,r=i.displayAliaseAsTitle?n.aliases:t,a=gi(n,r,s,i),l=se((k=n.frontMatter)!=null?k:{},(f,E)=>i.excludeFrontMatterKeys.includes(f)||E==null),c=us(Math.max(...n.matchResults.map(f=>{var E;return(E=f.score)!=null?E:0})),6),o=n.matchResults.filter(f=>f.type==="property").map(f=>f.frontMatterRanges).filter(ae).reduce((f,E)=>{var K,M,H;for(let[J,pe]of Object.entries(E)){(K=f[J])!=null||(f[J]=[]);for(let T=0;T<pe.length;T++){let ke=pe[T];ke!=null&&((H=(M=f[J])[T])!=null||(M[T]=[]),f[J][T].push(ke))}}return f},{}),u=Object.keys(l).length>0||c>0?mi({frontMatter:l,frontMatterRanges:o,score:c,options:i}):void 0,h=Ee(n.matchResults.filter(f=>f.type==="tag"),f=>{var E;return(E=f.meta)!=null?E:[]}),d=n.matchResults.filter(f=>f.type==="link"),m=d.length,p=it(d.flatMap(f=>{var E;return q((E=f.meta)!=null?E:[])})),g=n.matchResults.filter(f=>f.type==="header"),y=g.length,v=it(g.flatMap(f=>{var E;return q((E=f.meta)!=null?E:[])})),b=r.length!==0||h.length!==0||Object.keys(p).length!==0||Object.keys(v).length!==0?fi({item:n,aliases:r,tags:h,countByLink:p,countByHeader:v,linkResultsNum:m,headerResultsNum:y,isTitleMatched:s,options:i}):void 0;return{itemDiv:a,metaDiv:u,descriptionDiv:b}}var ps={query:""},He=class n extends Q{constructor(e){var t;super(e.app);this.willSilentClose=!1;this.historyRestoreStatus="initial";this.isClosed=new Promise(e=>{this.markClosed=e});this.modalEl.addClass("another-quick-switcher__modal-prompt"),this.appHelper=new x(e.app),this.settings=e.settings,this.logger=z.of(this.settings),this.initialCommand=e.command,this.command=e.command,this.originFile=e.originFile,this.floating=e.command.floating,this.initialInputQuery=e.inputQuery,this.navigationHistories=e.navigationHistories,this.currentNavigationHistoryIndex=e.currentNavigationHistoryIndex,this.stackHistory=e.stackHistory,this.initialLeaf=e.initialLeaf,this.stateToRestore=e.initialState,this.navQueue=(t=e.navQueue)!=null?t:Promise.resolve(),this.limit=this.settings.maxNumberOfSuggestions,this.setHotkeys(),this.phantomItems=this.settings.showExistingFilesOnly?[]:this.appHelper.searchPhantomFiles().map(s=>({file:s,aliases:[],tags:[],headers:[],links:[],phantom:!0,starred:!1,matchResults:[],tokens:s.basename.split(" ")})),this.indexingItems(),this.debounceGetSuggestions=(0,A.debounce)((s,r)=>{r(this._getSuggestions(s))},this.settings.searchDelayMilliSeconds,!0)}toKey(e){return e.file.path}close(){A.Platform.isMobile&&this.onClose(),super.close()}safeClose(){return this.close(),this.isClosed}silentClose(){this.willSilentClose=!0,this.close()}onOpen(){var e,t;this.isOpen=!0,this.inputEl.value=this.command.restoreLastInput?(e=this.initialInputQuery)!=null?e:ps.query:(t=this.initialInputQuery)!=null?t:"",this.inputEl.select(),this.updateSuggestions(),this.command.floating&&this.enableFloating(),this.stackHistory&&this.navigationHistories.push({inputQuery:this.inputEl.value,command:{...this.command},originFile:this.originFile}),this.opened=!0}onClose(){super.onClose(),!this.willSilentClose&&(this.command.restoreLastInput&&(ps.query=this.inputEl.value),this.stateToRestore&&this.navigate(()=>this.stateToRestore.restore()),this.navigate(this.markClosed))}enableFloating(){this.floating=!0,A.Platform.isPhone||O(this.appHelper)}indexingItems(){var a;let e=It(this.appHelper.getStarredFilePaths(),l=>l),t=(a=this.originFile)==null?void 0:a.path,s=performance.now(),r=this.app.vault.getFiles().filter(l=>(this.command.includeCurrentFile||l.path!==t)&&this.app.metadataCache.getFileCache(l)).map(l=>{var o,u,h,d,m,p;let c=this.app.metadataCache.getFileCache(l);return{file:l,aliases:(o=(0,A.parseFrontMatterAliases)(c.frontmatter))!=null?o:[],tags:this.command.searchBy.tag?q([...((u=c.tags)!=null?u:[]).map(g=>g.tag),...(h=(0,A.parseFrontMatterTags)(c.frontmatter))!=null?h:[]]):[],headers:this.command.searchBy.header?((d=c.headings)!=null?d:[]).map(g=>re(g.heading)):[],links:this.command.searchBy.link?q([...(m=c.links)!=null?m:[],...(p=c.frontmatterLinks)!=null?p:[]].map(g=>{var y;return(y=g.displayText)!=null?y:""})):[],frontMatter:(this.command.showFrontMatter||this.command.searchBy.property)&&c.frontmatter?se(c.frontmatter,(g,y)=>g==="position"):void 0,phantom:!1,starred:l.path in e,matchResults:[],tokens:l.basename.split(" ")}});this.logger.showDebugLog("Indexing file items: ",s),this.originItems=[...r,...this.phantomItems],s=performance.now(),this.ignoredItems=this.prefilterItems(this.command),this.logger.showDebugLog("Prefilter items: ",s)}prefilterItems(e){return((s,r)=>{let a=this.originItems;switch(e.targetExtensions.length>0&&(a=a.filter(l=>e.targetExtensions.includes(l.file.extension))),e.searchTarget){case"file":break;case"opened file":{let l=this.appHelper.getFilePathsInActiveWindow();a=a.filter(c=>l.includes(c.file.path));break}case"backlink":{let l=this.appHelper.createBacklinksMap();a=a.filter(c=>{var o,u,h;return(h=l[(u=(o=this.originFile)==null?void 0:o.path)!=null?u:""])==null?void 0:h.has(c.file.path)});break}case"link":{let l=this.originFile?this.appHelper.createLinksMap(this.originFile):{};a=a.filter(c=>l[c.file.path]).sort(I(c=>{let o=l[c.file.path];return ee(o)?-1:o.position.start.offset}));break}case"2-hop-link":{let l=this.appHelper.createBacklinksMap(),c=this.originFile?this.appHelper.createLinksMap(this.originFile):{},o=a.filter(d=>c[d.file.path]).map(d=>d.file.path),u=o.flatMap(d=>Array.from(l[d])),h=q([...o,...u]);a=a.filter(d=>h.includes(d.file.path)).sort(I(d=>{let m=c[d.file.path];return!m||ee(m)?65535:m.position.start.offset}));break}}return s.length>0&&(a=At(a,s,l=>l.file.path)),r.length>0&&(a=Se(a,r,l=>l.file.path)),a})(e.includePrefixPathPatterns.map(s=>s.replace(/<current_dir>/g,this.appHelper.getCurrentDirPath())),e.excludePrefixPathPatterns.map(s=>s.replace(/<current_dir>/g,this.appHelper.getCurrentDirPath())))}getSuggestions(e){return!e||e===this.command.defaultInput||!this.opened?this._getSuggestions(e):new Promise(t=>{this.debounceGetSuggestions(e,s=>{t(s)})})}_getSuggestions(e){var u;let t=performance.now(),s={};this.app.workspace.getLastOpenFiles().forEach((h,d)=>{s[h]=d});let r=this.settings.searchCommands.filter(h=>h.commandPrefix).find(h=>e.startsWith(h.commandPrefix));(r||this.initialCommand!==this.command)&&r!==this.command&&(this.command=r!=null?r:this.initialCommand,this.indexingItems()),this.searchQuery=e.startsWith(this.command.commandPrefix)?e.replace(this.command.commandPrefix,""):e,this.command.defaultInput&&(this.searchQuery=`${this.command.defaultInput}${this.searchQuery}`),this.searchQuery=this.searchQuery.replace(/<cd>/g,this.appHelper.getCurrentDirPath()),this.renderInputComponent();let a=W(this.searchQuery);if(this.command.searchTarget==="backlink"&&!((u=this.originFile)!=null&&u.path))return[];let l=!this.searchQuery.trim(),c=l?this.ignoredItems:this.ignoredItems.map(h=>Gt(h,a,{isNormalizeAccentsDiacritics:this.settings.normalizeAccentsAndDiacritics,searchByHeaders:this.command.searchBy.header,searchByLinks:this.command.searchBy.link,searchByTags:this.command.searchBy.tag,keysOfPropertyToSearch:this.command.searchBy.property?this.command.keysOfPropertyToSearch:[],fuzzyTarget:this.command.allowFuzzySearchForSearchTarget,minFuzzyScore:this.command.minFuzzyMatchScore,excludePrefix:this.settings.searchesExcludePrefix})).filter(h=>h.matchResults.every(d=>d.type!=="not found")),o=Yt(c,l?Xt(this.command.sortPriorities):this.command.sortPriorities,s);return this.logger.showDebugLog(`Get suggestions: ${this.searchQuery} (${this.command.name})`,t),this.countInputEl=createDiv({text:`${Math.min(o.length,this.limit)} / ${o.length}`,cls:"another-quick-switcher__status__count-input"}),this.inputEl.before(this.countInputEl),o.slice(0,this.limit).map((h,d)=>({...h,order:d}))}renderInputComponent(){var r,a,l,c;(r=this.navigationHistoryEl)==null||r.remove(),(a=this.searchCommandEl)==null||a.remove(),(l=this.defaultInputEl)==null||l.remove(),(c=this.countInputEl)==null||c.remove(),this.navigationHistoryEl=createDiv({cls:"another-quick-switcher__custom-search__navigation-history-header"});let e=this.currentNavigationHistoryIndex;e>0&&this.navigationHistoryEl.appendText(`${e} < `),this.navigationHistoryEl.appendText(this.originFile?this.originFile.basename:"No file");let t=this.navigationHistories.length-this.currentNavigationHistoryIndex-1;t>0&&this.navigationHistoryEl.appendText(` > ${t}`),this.inputEl.before(this.navigationHistoryEl),this.searchCommandEl=createDiv({cls:"another-quick-switcher__status__search-command"}),this.searchCommandEl.insertAdjacentHTML("beforeend",as),this.searchCommandEl.createSpan({text:this.command.name,cls:"another-quick-switcher__status__search-command-name"}),this.searchCommandEl.createSpan({cls:"another-quick-switcher__status__search-command-separator"}),this.command.searchBy.tag&&this.searchCommandEl.insertAdjacentHTML("beforeend",Ae),this.command.searchBy.header&&this.searchCommandEl.insertAdjacentHTML("beforeend",Pe),this.command.searchBy.link&&this.searchCommandEl.insertAdjacentHTML("beforeend",Te);let s=this.modalEl.find(".prompt-input-container");s&&s.setAttr("style","display: initial"),this.inputEl.before(this.searchCommandEl),this.command.defaultInput&&(this.defaultInputEl=createDiv({text:this.searchQuery,cls:"another-quick-switcher__status__default-input"}),this.defaultInputEl.insertAdjacentHTML("afterbegin",os),this.resultContainerEl.before(this.defaultInputEl))}renderSuggestion(e,t){let{itemDiv:s,metaDiv:r,descriptionDiv:a}=hs(e,{showFrontMatter:this.command.showFrontMatter,excludeFrontMatterKeys:this.command.excludeFrontMatterKeys,showDirectory:this.settings.showDirectory,showDirectoryAtNewLine:this.settings.showDirectoryAtNewLine,showFullPathOfDirectory:this.settings.showFullPathOfDirectory,displayAliasAsTitleOnKeywordMatched:this.settings.showAliasesOnTop,displayAliaseAsTitle:this.settings.displayAliaseAsTitle,displayDescriptionBelowTitle:this.settings.displayDescriptionBelowTitle,hideGutterIcons:this.settings.hideGutterIcons,showFuzzyMatchScore:this.settings.showFuzzyMatchScore,selected:!!this.selectedItemMap[this.toKey(e)]});r!=null&&r.hasChildNodes()&&s.appendChild(r),a!=null&&a.hasChildNodes()&&s.appendChild(a),t.appendChild(s)}onNoSuggestion(){super.onNoSuggestion();let e=createDiv({cls:"another-quick-switcher__command_buttons"}),t=createEl("button",{text:"Create",cls:"another-quick-switcher__command_button"});t.addEventListener("click",()=>this.handleCreateNewMarkdown(this.searchQuery,"same-tab")),e.appendChild(t);let s=createEl("button",{text:"Search in google",cls:"another-quick-switcher__command_button"});s.addEventListener("click",()=>{activeWindow.open(`https://www.google.com/search?q=${this.searchQuery}`),this.close()}),e.appendChild(s),this.resultContainerEl.appendChild(e)}navigate(e){this.navQueue=this.navQueue.then(e)}async chooseCurrentSuggestion(e,t={}){var c,o,u,h,d;let s=this.getSelectedItem();if(!s)return null;let r=s.file;s.phantom&&(r=await this.app.vault.create(s.file.path,""));let a,l;switch(this.command.searchTarget){case"file":if(((c=s.matchResults[0])==null?void 0:c.type)==="header"){let m=s.matchResults[0].meta[0];a=(o=this.appHelper.findFirstHeaderOffset(s.file,m))!=null?o:void 0}break;case"opened file":if(((u=s.matchResults[0])==null?void 0:u.type)==="header"){let m=s.matchResults[0].meta[0];a=(h=this.appHelper.findFirstHeaderOffset(s.file,m))!=null?h:void 0}this.appHelper.getFilePathsInActiveWindow,l=this.appHelper.findLeaf(r);break;case"backlink":a=this.appHelper.findFirstLinkOffset(s.file,this.originFile);break;case"link":break;case"2-hop-link":break;default:throw new j(this.command.searchTarget)}return t.keepOpen?e==="same-tab"&&((d=this.stateToRestore)!=null||(this.stateToRestore=this.appHelper.captureState(this.initialLeaf))):(this.close(),this.navigate(()=>this.isClosed)),this.navigate(()=>this.appHelper.openFile(r,{leafType:e,offset:a,inplace:t.keepOpen,preventDuplicateTabs:this.settings.preventDuplicateTabs,leafPriorToSameTab:l},this.stateToRestore)),r}async onChooseSuggestion(e,t){await this.chooseCurrentSuggestion(te(t))}async handleCreateNewMarkdown(e,t){if(!e)return!0;let s=await this.appHelper.createMarkdown(this.searchQuery);return s?(this.close(),this.navigate(()=>this.isClosed),this.navigate(()=>this.appHelper.openFile(s,{leafType:t})),!1):(new A.Notice("This file already exists."),!0)}registerKeys(e,t){var s;for(let r of(s=this.settings.hotkeys.main[e])!=null?s:[])this.scope.register(r.modifiers,B(R(r.key)),a=>{if(!a.isComposing)return a.preventDefault(),t(),!1})}async toFileToOpened(e){let t=e.file;return e.phantom&&(t=await this.app.vault.create(e.file.path,"")),t}setHotkeys(){this.scope.unregister(this.scope.keys.find(c=>c.key==="Enter")),this.scope.unregister(this.scope.keys.find(c=>c.key==="Escape")),this.scope.unregister(this.scope.keys.find(c=>c.key==="Home")),this.scope.unregister(this.scope.keys.find(c=>c.key==="End"));let e=U(this.settings.userAltInsteadOfModForQuickResultSelection);this.settings.hideHotkeyGuides||this.setInstructions([{command:"[\u2191]",purpose:"up"},{command:"[\u2193]",purpose:"down"},{command:`[${e} 1~9]`,purpose:"open Nth"},...C(this.settings.hotkeys.main)]),this.registerKeys("up",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"}))}),this.registerKeys("down",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"}))}),this.registerKeys("clear input",()=>{this.inputEl.value="",this.inputEl.dispatchEvent(new Event("input"))}),this.registerKeys("replace input",()=>{this.chooser.values&&(this.inputEl.value=this.chooser.values[this.chooser.selectedItem].file.basename,this.inputEl.dispatchEvent(new Event("input")))}),this.registerKeys("open",async()=>{let c=this.getCheckedItems();if(c.length>0){this.close();for(let o of c)this.appHelper.openFile(await this.toFileToOpened(o),{leafType:"new-tab",preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("same-tab")}),this.registerKeys("open in new tab",async()=>{let c=this.getCheckedItems();if(c.length>0){this.close();for(let o of c)this.appHelper.openFile(await this.toFileToOpened(o),{leafType:"new-tab",preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("new-tab")}),this.registerKeys("open in new pane (horizontal)",async()=>{let c=this.getCheckedItems();if(c.length>0){this.close();for(let o of c)this.appHelper.openFile(await this.toFileToOpened(o),{leafType:"new-pane-horizontal",preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("new-pane-horizontal")}),this.registerKeys("open in new pane (vertical)",async()=>{let c=this.getCheckedItems();if(c.length>0){this.close();for(let o of c)this.appHelper.openFile(await this.toFileToOpened(o),{leafType:"new-pane-vertical",preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("new-pane-vertical")}),this.registerKeys("open in new window",async()=>{await this.chooseCurrentSuggestion("new-window")}),this.registerKeys("open in popup",async()=>{await this.chooseCurrentSuggestion("popup")}),this.registerKeys("open in new tab in background",async()=>{await this.chooseCurrentSuggestion("new-tab-background",{keepOpen:!0})}),this.registerKeys("open all in new tabs",()=>{this.close();let c=this.getItems();if(c)for(let o of c)this.appHelper.openFile(o.file,{leafType:"new-tab-background",preventDuplicateTabs:this.settings.preventDuplicateTabs})}),this.registerKeys("preview",()=>{this.floating||this.enableFloating(),this.chooseCurrentSuggestion("same-tab",{keepOpen:!0})}),this.registerKeys("create",async()=>{await this.handleCreateNewMarkdown(this.searchQuery,"same-tab")}),this.registerKeys("create in new tab",async()=>{await this.handleCreateNewMarkdown(this.searchQuery,"new-tab")}),this.registerKeys("create in new pane (horizontal)",async()=>{await this.handleCreateNewMarkdown(this.searchQuery,"new-pane-horizontal")}),this.registerKeys("create in new pane (vertical)",async()=>{await this.handleCreateNewMarkdown(this.searchQuery,"new-pane-vertical")}),this.registerKeys("create in new window",async()=>{await this.handleCreateNewMarkdown(this.searchQuery,"new-window")}),this.registerKeys("create in new popup",async()=>{await this.handleCreateNewMarkdown(this.searchQuery,"popup")}),this.registerKeys("check/uncheck",async()=>{await this.toggleCheckedItem()}),this.registerKeys("check/uncheck and next",async()=>{await this.toggleCheckedItem({moveNext:!0})}),this.registerKeys("check all",()=>{this.checkAll()}),this.registerKeys("uncheck all",()=>{this.uncheckAll()}),this.registerKeys("open in default app",()=>{this.actionMultiItems(c=>{this.appHelper.openFileInDefaultApp(c.file)}),this.close()}),this.registerKeys("show in system explorer",()=>{this.actionMultiItems(c=>{this.appHelper.openInSystemExplorer(c.file)}),this.close()}),this.registerKeys("open in google",()=>{activeWindow.open(`https://www.google.com/search?q=${this.searchQuery}`),this.close()}),this.registerKeys("open first URL",async()=>{this.close(),await this.isClosed,this.actionMultiItems(async(c,o)=>{let u=await this.appHelper.findExternalLinkUrls(c.file);u.length>0?activeWindow.open(u[0]):this.appHelper.openFile(c.file,{leafType:o==="select"?"same-tab":"new-tab"})})});let t=(c,o)=>{let u=this.settings.searchesAutoAliasTransform,{title:h,aliases:d}=_e(o);this.appHelper.insertLinkToActiveFileBy(c,{phantom:o.phantom,displayedString:this.settings.showAliasesOnTop?h!=null?h:d.at(0):void 0,aliasTranformer:u.enabled?{pattern:u.aliasPattern,format:u.aliasFormat}:void 0})},s=c=>{let o=this.settings.searchesAutoAliasTransform;this.appHelper.insertLinkToActiveFileBy(this.appHelper.createPhantomFile(c),{phantom:!0,aliasTranformer:o.enabled?{pattern:o.aliasPattern,format:o.aliasFormat}:void 0})};this.registerKeys("insert to editor",async()=>{let c=0;this.actionMultiItems(async(o,u)=>{switch(await this.safeClose(),u){case"select":this.appHelper.isActiveLeafCanvas()?this.appHelper.addFileToCanvas(o.file):t(o.file,o);break;case"check":if(this.appHelper.isActiveLeafCanvas()){let h=this.appHelper.addFileToCanvas(o.file,{x:c,y:0});c+=h.width+30}else t(o.file,o),this.appHelper.insertStringToActiveFile(`
`);break;default:throw new j(u)}},async()=>{s(this.searchQuery),await this.safeClose()})}),this.registerKeys("insert to editor in background",async()=>{var u;let c=(u=this.chooser.values)==null?void 0:u[this.chooser.selectedItem];if(!c)return;let o=c.file;o&&(this.historyRestoreStatus="doing",this.stateToRestore&&(await this.stateToRestore.restore(),this.stateToRestore=void 0),this.appHelper.isActiveLeafCanvas()?this.appHelper.addFileToCanvas(o):(t(o,c),this.appHelper.insertStringToActiveFile(`
`)))}),this.registerKeys("insert all to editor",async()=>{var o;await this.safeClose();let c=0;for(let u of(o=this.chooser.values)!=null?o:[])if(this.appHelper.isActiveLeafCanvas()){let h=this.appHelper.addFileToCanvas(u.file,{x:c,y:0});c+=h.width+30}else t(u.file,u),this.appHelper.insertStringToActiveFile(`
`)});let r=c=>{var h,d;let o=(d=(h=this.chooser.values)==null?void 0:h[this.chooser.selectedItem])==null?void 0:d.file;if(!o)return;this.silentClose(),new n({app:this.app,settings:this.settings,command:{...c,floating:this.floating},originFile:o,inputQuery:null,navigationHistories:[...this.navigationHistories.slice(0,this.currentNavigationHistoryIndex),{inputQuery:this.inputEl.value,command:{...this.command},originFile:this.originFile}],currentNavigationHistoryIndex:this.currentNavigationHistoryIndex+1,stackHistory:!0,initialLeaf:this.initialLeaf,initialState:this.stateToRestore,navQueue:this.navQueue}).open()};this.registerKeys("show links",()=>{r(Zt())}),this.registerKeys("show backlinks",()=>{r(es())}),this.registerKeys("show all results",()=>{this.limit=Number.MAX_SAFE_INTEGER,this.inputEl.dispatchEvent(new Event("input"))});let a=c=>{let o=this.navigationHistories[c];if(!o)return;this.silentClose(),new n({app:this.app,settings:this.settings,command:{...o.command,floating:this.floating},originFile:o.originFile,inputQuery:o.inputQuery,navigationHistories:this.navigationHistories,currentNavigationHistoryIndex:c,stackHistory:!1,initialState:this.stateToRestore,initialLeaf:this.initialLeaf,navQueue:this.navQueue}).open()};this.registerKeys("navigate back",()=>{a(this.currentNavigationHistoryIndex-1)}),this.registerKeys("navigate forward",()=>{a(this.currentNavigationHistoryIndex+1)}),this.registerKeys("close if opened",()=>{this.actionMultiItems(async(c,o)=>{this.appHelper.closeFile(c.file),o==="check"&&this.close()})});let l=this.settings.userAltInsteadOfModForQuickResultSelection?"Alt":"Mod";for(let c of[1,2,3,4,5,6,7,8,9])this.scope.register([l],String(c),o=>(this.chooser.setSelectedItem(c-1,o),this.chooseCurrentSuggestion("same-tab"),!1));this.registerKeys("launch grep",async()=>{let c=this.inputEl.value.trim();await this.safeClose(),await wt(this.app,this.settings,c||void 0)}),this.registerKeys("copy file vault path",async()=>{var o;let c=(o=this.chooser.values)==null?void 0:o[this.chooser.selectedItem];if(c)try{await navigator.clipboard.writeText(c.file.path),new A.Notice("Vault path copied to clipboard")}catch(u){new A.Notice("Failed to copy vault path to clipboard")}}),this.registerKeys("copy absolute file path",async()=>{var o;let c=(o=this.chooser.values)==null?void 0:o[this.chooser.selectedItem];if(c)try{let u=this.appHelper.getNormalizeVaultRootPath();await navigator.clipboard.writeText(`${u}/${c.file.path}`),new A.Notice("Absolute file path copied to clipboard")}catch(u){new A.Notice("Failed to copy absolute file path to clipboard")}}),this.registerKeys("dismiss",async()=>{this.close()})}};var ce=require("obsidian");var Le=class extends Q{constructor(e,t,s){super(e);this.lastOpenFileIndexByPath={};this.suggestions=[];this.isClosed=new Promise(e=>{this.markClosed=e});this.navQueue=Promise.resolve();this.modalEl.addClass("another-quick-switcher__modal-prompt"),this.vaultRootPath=V(this.app.vault.adapter.basePath),this.appHelper=new x(e),this.settings=t,this.logger=z.of(this.settings),this.initialLeaf=s,this.originFileBaseName=this.appHelper.getActiveFile().basename,this.originFileBaseNameRegExp=new RegExp(xe(this.originFileBaseName),"g"),this.limit=255,this.app.workspace.getLastOpenFiles().forEach((r,a)=>{this.lastOpenFileIndexByPath[r]=a}),this.setHotkeys(),this.debounceGetSuggestions=(0,ce.debounce)((r,a)=>{a(this._getSuggestions(r))},this.settings.searchDelayMilliSeconds,!0)}toKey(e){return`${e.file.path}:${e.lineNumber}`}async init(){await this.indexingItems()}onOpen(){var e;if(super.onOpen(),ce.Platform.isPhone||O(this.appHelper),this.opened=!0,this.settings.autoPreviewInBacklinkSearch){this.debouncePreview=(0,ce.debounce)(this.preview,this.settings.backlinkAutoPreviewDelayMilliSeconds,!0),this.debouncePreviewCancelListener=()=>{var s;(s=this.debouncePreview)==null||s.cancel()};let t=this.chooser.setSelectedItem.bind(this.chooser);this.chooser.setSelectedItem=(s,r)=>{var a;t(s,r),(a=this.debouncePreview)==null||a.call(this)},this.inputEl.addEventListener("keydown",this.debouncePreviewCancelListener),(e=this.debouncePreview)==null||e.call(this)}}close(){ce.Platform.isMobile&&this.onClose(),super.close()}onClose(){var e;super.onClose(),(e=this.debouncePreview)==null||e.cancel(),this.inputEl.removeEventListener("keydown",this.debouncePreviewCancelListener),this.stateToRestore&&this.navigate(()=>this.stateToRestore.restore()),this.navigate(this.markClosed)}async indexingItems(){let e=performance.now(),t=[],s=this.appHelper.getBacklinksByFilePathInActiveFile();if(s){for(let[r,a]of Object.entries(s)){let l=this.appHelper.getFileByPath(r);if(this.settings.backlinkExcludePrefixPathPatterns.some(o=>l.path.startsWith(o)))continue;let c=await this.app.vault.cachedRead(l);for(let o of a)t.push(ee(o)?{file:l,line:`<${o.key}: in properties>`,lineNumber:1,offset:0}:{file:l,line:c.split(`
`).at(o.position.start.line),lineNumber:o.position.start.line+1,offset:o.position.start.offset})}this.ignoredItems=be(t,r=>`${r.file.path}/${r.lineNumber}`),this.logger.showDebugLog("Indexing backlinks",e)}}getSuggestions(e){return!e||!this.opened?this._getSuggestions(e):new Promise(t=>{this.debounceGetSuggestions(e,s=>{t(s)})})}_getSuggestions(e){var l;let t=performance.now(),s=e.trim()==="",r=e.trim().split(" "),a=s?this.ignoredItems:this.ignoredItems.filter(c=>r.every(o=>S(c.file.path,o,this.settings.normalizeAccentsAndDiacritics)||S(c.line,o,this.settings.normalizeAccentsAndDiacritics)));return this.logger.showDebugLog(`Get suggestions: ${e}`,t),(l=this.countInputEl)==null||l.remove(),this.countInputEl=createDiv({text:`${Math.min(a.length,this.limit)} / ${a.length}`,cls:"another-quick-switcher__backlink__status__count-input"}),this.inputEl.before(this.countInputEl),this.suggestions=a.sort((c,o)=>_(c,o,u=>{var h;return(h=this.lastOpenFileIndexByPath[u.file.path])!=null?h:999999},"asc")).slice(0,this.limit).map((c,o)=>({...c,order:o})),this.suggestions}renderSuggestion(e,t){var m,p,g;let r=((m=this.suggestions[e.order-1])==null?void 0:m.file.path)===e.file.path,a=createDiv({cls:["another-quick-switcher__item",this.selectedItemMap[this.toKey(e)]?"another-quick-switcher__item__selected":""].filter(y=>y)}),l=createDiv({cls:"another-quick-switcher__item__entry"});if(!r){let y=createDiv({cls:["another-quick-switcher__item__title","another-quick-switcher__backlink__item__title_entry"],text:e.file.basename,attr:{extension:e.file.extension}}),v=Y(e.file);if(e.file.extension!=="md"||v){let b=createDiv({cls:"another-quick-switcher__item__extension",text:v?"excalidraw":e.file.extension});y.appendChild(b)}if(l.appendChild(y),a.appendChild(l),this.settings.showDirectory){let b=createDiv({cls:"another-quick-switcher__item__directory"});b.insertAdjacentHTML("beforeend",P);let k=this.settings.showFullPathOfDirectory?(p=e.file.parent)==null?void 0:p.path:(g=e.file.parent)==null?void 0:g.name;b.appendText(` ${k}`),l.appendChild(b),this.settings.showDirectoryAtNewLine&&a.appendChild(b)}}let c=createDiv({cls:"another-quick-switcher__item__descriptions"}),o=createDiv({cls:"another-quick-switcher__backlink__item__description"}),u=e.line,h=0,d=Array.from(u.matchAll(this.originFileBaseNameRegExp)).map(y=>y.index);for(let y of d){let v=u.slice(0,y-h);o.createSpan({text:N(v,this.settings.maxDisplayLengthAroundMatchedWord)}),o.createSpan({text:this.originFileBaseName,cls:"another-quick-switcher__hit_word"}),h=y-h+this.originFileBaseName.length,u=u.slice(h)}if(o.createSpan({text:N(u,this.settings.maxDisplayLengthAroundMatchedWord)}),e.order<9){let y=createSpan({cls:"another-quick-switcher__backlink__item__hot-key-guide",text:`${e.order+1}`});c.appendChild(y)}c.appendChild(o),a.appendChild(c),t.appendChild(a)}navigate(e){this.navQueue=this.navQueue.then(e)}async chooseCurrentSuggestion(e,t={}){var r;let s=this.getSelectedItem();return s?(t.keepOpen?e==="same-tab"&&((r=this.stateToRestore)!=null||(this.stateToRestore=this.appHelper.captureState(this.initialLeaf))):(this.close(),this.navigate(()=>this.isClosed)),this.navigate(()=>this.appHelper.openFile(s.file,{leafType:e,line:s.lineNumber-1,inplace:t.keepOpen,preventDuplicateTabs:this.settings.preventDuplicateTabs},this.stateToRestore)),s.file):null}async onChooseSuggestion(e,t){await this.chooseCurrentSuggestion(te(t))}async preview(){await this.chooseCurrentSuggestion("same-tab",{keepOpen:!0})}registerKeys(e,t){let s=this.settings.hotkeys.backlink[e];for(let r of s)this.scope.register(r.modifiers,B(R(r.key)),a=>{if(!a.isComposing)return a.preventDefault(),t(),!1})}setHotkeys(){this.scope.unregister(this.scope.keys.find(s=>s.key==="Enter")),this.scope.unregister(this.scope.keys.find(s=>s.key==="Escape")),this.scope.unregister(this.scope.keys.find(s=>s.key==="Home")),this.scope.unregister(this.scope.keys.find(s=>s.key==="End"));let e=U(this.settings.userAltInsteadOfModForQuickResultSelection);this.settings.hideHotkeyGuides||this.setInstructions([{command:"[\u21B5]",purpose:"open"},{command:"[\u2191]",purpose:"up"},{command:"[\u2193]",purpose:"down"},{command:`[${e} 1~9]`,purpose:"open Nth"},...C(this.settings.hotkeys.backlink)]),this.registerKeys("up",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"}))}),this.registerKeys("down",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"}))}),this.registerKeys("open",async()=>{let s=this.getCheckedItems();if(s.length>0){this.close();for(let r of s.slice())await this.appHelper.openFile(r.file,{leafType:"new-tab",line:r.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("same-tab")}),this.registerKeys("open in new tab",async()=>{let s=this.getCheckedItems();if(s.length>0){this.close();for(let r of s.slice())await this.appHelper.openFile(r.file,{leafType:"new-tab",line:r.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("new-tab")}),this.registerKeys("open in new pane (horizontal)",async()=>{let s=this.getCheckedItems();if(s.length>0){this.close();for(let r of s.slice())await this.appHelper.openFile(r.file,{leafType:"new-pane-horizontal",line:r.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("new-pane-horizontal")}),this.registerKeys("open in new pane (vertical)",async()=>{let s=this.getCheckedItems();if(s.length>0){this.close();for(let r of s.slice())await this.appHelper.openFile(r.file,{leafType:"new-pane-vertical",line:r.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("new-pane-vertical")}),this.registerKeys("open in new window",async()=>{await this.chooseCurrentSuggestion("new-window")}),this.registerKeys("open in popup",async()=>{await this.chooseCurrentSuggestion("popup")}),this.registerKeys("open in new tab in background",async()=>{await this.chooseCurrentSuggestion("new-tab-background",{keepOpen:!0})}),this.registerKeys("open all in new tabs",async()=>{this.close();let s=this.getItems();if(s){this.getSelectedItem();for(let r of s)await this.appHelper.openFile(r.file,{leafType:"new-tab",line:r.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}}),this.registerKeys("check/uncheck",async()=>{await this.toggleCheckedItem()}),this.registerKeys("check/uncheck and next",async()=>{await this.toggleCheckedItem({moveNext:!0})}),this.registerKeys("check all",()=>{this.checkAll()}),this.registerKeys("uncheck all",()=>{this.uncheckAll()}),this.registerKeys("show all results",()=>{this.limit=Number.MAX_SAFE_INTEGER,this.inputEl.dispatchEvent(new Event("input"))}),this.registerKeys("preview",()=>this.preview());let t=this.settings.userAltInsteadOfModForQuickResultSelection?"Alt":"Mod";for(let s of[1,2,3,4,5,6,7,8,9])this.scope.register([t],String(s),r=>(this.chooser.setSelectedItem(s-1,r),this.chooser.useSelectedItem({}),!1));this.registerKeys("dismiss",async()=>{this.close()})}};var ds=require("obsidian");function Re(){return Math.ceil(Date.now()/1e3)}var Be=class extends Q{constructor(e,t,s,r,a,l){super(e);this.commands=t;this.lastUsedMap=s;this.queryUsedMap=r;this.commandHistoryPath=a;this.settings=l;this.query="";this.app=e,this.setHotkeys()}toKey(e){return e.id}getSuggestions(e){let t=e.trim();return this.query=t,this.commands.map(s=>({command:t&&this.queryUsedMap[t]===s.id?{...s,topPriority:!0}:s,results:t.split(" ").filter(ae).map(r=>ht(s.name.toLowerCase(),r.toLowerCase()))})).filter(({results:s})=>s.every(r=>r.type!=="none")).map(({command:s,results:r})=>({command:s,result:r.reduce(Pt(a=>a.score))})).filter(({result:s})=>s.type!=="none").filter(({result:s})=>!t||s.type!=="fuzzy"||s.score>.25).toSorted(I(({result:s})=>s.score,"desc")).toSorted(I(({command:s})=>{var r;return(r=s.lastUsed)!=null?r:0},"desc")).toSorted(I(({result:s})=>s.type==="includes"||s.type==="starts-with","desc")).toSorted(I(({command:s})=>s.lastUsed!=null,"desc")).toSorted(I(({command:s})=>{var r;return(r=s.topPriority)!=null?r:!1},"desc")).map(({command:s})=>s)}renderSuggestion(e,t){let s=createDiv({cls:["another-quick-switcher__command-palette__item",e.lastUsed?"another-quick-switcher__command-palette__item-lastused":"",e.topPriority?"another-quick-switcher__command-palette__item-top-priority":""]});s.appendChild(createDiv({text:e.name}));let r=this.app.hotkeyManager.getHotkeys(e.id);if(r){let a=createDiv({cls:["another-quick-switcher__command-palette__item__keys"]});for(let l of r)a.appendChild(createEl("kbd",{text:Ce(l),cls:["another-quick-switcher__command-palette__item__key"]}));s.appendChild(a)}t.appendChild(s)}async onChooseSuggestion(e){var t,s,r;(r=(t=e.callback)==null?void 0:t.call(e))!=null||(s=e.checkCallback)==null||s.call(e,!1),this.lastUsedMap[e.id]=Re(),this.queryUsedMap[this.query]=e.id,await Qt(this.commandHistoryPath,{lastUsedMap:this.lastUsedMap,queryUsedMap:this.queryUsedMap},{overwrite:!0})}registerKeys(e,t){var s;for(let r of(s=this.settings.hotkeys.command[e])!=null?s:[])this.scope.register(r.modifiers,r.key.toUpperCase(),a=>(a.preventDefault(),t(),!1))}setHotkeys(){this.scope.unregister(this.scope.keys.find(e=>e.key==="Escape")),this.scope.unregister(this.scope.keys.find(e=>e.key==="Home")),this.scope.unregister(this.scope.keys.find(e=>e.key==="End")),this.settings.hideHotkeyGuides||this.setInstructions([{command:"[\u21B5]",purpose:"run"},{command:"[\u2191]",purpose:"up"},{command:"[\u2193]",purpose:"down"},...C(this.settings.hotkeys.move)]),this.registerKeys("up",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"}))}),this.registerKeys("down",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"}))}),this.registerKeys("copy command id",async()=>{let e=this.getSelectedItem();e&&(await navigator.clipboard.writeText(e.id),new ds.Notice(`Copied command ID to clipboard: ${e.id}`),this.close())}),this.registerKeys("dismiss",async()=>{this.close()})}};var Oe=require("obsidian");function yi(n,i,e,t){let s=i.split("/"),r=s.pop();return s.every(a=>{var l;return S((l=n.folder.parent)==null?void 0:l.path,a,t)})&&e(n,r)}function kt(n,i,e,t){return i.every(s=>yi(n,s,e,t))}function wi(n,i,e){return kt(n,i,(t,s)=>Bt(t.folder.name,s,e),e)?{...n,matchType:"prefix-name"}:kt(n,i,(t,s)=>S(t.folder.name,s,e),e)?{...n,matchType:"name"}:kt(n,i,(t,s)=>S(t.folder.path,s,e),e)?{...n,matchType:"directory"}:n}var ze=class extends Oe.SuggestModal{constructor(i,e){super(i),this.modalEl.addClass("another-quick-switcher__modal-prompt"),this.appHelper=new x(i),this.settings=e,this.setHotkeys(),this.originItems=this.appHelper.getFolders().filter(t=>!t.isRoot()).map(t=>({folder:t})),this.filteredItems=this.originItems}getSuggestions(i){let e=i.split(" ").filter(t=>t);return this.filteredItems.map(t=>wi(t,e,this.settings.normalizeAccentsAndDiacritics)).filter(t=>t.matchType).sort(I(t=>t.matchType==="directory"?1:0)).sort(I(t=>t.matchType==="prefix-name"?1e3-t.folder.name.length:0,"desc")).slice(0,10)}renderSuggestion(i,e){var l;let t=createDiv({cls:["another-quick-switcher__item","another-quick-switcher__directory_item"]}),s=createDiv({cls:"another-quick-switcher__item__entry"}),r=createDiv({cls:"another-quick-switcher__item__title",text:i.folder.name});s.appendChild(r);let a=createDiv({cls:"another-quick-switcher__item__directory"});a.insertAdjacentHTML("beforeend",P),a.appendText(` ${(l=i.folder.parent)==null?void 0:l.name}`),s.appendChild(a),t.appendChild(s),e.appendChild(t)}async onChooseSuggestion(i){if(!this.appHelper.enableFileExplorer()){new Oe.Notice("File explorer (core plugin) is not enabled.");return}this.appHelper.revealInFolder(i.folder)}registerKeys(i,e){var t;for(let s of(t=this.settings.hotkeys.folder[i])!=null?t:[])this.scope.register(s.modifiers,s.key.toUpperCase(),r=>(r.preventDefault(),e(),!1))}setHotkeys(){this.scope.unregister(this.scope.keys.find(i=>i.key==="Escape")),this.scope.unregister(this.scope.keys.find(i=>i.key==="Home")),this.scope.unregister(this.scope.keys.find(i=>i.key==="End")),this.settings.hideHotkeyGuides||this.setInstructions([{command:"[\u21B5]",purpose:"reveal in file tree"},{command:"[\u2191]",purpose:"up"},{command:"[\u2193]",purpose:"down"},...C(this.settings.hotkeys.folder)]),this.registerKeys("up",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"}))}),this.registerKeys("down",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"}))}),this.registerKeys("open in default app",()=>{var e,t;let i=(t=(e=this.chooser.values)==null?void 0:e[this.chooser.selectedItem])==null?void 0:t.folder;i&&(this.appHelper.openFolderInDefaultApp(i),this.close())}),this.registerKeys("dismiss",async()=>{this.close()})}};var qe=require("obsidian");function gs(n,i){let e=Buffer.from(n,"utf8");if(i>=e.length)return n.length;let t=[...n],s=0,r=0;for(let a=0;a<t.length;a++){let l=t[a],c=Buffer.from(l,"utf8").length;if(s+c>i||(s+=c,r+=l.length,s>=i))break}return r}function ms(n,i){return n.map(e=>({...e,start:gs(i,e.start),end:gs(i,e.end)}))}function Ne(n,i){if(n.length<=1)return n;let e=[...n].filter(s=>i?s.start>=0&&s.end<=i.length&&s.start<s.end:!0).sort((s,r)=>s.start-r.start);if(e.length===0)return[];let t=[];for(let s of e)t.some(a=>a.start===s.start&&a.end===s.end)||t.push(s);return t}function fs(n){if(n.length===0)return[];if(n.length===1)return n[0];let i=new Map;for(let t=0;t<n.length;t++){let s=n[t];for(let r of s){let a=`${r.data.path.text}:${r.data.line_number}`;i.has(a)||i.set(a,[]),i.get(a).push(r)}}let e=[];for(let[t,s]of i)if(s.length===n.length){let r=s[0],a=s.flatMap(l=>l.data.submatches);e.push({...r,data:{...r.data,submatches:a}})}return e}var Ke=require("child_process");async function ys(n){return new Promise((i,e)=>{(0,Ke.execFile)(n,["--version"],(t,s,r)=>{t&&console.dir(t),i(!t)})})}async function vt(n,...i){return new Promise((e,t)=>{(0,Ke.execFile)(n,["--json",...i],{maxBuffer:1024*1024*1024},(s,r,a)=>{if(s){if(s.message.includes("regex parse error")){e({type:"error",errorType:"regex_parse_error",message:s.message});return}if(r){let c=JSON.parse(r);if(c.type==="summary"&&c.data.stats.matches===0){e([]);return}}console.error("ripgrep error:",s),e([]);return}let l=r.split(`
`).filter(c=>c).map(c=>{try{return JSON.parse(c)}catch(o){return console.warn("JSON parse error for line:",c),null}}).filter(c=>c!==null&&c.type==="match");e(l)})})}async function ws(n,i,e,t){return new Promise((s,r)=>{let a=["--files","--follow",...t.flatMap(l=>["-t",l]),e].filter(l=>l);(0,Ke.execFile)(n,a,{maxBuffer:1024*1024*1024},(l,c,o)=>{if(l){if(l.message.includes("No such file or directory")){s([]);return}if(c){let h=JSON.parse(c);if(h.type==="summary"&&h.data.stats.matches===0){s([]);return}}console.error("ripgrep files error:",l),s([]);return}let u=c.split(`
`).filter(h=>h);for(let h of i)h.trim()&&(u=u.filter(d=>(d.split("/").pop()||"").toLowerCase().includes(h.toLowerCase())));s(u)})})}var ue={items:[],basePath:void 0,selected:void 0},Ve=class extends Q{constructor(e,t,s,r){super(e);this.isClosed=new Promise(e=>{this.markClosed=e});this.navQueue=Promise.resolve();this.modalEl.addClass("another-quick-switcher__modal-prompt"),this.suggestions=ue.items,this.vaultRootPath=V(this.app.vault.adapter.basePath),this.appHelper=new x(e),this.settings=t,this.logger=z.of(this.settings),this.initialLeaf=s,this.limit=255;let a=this.settings.hotkeys.grep.search.at(0);if(a){let l=dt("_",{key:a.key,modifiers:a.modifiers});this.setPlaceholder(`Search around the vault by ${l==null?void 0:l.command} key`)}else this.setPlaceholder('Please set a key about "search" in the "Grep dialog" setting');this.setHotkeys(),this.initialQuery=r}toKey(e){return`${e.file.path}:${e.lineNumber}`}onOpen(){var e;super.onOpen(),O(this.appHelper),this.basePath=(e=ue.basePath)!=null?e:this.settings.defaultGrepFolder,this.initialQuery&&(this.clonedInputEl.value=this.initialQuery,this.currentQuery=this.initialQuery,this.inputEl.value=this.initialQuery,this.inputEl.dispatchEvent(new Event("input"))),window.setTimeout(()=>{var c;this.basePathInputEl=createEl("input",{value:this.basePath,placeholder:"path from vault root (./ means current directory. ../ means parent directory)",cls:"another-quick-switcher__grep__path-input",type:"text"}),this.basePathInputEl.setAttrs({autocomplete:"on",list:"directories"});let t=createEl("datalist");t.setAttrs({id:"directories"});let s=this.appHelper.getFolders().filter(o=>!o.isRoot());for(let o of s)t.appendChild(createEl("option",{value:o.path}));this.basePathInputElChangeEventListener=o=>{this.basePath=o.target.value},this.basePathInputElKeydownEventListener=o=>{if(!o.key){o.preventDefault();return}let u=this.settings.hotkeys.grep.search[0];if(!u)return;gt(u,o)&&(o.preventDefault(),this.basePath=o.target.value,this.currentQuery=this.clonedInputEl.value,this.inputEl.value=this.currentQuery,this.inputEl.dispatchEvent(new Event("input")))},this.basePathInputEl.addEventListener("change",this.basePathInputElChangeEventListener),this.basePathInputEl.addEventListener("keydown",this.basePathInputElKeydownEventListener);let r=createDiv({cls:"another-quick-switcher__grep__path-input__wrapper"});r.appendChild(this.basePathInputEl),r.appendChild(t);let a=activeWindow.activeDocument.querySelector(".prompt-input-container");if(a==null||a.after(r),r.insertAdjacentHTML("afterbegin",P),this.settings.autoPreviewInGrepSearch){this.debouncePreview=(0,qe.debounce)(this.preview,this.settings.grepAutoPreviewDelayMilliSeconds,!0),this.debouncePreviewCancelListener=()=>{var u;(u=this.debouncePreview)==null||u.cancel()},this.debouncePreviewSearchCancelListener=()=>{var u;(u=this.debouncePreview)==null||u.cancel(),this.debounceInputEvent.cancel()};let o=this.chooser.setSelectedItem.bind(this.chooser);this.chooser.setSelectedItem=(u,h)=>{var d;o(u,h),(d=this.debouncePreview)==null||d.call(this)},this.clonedInputEl.addEventListener("keydown",this.debouncePreviewCancelListener),this.clonedInputEl.addEventListener("focusout",this.debouncePreviewSearchCancelListener),this.basePathInputEl.addEventListener("keydown",this.debouncePreviewCancelListener),this.basePathInputEl.addEventListener("focusout",this.debouncePreviewSearchCancelListener)}let l=ue.selected;l!=null&&(this.chooser.setSelectedItem(l),(c=this.chooser.suggestions.at(l))==null||c.scrollIntoView({behavior:"auto",block:"center",inline:"center"}))},0)}onClose(){var e;super.onClose(),(e=this.debouncePreview)==null||e.cancel(),ue.items=this.suggestions,ue.basePath=this.basePath,ue.selected=this.chooser.selectedItem,this.clonedInputEl.removeEventListener("keydown",this.clonedInputElKeydownEventListener),this.clonedInputEl.removeEventListener("input",this.clonedInputElInputEventListener),this.clonedInputEl.removeEventListener("keydown",this.debouncePreviewCancelListener),this.clonedInputEl.removeEventListener("focusout",this.debouncePreviewSearchCancelListener),this.basePathInputEl.removeEventListener("change",this.basePathInputElChangeEventListener),this.basePathInputEl.removeEventListener("keydown",this.basePathInputElKeydownEventListener),this.basePathInputEl.removeEventListener("keydown",this.debouncePreviewCancelListener),this.basePathInputEl.removeEventListener("focusout",this.debouncePreviewSearchCancelListener),this.stateToRestore&&this.navigate(()=>this.stateToRestore.restore()),this.navigate(this.markClosed)}async searchSuggestions(e){var u,h,d,m;let t=performance.now(),s=Mt(this.basePath,this.appHelper.getCurrentDirPath()),r=W(e.trim()),a;for(let p of r)if(!pt(p))return(u=this.countInputEl)==null||u.remove(),this.countInputEl=createDiv({text:`Invalid regex pattern: ${p}`,cls:"another-quick-switcher__grep__count-input another-quick-switcher__grep__count-input--error"}),this.clonedInputEl.before(this.countInputEl),[];if((h=this.countInputEl)==null||h.remove(),this.countInputEl=createDiv({text:"searching...",cls:"another-quick-switcher__grep__count-input"}),this.clonedInputEl.before(this.countInputEl),r.length>1){let p=[];for(let g of r){let y=await vt(this.settings.ripgrepCommand,...[...this.settings.grepExtensions.flatMap(v=>["-t",v]),me(g)?"":"-i","--follow","--",g,`${this.vaultRootPath}/${s}`].filter(v=>v));if(Array.isArray(y))p.push(y);else if(y.type==="error"&&y.errorType==="regex_parse_error")return(d=this.countInputEl)==null||d.remove(),this.countInputEl=createDiv({text:`Invalid regex pattern: ${g}`,cls:"another-quick-switcher__grep__count-input another-quick-switcher__grep__count-input--error"}),this.clonedInputEl.before(this.countInputEl),[]}a=fs(p)}else{let p=r[0],g=[...this.settings.grepExtensions.flatMap(v=>["-t",v]),me(p)?"":"-i","--follow","--",p,`${this.vaultRootPath}/${s}`].filter(v=>v),y=await vt(this.settings.ripgrepCommand,...g);if(Array.isArray(y))a=y;else{if(y.type==="error"&&y.errorType==="regex_parse_error")return(m=this.countInputEl)==null||m.remove(),this.countInputEl=createDiv({text:`Invalid regex pattern: ${p}`,cls:"another-quick-switcher__grep__count-input another-quick-switcher__grep__count-input--error"}),this.clonedInputEl.before(this.countInputEl),[];a=[]}}let l=this.settings.includeFilenameInGrepSearch?await ws(this.settings.ripgrepCommand,r,`${this.vaultRootPath}/${s}`,this.settings.grepExtensions).catch(p=>{if(p.includes("regex parse error"))return[];throw p}):[],c=a.map(p=>({order:-1,file:this.appHelper.getFileByPath(V(p.data.path.text).replace(`${this.vaultRootPath}/`,"")),line:p.data.lines.text,lineNumber:p.data.line_number,offset:p.data.absolute_offset,submatches:Ne(ms(p.data.submatches,p.data.lines.text),p.data.lines.text).map(g=>({...g,type:"text"}))})).filter(p=>p.file!=null).sort(I(p=>p.file.stat.mtime,"desc")),o=l.map(p=>{let g=this.appHelper.getFileByPath(V(p).replace(`${this.vaultRootPath}/`,""));if(!g)return null;let y=[];for(let v of r){if(!v.trim())continue;let b=me(v)?"g":"gi",k=Ot(g.basename,new RegExp(v,b));y.push(...k.map(f=>({text:f.text,start:f.range.start,end:f.range.end})))}return{order:-1,file:g,line:"",lineNumber:0,offset:0,submatches:Ne(y.map(v=>({match:{text:v.text},start:v.start,end:v.end})),g.basename).map(v=>({...v,type:"title"}))}}).filter(p=>p!=null).sort(I(p=>p.file.stat.mtime,"desc"));return this.logger.showDebugLog("getSuggestions: ",t),o.concat(c).map((p,g)=>({...p,order:g}))}async getSuggestions(e){var t,s;return e&&(this.suggestions=await this.searchSuggestions(e),(t=this.countInputEl)!=null&&t.classList.contains("another-quick-switcher__grep__count-input--error")||((s=this.countInputEl)==null||s.remove(),this.countInputEl=createDiv({text:`${Math.min(this.suggestions.length,this.limit)} / ${this.suggestions.length}`,cls:"another-quick-switcher__grep__count-input"}),this.clonedInputEl.before(this.countInputEl))),this.suggestions}renderSuggestion(e,t){var d,m,p;let r=((d=this.suggestions[e.order-1])==null?void 0:d.file.path)===e.file.path,a=createDiv({cls:["another-quick-switcher__item",this.selectedItemMap[this.toKey(e)]?"another-quick-switcher__item__selected":""].filter(g=>g)}),l=createDiv({cls:"another-quick-switcher__item__entry"});if(!r){let g=createDiv({cls:["another-quick-switcher__item__title","another-quick-switcher__grep__item__title_entry"],attr:{extension:e.file.extension}}),y=e.file.basename;for(let b of e.submatches.filter(k=>k.type==="title")){let k=y.indexOf(b.match.text),f=y.slice(0,k);g.createSpan({text:f}),g.createSpan({text:b.match.text,cls:"another-quick-switcher__hit_word"}),y=y.slice(k+b.match.text.length)}g.createSpan({text:y});let v=Y(e.file);if(e.file.extension!=="md"||v){let b=createDiv({cls:"another-quick-switcher__item__extension",text:v?"excalidraw":e.file.extension});g.appendChild(b)}if(l.appendChild(g),a.appendChild(l),this.settings.showDirectory){let b=createDiv({cls:"another-quick-switcher__item__directory"});b.insertAdjacentHTML("beforeend",P);let k=this.settings.showFullPathOfDirectory?(m=e.file.parent)==null?void 0:m.path:(p=e.file.parent)==null?void 0:p.name;b.appendText(` ${k}`),l.appendChild(b),this.settings.showDirectoryAtNewLine&&a.appendChild(b)}}let c=createDiv({cls:"another-quick-switcher__item__descriptions"}),o=createDiv({cls:"another-quick-switcher__grep__item__description"}),u=Ne(e.submatches.filter(g=>g.type==="text"),e.line).sort((g,y)=>g.start-y.start),h=0;for(let g of u){if(g.start>h){let y=e.line.slice(h,g.start);o.createSpan({text:N(y,this.settings.maxDisplayLengthAroundMatchedWord)})}o.createSpan({text:g.match.text,cls:"another-quick-switcher__hit_word"}),h=g.end}if(h<e.line.length){let g=e.line.slice(h);o.createSpan({text:N(g,this.settings.maxDisplayLengthAroundMatchedWord)})}if(e.order<9){let g=createSpan({cls:"another-quick-switcher__grep__item__hot-key-guide",text:`${e.order+1}`});c.appendChild(g)}c.appendChild(o),a.appendChild(c),t.appendChild(a)}navigate(e){this.navQueue=this.navQueue.then(e)}async chooseCurrentSuggestion(e,t={}){var r;let s=this.getSelectedItem();return s?(t.keepOpen?e==="same-tab"&&((r=this.stateToRestore)!=null||(this.stateToRestore=this.appHelper.captureState(this.initialLeaf))):(this.close(),this.navigate(()=>this.isClosed)),this.navigate(()=>this.appHelper.openFile(s.file,{leafType:e,line:s.lineNumber-1,inplace:t.keepOpen,preventDuplicateTabs:this.settings.preventDuplicateTabs},this.stateToRestore)),s.file):null}async onChooseSuggestion(e,t){await this.chooseCurrentSuggestion(te(t))}toggleInput(){document.activeElement===this.clonedInputEl?this.basePathInputEl.focus():this.clonedInputEl.focus()}validateRegexInput(){var a,l,c,o,u,h,d,m,p,g;let e=(l=(a=this.clonedInputEl)==null?void 0:a.value)==null?void 0:l.trim();if(!e){(c=this.clonedInputEl)==null||c.classList.remove("another-quick-switcher__grep__input--invalid"),(o=this.countInputEl)!=null&&o.classList.contains("another-quick-switcher__grep__count-input--error")&&((u=this.countInputEl)==null||u.remove(),this.countInputEl=void 0);return}let t=W(e),s=!1,r="";for(let y of t)if(!pt(y)){s=!0,r=y;break}s?((h=this.clonedInputEl)==null||h.classList.add("another-quick-switcher__grep__input--invalid"),(d=this.countInputEl)==null||d.remove(),this.countInputEl=createDiv({text:`Invalid regex pattern: ${r}`,cls:"another-quick-switcher__grep__count-input another-quick-switcher__grep__count-input--error"}),this.clonedInputEl.before(this.countInputEl)):((m=this.clonedInputEl)==null||m.classList.remove("another-quick-switcher__grep__input--invalid"),(p=this.countInputEl)!=null&&p.classList.contains("another-quick-switcher__grep__count-input--error")&&((g=this.countInputEl)==null||g.remove(),this.countInputEl=void 0))}registerKeys(e,t){let s=this.settings.hotkeys.grep[e];for(let r of s)this.scope.register(r.modifiers,B(R(r.key)),a=>{if(!a.isComposing)return a.preventDefault(),t(),!1})}async preview(){await this.chooseCurrentSuggestion("same-tab",{keepOpen:!0})}setHotkeys(){var s;this.scope.unregister(this.scope.keys.find(r=>r.key==="Enter")),this.scope.unregister(this.scope.keys.find(r=>r.key==="Escape")),this.scope.unregister(this.scope.keys.find(r=>r.key==="Home")),this.scope.unregister(this.scope.keys.find(r=>r.key==="End"));let e=U(this.settings.userAltInsteadOfModForQuickResultSelection);this.settings.hideHotkeyGuides||this.setInstructions([{command:"[\u21B5]",purpose:"open"},{command:"[\u2191]",purpose:"up"},{command:"[\u2193]",purpose:"down"},{command:`[${e} 1~9]`,purpose:"open Nth"},...C(this.settings.hotkeys.grep)]),this.clonedInputEl=this.inputEl.cloneNode(!0),(s=this.inputEl.parentNode)==null||s.replaceChild(this.clonedInputEl,this.inputEl),this.clonedInputElKeydownEventListener=r=>{let a=r,l=this.settings.hotkeys.grep.search[0];l&&gt(l,a)&&(r.preventDefault(),this.currentQuery=this.clonedInputEl.value,this.inputEl.value=this.currentQuery,this.inputEl.dispatchEvent(new Event("input")))},this.clonedInputEl.addEventListener("keydown",this.clonedInputElKeydownEventListener),this.debounceInputEvent=this.settings.grepSearchDelayMilliSeconds>0?(0,qe.debounce)(()=>{this.currentQuery=this.clonedInputEl.value,this.inputEl.value=this.currentQuery,this.validateRegexInput(),this.currentQuery.length>=this.settings.grepMinQueryLength&&this.inputEl.dispatchEvent(new Event("input"))},this.settings.grepSearchDelayMilliSeconds,!0):(0,qe.debounce)(()=>{this.validateRegexInput()},0,!0),this.clonedInputElInputEventListener=()=>{this.debounceInputEvent()},this.clonedInputEl.addEventListener("input",this.clonedInputElInputEventListener),this.registerKeys("up",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"}))}),this.registerKeys("down",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"}))}),this.registerKeys("clear input",()=>{this.clonedInputEl.value="",this.clonedInputEl.dispatchEvent(new InputEvent("input")),this.clonedInputEl.focus()}),this.registerKeys("clear path",()=>{this.basePathInputEl.value="",this.basePathInputEl.dispatchEvent(new InputEvent("change"))}),this.registerKeys("set ./ to path",()=>{this.basePathInputEl.value="./",this.basePathInputEl.dispatchEvent(new InputEvent("change"))}),this.registerKeys("toggle input",()=>{this.toggleInput()}),this.registerKeys("open",async()=>{let r=this.getCheckedItems();if(r.length>0){this.close();for(let a of r.slice())await this.appHelper.openFile(a.file,{leafType:"new-tab",line:a.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("same-tab")}),this.registerKeys("open in new tab",async()=>{let r=this.getCheckedItems();if(r.length>0){this.close();for(let a of r.slice())await this.appHelper.openFile(a.file,{leafType:"new-tab",line:a.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("new-tab")}),this.registerKeys("open in new pane (horizontal)",async()=>{let r=this.getCheckedItems();if(r.length>0){this.close();for(let a of r.slice())await this.appHelper.openFile(a.file,{leafType:"new-pane-horizontal",line:a.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("new-pane-horizontal")}),this.registerKeys("open in new pane (vertical)",async()=>{let r=this.getCheckedItems();if(r.length>0){this.close();for(let a of r.slice())await this.appHelper.openFile(a.file,{leafType:"new-pane-vertical",line:a.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("new-pane-vertical")}),this.registerKeys("open in new window",async()=>{await this.chooseCurrentSuggestion("new-window")}),this.registerKeys("open in popup",async()=>{await this.chooseCurrentSuggestion("popup")}),this.registerKeys("open in new tab in background",async()=>{await this.chooseCurrentSuggestion("new-tab-background",{keepOpen:!0})}),this.registerKeys("open all in new tabs",async()=>{if(this.close(),this.chooser.values==null)return;let r=this.chooser.values.slice().reverse();for(let a of r)await this.appHelper.openFile(a.file,{leafType:"new-tab",line:a.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}),this.registerKeys("check/uncheck",async()=>{await this.toggleCheckedItem()}),this.registerKeys("check/uncheck and next",async()=>{await this.toggleCheckedItem({moveNext:!0})}),this.registerKeys("check all",()=>{this.checkAll()}),this.registerKeys("uncheck all",()=>{this.uncheckAll()}),this.registerKeys("preview",()=>this.preview());let t=this.settings.userAltInsteadOfModForQuickResultSelection?"Alt":"Mod";for(let r of[1,2,3,4,5,6,7,8,9])this.scope.register([t],String(r),a=>(this.chooser.setSelectedItem(r-1,a),this.chooser.useSelectedItem({}),!1));this.registerKeys("dismiss",async()=>{this.close()})}};var Qe=require("obsidian");var Ue=class extends Qe.SuggestModal{constructor(e,t,s){super(e);this.hitItems=[];this.unsafeSelectedIndex=0;this.modalEl.addClass("another-quick-switcher__modal-prompt"),this.limit=1e3,this.appHelper=new x(e),this.settings=t,this.floating=s,this.autoPreview=t.autoPreviewInFloatingHeaderSearch&&s,this.stateToRestore=this.appHelper.captureStateInFile(this.appHelper.getActiveFileLeaf()),this.initialCursor=this.appHelper.getCurrentEditor().getCursor(),this.navQueue=Promise.resolve(),this.items=this.appHelper.getHeadersInActiveFile().map((r,a)=>({value:re(r.heading),level:r.level,position:r.position,hit:!1,index:a})),this.inputEl.addEventListener("input",r=>{var c,o;let a=r;if(this.hitItems.length===0){this.select(this.unsafeSelectedIndex,a);return}let l=(o=(c=this.hitItems.find(u=>u.index>=this.unsafeSelectedIndex))==null?void 0:c.index)!=null?o:this.hitItems[0].index;this.select(l,a)}),this.setHotkeys()}navigate(e){this.navQueue=this.navQueue.then(e)}onClose(){super.onClose(),this.navigate(()=>this.stateToRestore.restore())}select(e,t,s){var a;this.chooser.setSelectedItem(e,t),(a=this.chooser.suggestions.at(e))==null||a.scrollIntoView({behavior:"auto",block:"center",inline:"center"}),this.unsafeSelectedIndex=e;let r=this.items.at(this.unsafeSelectedIndex);this.autoPreview&&r&&!s&&this.appHelper.moveTo(r.position)}getNextSelectIndex(){return this.unsafeSelectedIndex+1>this.items.length-1?0:this.unsafeSelectedIndex+1}getPreviousSelectIndex(){return this.unsafeSelectedIndex-1<0?this.items.length-1:this.unsafeSelectedIndex-1}onOpen(){super.onOpen(),this.floating&&(this.enableFloating(),this.refreshPreviewIcon());let e=this.appHelper.getMarkdownViewInActiveLeaf();if(!e||this.items.length===0)return;let s=e.getMode()==="source"?this.appHelper.getCurrentOffset():e.editor.posToOffset({ch:0,line:e.previewMode.getScroll()});if(!s)return;let r=this.items.findIndex(a=>a.position.start.offset>s);r===-1?this.select(this.items.last().index,void 0,!0):r===0?this.select(0,void 0,!0):this.select(r-1,void 0,!0)}refreshPreviewIcon(){var e,t;(e=this.previewIcon)==null||e.remove(),this.autoPreview&&(this.previewIcon=this.inputEl.insertAdjacentElement("afterend",createDiv({cls:"another-quick-switcher__header__auto-preview-icon"})),(t=this.previewIcon)==null||t.insertAdjacentHTML("beforeend",De))}enableFloating(){this.floating=!0,Qe.Platform.isPhone||O(this.appHelper)}getSuggestions(e){let t=W(e),s=this.items.map(r=>{let a=t.length>0&&t.every(l=>S(r.value,l,this.settings.normalizeAccentsAndDiacritics));return{...r,hit:a}});return this.hitItems=s.filter(r=>r.hit),s}renderSuggestion(e,t){let s=createDiv({cls:"another-quick-switcher__item"}),r=createDiv({cls:"another-quick-switcher__item__entry"}),a=createDiv({cls:["another-quick-switcher__item__title","another-quick-switcher__item__title__header",e.hit?"another-quick-switcher__item__title__header_hit":"another-quick-switcher__item__title__header_no_hit",`another-quick-switcher__item__title__header${e.level}`],text:e.value});if(r.appendChild(a),e.hit){let l=this.hitItems.findIndex(c=>c.index===e.index);l!==-1&&r.createSpan({cls:"another-quick-switcher__item__title__header_hit__counter",text:`${l+1} / ${this.hitItems.length}`})}s.appendChild(r),t.appendChild(s)}async onChooseSuggestion(e){this.appHelper.moveTo(e.position,void 0,this.initialCursor)}registerKeys(e,t){var s;for(let r of(s=this.settings.hotkeys.header[e])!=null?s:[])this.scope.register(r.modifiers,B(R(r.key)),a=>{if(!a.isComposing)return a.preventDefault(),t(a),!1})}setHotkeys(){this.scope.unregister(this.scope.keys.find(a=>a.key==="Escape")),this.scope.unregister(this.scope.keys.find(a=>a.key==="Home")),this.scope.unregister(this.scope.keys.find(a=>a.key==="End")),this.settings.hideHotkeyGuides||this.setInstructions([{command:"[\u21B5]",purpose:"move to header"},{command:"[\u2191]",purpose:"up"},{command:"[\u2193]",purpose:"down"},...C(this.settings.hotkeys.header)]);let e=a=>{this.select(this.getNextSelectIndex(),a)},t=a=>{this.select(this.getPreviousSelectIndex(),a)},s=a=>{var c,o;if(this.hitItems.length===1)return;if(this.hitItems.length===0){e(a);return}let l=(o=(c=this.hitItems.find(u=>u.index>this.unsafeSelectedIndex))==null?void 0:c.index)!=null?o:this.hitItems[0].index;this.select(l,a)},r=a=>{if(this.hitItems.length===1)return;if(this.hitItems.length===0){t(a);return}let l=this.hitItems.findIndex(o=>o.index>=this.unsafeSelectedIndex),c=l===0?this.hitItems.length-1:l-1;this.select(this.hitItems[c].index,a)};for(let a of this.scope.keys.filter(l=>["ArrowDown","ArrowUp"].includes(l.key)))this.scope.unregister(a);this.scope.register([],"ArrowUp",a=>(a.preventDefault(),t(a),!1)),this.scope.register([],"ArrowDown",a=>(a.preventDefault(),e(a),!1)),this.registerKeys("up",a=>{t(a)}),this.registerKeys("down",a=>{e(a)}),this.registerKeys("clear input",()=>{this.inputEl.value="",this.inputEl.dispatchEvent(new InputEvent("input"))}),this.registerKeys("move to next hit",a=>{s(a)}),this.registerKeys("move to previous hit",a=>{r(a)}),this.registerKeys("toggle auto preview",()=>{this.autoPreview=!this.autoPreview,this.refreshPreviewIcon(),this.autoPreview&&!this.floating&&this.enableFloating()}),this.registerKeys("insert all to editor",async()=>{this.close();let a=this.chooser.values;if(!a)return;let l=oe(a,c=>c.level).level;for(let c of a)this.appHelper.insertStringToActiveFile(`${" ".repeat((c.level-l)*4)}- ${c.value}
`)}),this.registerKeys("dismiss",async()=>{this.close()})}};var we=require("obsidian");var ye={query:"",selected:null},$e=class extends we.SuggestModal{constructor(e,t){super(e);this.unsafeSelectedIndex=0;this.suggestions=[];this.modalEl.addClass("another-quick-switcher__modal-prompt"),this.appHelper=new x(e),this.settings=t,this.logger=z.of(this.settings),this.floating=this.settings.autoPreviewInFloatingInFileSearch,this.autoPreview=t.autoPreviewInFloatingInFileSearch,this.stateToRestore=this.appHelper.captureStateInFile(this.appHelper.getActiveFileLeaf()),this.initialCursor=this.appHelper.getCurrentEditor().getCursor(),this.navQueue=Promise.resolve(),this.limit=255,this.setHotkeys(),this.setPlaceholder("Type anything then shows the results")}close(){we.Platform.isMobile&&this.onClose(),super.close()}async init(){await this.indexingItems()}navigate(e){this.navQueue=this.navQueue.then(e)}onOpen(){var e;if(this.isOpen=!0,this.inputEl.value=ye.query,this.inputEl.select(),this.updateSuggestions(),this.floating&&(this.enableFloating(),this.refreshPreviewIcon()),ye.selected!=null&&this.chooser.suggestions.length>0){let t=Math.min(ye.selected,this.chooser.suggestions.length-1);this.select(t),(e=this.chooser.suggestions.at(t))==null||e.scrollIntoView({behavior:"auto",block:"center",inline:"center"})}this.inputEl.addEventListener("input",t=>{let s=t;this.suggestions.length!==0&&this.select(Math.min(this.unsafeSelectedIndex,this.suggestions.length-1),s)}),this.opened=!0}onClose(){super.onClose(),ye.query=this.inputEl.value,ye.selected=this.chooser.values!=null?this.chooser.selectedItem:null,this.navigate(()=>this.stateToRestore.restore())}select(e,t){if(this.chooser.setSelectedItem(e,t),this.unsafeSelectedIndex=e,this.autoPreview){let s={line:this.chooser.values[e].lineNumber-1,offset:0,col:0};this.appHelper.moveTo({start:s,end:s})}}getNextSelectIndex(){return this.chooser.selectedItem+1>this.chooser.suggestions.length-1?0:this.chooser.selectedItem+1}getPreviousSelectIndex(){return this.chooser.selectedItem-1<0?this.chooser.suggestions.length-1:this.chooser.selectedItem-1}refreshPreviewIcon(){var e,t;(e=this.previewIcon)==null||e.remove(),this.autoPreview&&(this.previewIcon=this.inputEl.insertAdjacentElement("afterend",createDiv({cls:"another-quick-switcher__in-file__auto-preview-icon"})),(t=this.previewIcon)==null||t.insertAdjacentHTML("beforeend",De))}enableFloating(){this.floating=!0,we.Platform.isPhone||O(this.appHelper)}async indexingItems(){let e=this.appHelper.getCurrentEditor().getValue().split(`
`);this.ignoredItems=e.map((t,s)=>({lineBefore:et(this.settings.inFileContextLines).reverse().map(r=>e[s-r-1]).filter(ae),line:t,lineAfter:et(this.settings.inFileContextLines).map(r=>e[s+r+1]).filter(ae),lineNumber:s+1}))}getSuggestions(e){var l;let t=performance.now(),s=e.trim()==="",r=W(e.trim());this.currentQueriesRegExp=new RegExp(r.map(xe).join("|"),"gi");let a=s?[]:this.ignoredItems.filter(c=>r.every(o=>Rt(c.line,o,this.settings.normalizeAccentsAndDiacritics)));return this.logger.showDebugLog(`Get suggestions: ${e}`,t),(l=this.countInputEl)==null||l.remove(),this.countInputEl=createDiv({text:`${Math.min(a.length,this.limit)} / ${a.length}`,cls:"another-quick-switcher__in-file__status__count-input"}),this.inputEl.before(this.countInputEl),this.suggestions=a.slice(0,this.limit).map((c,o)=>({...c,order:o})),this.suggestions}renderSuggestion(e,t){let s=createDiv({cls:["another-quick-switcher__item","another-quick-switcher__in-file__item"]}),r=createDiv({cls:"another-quick-switcher__item__descriptions"}),a=createDiv({cls:"another-quick-switcher__in-file__item__description"});e.lineBefore.forEach((d,m)=>{let p=a.createDiv({cls:"another-quick-switcher__in-file__line"});p.createSpan({text:String(e.lineNumber-e.lineBefore.length+m),cls:"another-quick-switcher__in-file__line-number"}),p.createSpan({text:N(d,this.settings.inFileMaxDisplayLengthAroundMatchedWord)})});let l=a.createDiv({cls:["another-quick-switcher__in-file__line","another-quick-switcher__in-file__active-line"]});l.createSpan({text:e.lineNumber.toString(),cls:"another-quick-switcher__in-file__line-number"});let c=l.createDiv(),o=e.line,u=0,h=Array.from(o.matchAll(this.currentQueriesRegExp)).map(d=>({index:d.index,text:d[0]}));for(let{index:d,text:m}of h){let p=o.slice(0,d-u);c.createSpan({text:N(p,this.settings.inFileMaxDisplayLengthAroundMatchedWord)}),c.createSpan({text:m,cls:"another-quick-switcher__hit_word"}),u+=p.length+m.length,o=e.line.slice(u)}if(c.createSpan({text:N(o,this.settings.inFileMaxDisplayLengthAroundMatchedWord)}),e.lineAfter.forEach((d,m)=>{let p=a.createDiv({cls:"another-quick-switcher__in-file__line"});p.createSpan({text:String(e.lineNumber+m+1),cls:"another-quick-switcher__in-file__line-number"}),p.createSpan({text:N(d,this.settings.inFileMaxDisplayLengthAroundMatchedWord)})}),e.order<9){let d=createSpan({cls:"another-quick-switcher__in-file__item__hot-key-guide",text:`${e.order+1}`});r.appendChild(d)}r.appendChild(a),s.appendChild(r),t.appendChild(s)}async onChooseSuggestion(e){this.appHelper.moveTo(this.appHelper.getCurrentEditor().posToOffset({line:e.lineNumber-1,ch:0}),void 0,this.initialCursor)}registerKeys(e,t){var s;for(let r of(s=this.settings.hotkeys["in-file"][e])!=null?s:[])this.scope.register(r.modifiers,B(R(r.key)),a=>{if(!a.isComposing)return a.preventDefault(),t(a),!1})}setHotkeys(){this.scope.unregister(this.scope.keys.find(l=>l.key==="Escape")),this.scope.unregister(this.scope.keys.find(l=>l.key==="Home")),this.scope.unregister(this.scope.keys.find(l=>l.key==="End"));let e=U(this.settings.userAltInsteadOfModForQuickResultSelection);this.settings.hideHotkeyGuides||this.setInstructions([{command:"[\u21B5]",purpose:"open"},{command:"[\u2191]",purpose:"up"},{command:"[\u2193]",purpose:"down"},{command:`[${e} 1~9]`,purpose:"open Nth"},...C(this.settings.hotkeys["in-file"])]);let t=l=>{this.select(this.getNextSelectIndex(),l)},s=l=>{this.select(this.getPreviousSelectIndex(),l)},r=this.scope.keys.filter(l=>["ArrowDown","ArrowUp"].includes(l.key));for(let l of r)this.scope.unregister(l);this.scope.register([],"ArrowUp",l=>(l.preventDefault(),s(l),!1)),this.scope.register([],"ArrowDown",l=>(l.preventDefault(),t(l),!1)),this.registerKeys("up",l=>{s(l)}),this.registerKeys("down",l=>{t(l)}),this.registerKeys("insert to editor",async()=>{var o;let l=(o=this.chooser.values)==null?void 0:o[this.chooser.selectedItem];if(!l)return;let c=this.appHelper.getCurrentEditor();c&&(c.setCursor(this.initialCursor),this.appHelper.insertStringToActiveFile(l.line),this.close())}),this.registerKeys("show all results",()=>{this.limit=Number.MAX_SAFE_INTEGER,this.inputEl.dispatchEvent(new Event("input"))});let a=this.settings.userAltInsteadOfModForQuickResultSelection?"Alt":"Mod";for(let l of[1,2,3,4,5,6,7,8,9])this.scope.register([a],String(l),c=>(this.chooser.setSelectedItem(l-1,c),this.chooser.useSelectedItem({}),!1));this.registerKeys("toggle auto preview",()=>{this.autoPreview=!this.autoPreview,this.refreshPreviewIcon(),this.autoPreview&&(this.select(this.unsafeSelectedIndex),this.floating||this.enableFloating())}),this.registerKeys("dismiss",async()=>{this.close()})}};var he=require("obsidian");var je=class extends he.SuggestModal{constructor(e,t,s){super(e);this.lastOpenFileIndexByPath={};this.suggestions=[];this.isClosed=new Promise(e=>{this.markClosed=e});this.navQueue=Promise.resolve();this.modalEl.addClass("another-quick-switcher__modal-prompt"),this.vaultRootPath=V(this.app.vault.adapter.basePath),this.appHelper=new x(e),this.settings=t,this.logger=z.of(this.settings),this.initialLeaf=s,this.limit=255,this.app.workspace.getLastOpenFiles().forEach((r,a)=>{this.lastOpenFileIndexByPath[r]=a}),this.setHotkeys(),this.debounceGetSuggestions=(0,he.debounce)((r,a)=>{a(this._getSuggestions(r))},this.settings.searchDelayMilliSeconds,!0)}async init(){await this.indexingItems()}onOpen(){super.onOpen(),he.Platform.isPhone||O(this.appHelper),this.opened=!0}onClose(){super.onClose(),this.stateToRestore&&this.navigate(()=>this.stateToRestore.restore()),this.navigate(this.markClosed)}indexingItems(){let e=[],t=this.appHelper.getLinksByFilePathInActiveFile();if(t){for(let[s,r]of Object.entries(t)){let a=this.appHelper.getFileByPath(s),l=this.appHelper.getCurrentEditor().getValue(),c=r.filter(u=>!ee(u)),o=be(c,u=>u.position.start.line);for(let u of o)e.push({file:a,displayLink:u.displayText,line:l.split(`
`).at(u.position.start.line),lineNumber:u.position.start.line+1,offset:u.position.start.offset})}this.ignoredItems=e}}getSuggestions(e){return!e||!this.opened?this._getSuggestions(e):new Promise(t=>{this.debounceGetSuggestions(e,s=>{t(s)})})}_getSuggestions(e){var l;let t=performance.now(),s=e.trim()==="",r=e.trim().split(" "),a=s?this.ignoredItems:this.ignoredItems.filter(c=>r.every(o=>c.file&&S(c.file.path,o,this.settings.normalizeAccentsAndDiacritics)||S(c.line,o,this.settings.normalizeAccentsAndDiacritics)));return this.logger.showDebugLog(`Get suggestions: ${e}`,t),(l=this.countInputEl)==null||l.remove(),this.countInputEl=createDiv({text:`${Math.min(a.length,this.limit)} / ${a.length}`,cls:"another-quick-switcher__link__status__count-input"}),this.inputEl.before(this.countInputEl),this.suggestions=a.slice(0,this.limit).map((c,o)=>({...c,order:o})),this.suggestions}renderSuggestion(e,t){var u,h,d,m,p,g,y,v,b,k,f,E,K,M;let r=((m=(h=(u=this.suggestions[e.order-1])==null?void 0:u.file)==null?void 0:h.path)!=null?m:(d=this.suggestions[e.order-1])==null?void 0:d.displayLink)===((g=(p=e.file)==null?void 0:p.path)!=null?g:e.displayLink),a=createDiv({cls:"another-quick-switcher__item"}),l=createDiv({cls:"another-quick-switcher__item__entry"});if(!r){let H=(v=(y=e.file)==null?void 0:y.extension)!=null?v:"md",J=createDiv({cls:["another-quick-switcher__item__title","another-quick-switcher__link__item__title_entry"],text:(k=(b=e.file)==null?void 0:b.basename)!=null?k:e.displayLink,attr:{extension:H}}),pe=Y(e.file);if(H!=="md"||pe){let T=createDiv({cls:"another-quick-switcher__item__extension",text:pe?"excalidraw":H});J.appendChild(T)}if(l.appendChild(J),a.appendChild(l),this.settings.showDirectory){let T=createDiv({cls:"another-quick-switcher__item__directory"});T.insertAdjacentHTML("beforeend",P);let ke=this.settings.showFullPathOfDirectory?(E=(f=e.file)==null?void 0:f.parent)==null?void 0:E.path:(M=(K=e.file)==null?void 0:K.parent)==null?void 0:M.name;T.appendText(` ${ke}`),l.appendChild(T),this.settings.showDirectoryAtNewLine&&a.appendChild(T)}}let c=createDiv({cls:"another-quick-switcher__item__descriptions"}),o=createDiv({cls:"another-quick-switcher__link__item__description"});if(o.createSpan({text:e.line}),e.order<9){let H=createSpan({cls:"another-quick-switcher__link__item__hot-key-guide",text:`${e.order+1}`});c.appendChild(H)}c.appendChild(o),a.appendChild(c),t.appendChild(a)}navigate(e){this.navQueue=this.navQueue.then(e)}async chooseCurrentSuggestion(e,t={}){var r,a;let s=(r=this.chooser.values)==null?void 0:r[this.chooser.selectedItem];return s?(t.keepOpen?e==="same-tab"&&((a=this.stateToRestore)!=null||(this.stateToRestore=this.appHelper.captureState(this.initialLeaf))):(this.close(),this.navigate(()=>this.isClosed)),this.navigate(()=>this.appHelper.openFile(this.appHelper.getActiveFile(),{leafType:e,line:s.lineNumber-1,inplace:t.keepOpen,preventDuplicateTabs:this.settings.preventDuplicateTabs},this.stateToRestore)),this.appHelper.getActiveFile()):null}async onChooseSuggestion(e,t){await this.chooseCurrentSuggestion(te(t))}registerKeys(e,t){var s;for(let r of(s=this.settings.hotkeys.link[e])!=null?s:[])this.scope.register(r.modifiers,B(R(r.key)),a=>{if(!a.isComposing)return a.preventDefault(),t(),!1})}setHotkeys(){this.scope.unregister(this.scope.keys.find(s=>s.key==="Enter")),this.scope.unregister(this.scope.keys.find(s=>s.key==="Escape")),this.scope.unregister(this.scope.keys.find(s=>s.key==="Home")),this.scope.unregister(this.scope.keys.find(s=>s.key==="End"));let e=U(this.settings.userAltInsteadOfModForQuickResultSelection);this.settings.hideHotkeyGuides||this.setInstructions([{command:"[\u21B5]",purpose:"open"},{command:"[\u2191]",purpose:"up"},{command:"[\u2193]",purpose:"down"},{command:`[${e} 1~9]`,purpose:"open Nth"},...C(this.settings.hotkeys.link)]),this.registerKeys("up",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"}))}),this.registerKeys("down",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"}))}),this.registerKeys("open",async()=>{await this.chooseCurrentSuggestion("same-tab")}),this.registerKeys("open in new tab",async()=>{await this.chooseCurrentSuggestion("new-tab")}),this.registerKeys("open in new pane (horizontal)",async()=>{await this.chooseCurrentSuggestion("new-pane-horizontal")}),this.registerKeys("open in new pane (vertical)",async()=>{await this.chooseCurrentSuggestion("new-pane-vertical")}),this.registerKeys("open in new window",async()=>{await this.chooseCurrentSuggestion("new-window")}),this.registerKeys("open in popup",async()=>{await this.chooseCurrentSuggestion("popup")}),this.registerKeys("open in new tab in background",async()=>{await this.chooseCurrentSuggestion("new-tab-background",{keepOpen:!0})}),this.registerKeys("open all in new tabs",async()=>{if(this.close(),this.chooser.values==null)return;let s=this.chooser.values.slice().reverse();for(let r of s)await this.appHelper.openFile(this.appHelper.getActiveFile(),{leafType:"new-tab",line:r.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}),this.registerKeys("show all results",()=>{this.limit=Number.MAX_SAFE_INTEGER,this.inputEl.dispatchEvent(new Event("input"))}),this.registerKeys("preview",async()=>{await this.chooseCurrentSuggestion("same-tab",{keepOpen:!0})});let t=this.settings.userAltInsteadOfModForQuickResultSelection?"Alt":"Mod";for(let s of[1,2,3,4,5,6,7,8,9])this.scope.register([t],String(s),r=>(this.chooser.setSelectedItem(s-1,r),this.chooser.useSelectedItem({}),!1));this.registerKeys("dismiss",async()=>{this.close()})}};var Ge=require("obsidian");function ki(n){if(n.length===0)return[];let i=[...n].sort((s,r)=>s.start-r.start),e=[],t=i[0];for(let s=1;s<i.length;s++){let r=i[s];r.start<=t.end+1?t={start:t.start,end:Math.max(t.end,r.end)}:(e.push(t),t=r)}return e.push(t),e}function ks(n,i){let e=document.createDocumentFragment();if(!i||i.length===0)return e.appendChild(document.createTextNode(n)),e;let t=ki(i),s=-1;for(let r of t){if(r.start>s+1){let l=n.slice(s+1,r.start);l&&e.appendChild(document.createTextNode(l))}let a=n.slice(r.start,r.end+1);if(a){let l=createSpan({cls:"another-quick-switcher__hit_word",text:a});e.appendChild(l)}s=r.end}if(s+1<n.length){let r=n.slice(s+1);r&&e.appendChild(document.createTextNode(r))}return e}function vi(n,i,e,t){let s=i.split("/"),r=s.pop();return s.every(a=>{var l;return S((l=n.folder.parent)==null?void 0:l.path,a,t)})&&e(n,r)}function bi(n,i,e,t){return i.every(s=>vi(n,s,e,t))}function Ei(n,i,e){var r;let t=i.join(" "),s=le(n.folder.name,t,e);switch(s.type){case"starts-with":return{...n,matchType:"prefix-name",score:s.score,ranges:s.ranges};case"includes":return{...n,matchType:"name",score:s.score,ranges:s.ranges};case"fuzzy":return{...n,matchType:"fuzzy-name",score:s.score,ranges:s.ranges}}if(bi(n,i,(a,l)=>S(a.folder.path,l,e),e)){let a=((r=n.folder.parent)==null?void 0:r.name)||"",l=le(a,t,e);return{...n,matchType:"directory",directoryRanges:l.ranges}}return n}function Si(n,i){let e=i.indexOf(n.folder.path);return e!==-1?{...n,isRecentlyUsed:!0,recentlyUsedIndex:e}:n}function xi(n,i){return n.sort((e,t)=>{var s,r;switch(i){case"Recently used":{let a=(s=e.recentlyUsedIndex)!=null?s:999999,l=(r=t.recentlyUsedIndex)!=null?r:999999;return a-l}case"Alphabetical":return e.folder.name.localeCompare(t.folder.name);case"Alphabetical reverse":return t.folder.name.localeCompare(e.folder.name);default:return 0}})}var We=class extends Ge.SuggestModal{constructor(e,t){super(e);this.recentFolders=[];this.modalEl.addClass("another-quick-switcher__modal-prompt"),this.appHelper=new x(e),this.settings=t,this.setHotkeys(),this.originItems=this.appHelper.getFolders().filter(s=>!s.isRoot()).map(s=>({folder:s})),this.filteredItems=Se(this.originItems,this.settings.moveFileExcludePrefixPathPatterns,s=>s.folder.path)}async onOpen(){await this.loadRecentlyUsedFolders(),super.onOpen()}getRecentlyUsedFilePath(){return this.settings.moveFileRecentlyUsedFilePath||".obsidian/plugins/obsidian-another-quick-switcher/recently-used-folders.json"}async loadRecentlyUsedFolders(){let e=this.getRecentlyUsedFilePath();try{if(await this.app.vault.adapter.exists(e)){let t=await this.app.vault.adapter.read(e);this.recentFolders=JSON.parse(t)}}catch(t){console.warn("Failed to load recently used folders:",t),this.recentFolders=[]}}async saveRecentlyUsedFolders(){let e=this.getRecentlyUsedFilePath();try{let t=e.substring(0,e.lastIndexOf("/"));await this.app.vault.adapter.exists(t)||await this.app.vault.adapter.mkdir(t),await this.app.vault.adapter.write(e,JSON.stringify(this.recentFolders,null,2))}catch(t){console.warn("Failed to save recently used folders:",t)}}async updateRecentlyUsedFolder(e){let t=this.recentFolders.indexOf(e);t>-1&&this.recentFolders.splice(t,1),this.recentFolders.unshift(e),this.recentFolders.length>this.settings.moveFileMaxRecentlyUsedFolders&&this.recentFolders.pop(),await this.saveRecentlyUsedFolders()}getSuggestions(e){let t=e.split(" ").filter(a=>a),s=this.filteredItems.map(a=>Ei(a,t,this.settings.normalizeAccentsAndDiacritics)).filter(a=>a.matchType).map(a=>Si(a,this.recentFolders));return xi(s,this.settings.moveFolderSortPriority).slice(0,10)}renderSuggestion(e,t){var u;let s=createDiv({cls:["another-quick-switcher__item","another-quick-switcher__directory_item"]}),r=createDiv({cls:"another-quick-switcher__item__entry"}),a=createDiv({cls:"another-quick-switcher__item__title"}),l=ks(e.folder.name,e.ranges);a.appendChild(l),r.appendChild(a);let c=createDiv({cls:"another-quick-switcher__item__directory"});c.insertAdjacentHTML("beforeend",P);let o=((u=e.folder.parent)==null?void 0:u.name)||"";if(e.matchType==="directory"&&e.directoryRanges){c.appendText(" ");let h=ks(o,e.directoryRanges);c.appendChild(h)}else c.appendText(` ${o}`);r.appendChild(c),s.appendChild(r),t.appendChild(s)}async onChooseSuggestion(e){let t=this.app.workspace.getActiveFile();if(!t)return;let s=`${e.folder.path}/${t.name}`;if(await this.appHelper.exists(s)){let r=`${t.basename}.${window.moment().format("YYYYMMDD_HHmmss_SSS")}.${t.extension}`;s=`${e.folder.path}/${r}`,new Ge.Notice(`Since a file with the same name already exists in the destination directory, it will be moved and renamed ${r}`)}await this.app.fileManager.renameFile(t,s),await this.updateRecentlyUsedFolder(e.folder.path)}registerKeys(e,t){var s;for(let r of(s=this.settings.hotkeys.move[e])!=null?s:[])this.scope.register(r.modifiers,r.key.toUpperCase(),a=>(a.preventDefault(),t(),!1))}setHotkeys(){this.scope.unregister(this.scope.keys.find(e=>e.key==="Escape")),this.scope.unregister(this.scope.keys.find(e=>e.key==="Home")),this.scope.unregister(this.scope.keys.find(e=>e.key==="End")),this.settings.hideHotkeyGuides||this.setInstructions([{command:"[\u21B5]",purpose:"move to"},{command:"[\u2191]",purpose:"up"},{command:"[\u2193]",purpose:"down"},...C(this.settings.hotkeys.move)]),this.registerKeys("up",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"}))}),this.registerKeys("down",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"}))}),this.registerKeys("open in default app",()=>{var t,s;let e=(s=(t=this.chooser.values)==null?void 0:t[this.chooser.selectedItem])==null?void 0:s.folder;e&&(this.appHelper.openFolderInDefaultApp(e),this.close())}),this.registerKeys("dismiss",async()=>{this.close()})}};var Ci="search-command";function _i(n,i,e){var a,l,c,o;let t=(l=(a=n.workspace.getActiveViewOfType(D.FileView))==null?void 0:a.leaf)!=null?l:null,s=(o=(c=n.workspace.getActiveViewOfType(D.MarkdownView))==null?void 0:c.editor)!=null?o:null;new He({app:n,settings:i,command:e,originFile:n.workspace.getActiveFile(),inputQuery:i.useSelectionWordsAsDefaultInputQuery&&(s==null?void 0:s.getSelection())||null,navigationHistories:[],currentNavigationHistoryIndex:0,stackHistory:!0,initialLeaf:t}).open()}function Ii(n,i){new ze(n,i).open()}function Fi(n,i){if(!n.workspace.getActiveFile())return;new We(n,i).open()}async function wt(n,i,e){var r,a;if(!D.Platform.isDesktop){new D.Notice("Grep is not supported on mobile.");return}if(!await ys(i.ripgrepCommand)){new D.Notice(`"${i.ripgrepCommand}" was not working as a ripgrep command. If you have not installed ripgrep yet, please install it.`);return}let t=(a=(r=n.workspace.getActiveViewOfType(D.FileView))==null?void 0:r.leaf)!=null?a:null;new Ve(n,i,t,e).open()}async function Ai(n,i){var s,r;if(!n.workspace.getActiveFile())return;let e=(r=(s=n.workspace.getActiveViewOfType(D.FileView))==null?void 0:s.leaf)!=null?r:null,t=new Le(n,i,e);await t.init(),t.open()}async function Ti(n,i){var s,r;if(!n.workspace.getActiveFile())return;let e=(r=(s=n.workspace.getActiveViewOfType(D.FileView))==null?void 0:s.leaf)!=null?r:null,t=new je(n,i,e);await t.init(),t.open()}async function Pi(n,i){if(!n.workspace.getActiveFile())return;let e=new $e(n,i);await e.init(),e.open()}function vs(n,i,e){if(!n.workspace.getActiveFile())return;new Ue(n,i,e).open()}async function Di(n){var o;let i=Re(),e=n.settings.commandPaletteHistoryPath||".obsidian/plugins/obsidian-another-quick-switcher/command-history.json",{lastUsedMap:t={},queryUsedMap:s={}}=(o=await Ut(e))!=null?o:{},r=n.settings.commandPaletteMaxHistoryRetentionDays>0?se(t,(u,h)=>i-h>n.settings.commandPaletteMaxHistoryRetentionDays*24*60*60):t,a=n.settings.commandPaletteMaxHistoryRetentionDays>0?se(s,(u,h)=>r[h]==null):s,l=Kt().map(u=>({...u,lastUsed:r[u.id]}));new Be(n.app,l,r,a,e,n.settings).open()}function bs(n,i){return[{id:"header-search-in-file",name:"Header search in file",checkCallback:e=>{if(e)return!!n.workspace.getActiveFile();vs(n,i,!1)}},{id:"header-floating-search-in-file",name:"Header floating search in file",checkCallback:e=>{if(e)return!!n.workspace.getActiveFile();vs(n,i,!0)}},{id:"folder",name:"Reveal a folder in the file tree",hotkeys:[],callback:()=>{Ii(n,i)}},{id:"move",name:"Move file to another folder",hotkeys:[{modifiers:["Mod","Shift"],key:"m"}],checkCallback:e=>{if(e)return!!n.workspace.getActiveFile();Fi(n,i)}},{id:"grep",name:"Grep",hotkeys:[],checkCallback:e=>{if(e)return D.Platform.isDesktop;wt(n,i)}},{id:"backlink",name:"Backlink search",hotkeys:[],checkCallback:e=>{if(e)return!!n.workspace.getActiveFile();Ai(n,i)}},{id:"link",name:"Link search",hotkeys:[],checkCallback:e=>{if(e)return!!n.workspace.getActiveFile();Ti(n,i)}},{id:"in-file-search",name:"In file search",hotkeys:[],checkCallback:e=>{if(e)return!!n.workspace.getActiveFile();Pi(n,i)}},{id:"command-palette",name:"Command palette",hotkeys:[],callback:()=>{Di({app:n,settings:i})}},...i.searchCommands.map(e=>({id:`${Ci}_${e.name.replace(/ /g,"-").toLowerCase()}`,name:e.name,hotkeys:[],callback:()=>{_i(n,i,e)}}))]}var Je=class extends Es.Plugin{async onload(){if(this.appHelper=new x(this.app),await this.loadSettings(),this.addSettingTab(new Fe(this.app,this)),this.appHelper.isCacheInitialized())this.reloadCommands();else{let i=this.app.metadataCache.on("resolved",async()=>{this.reloadCommands(),this.app.metadataCache.offref(i)})}}reloadCommands(){let i=this.appHelper.getCommandIds(this.manifest.id);for(let t of i)this.appHelper.removeCommand(t);let e=bs(this.app,this.settings);for(let t of e)this.addCommand(t)}async loadSettings(){let i=await this.loadData();this.settings=bt.default.withOptions({mergeArrays:!1},ss,i!=null?i:{}),this.settings.searchCommands.forEach((s,r)=>{this.settings.searchCommands[r]=bt.default.withOptions({mergeArrays:!1},ft(),{...this.settings.searchCommands[r]}),this.settings.searchCommands[r].searchTarget==="markdown"&&(this.settings.searchCommands[r].searchTarget="file")});let e=mt(),t=Object.keys(e);for(let s of t){let r=Object.keys(this.settings.hotkeys[s]);for(let a of r)a in e[s]||delete this.settings.hotkeys[s][a]}}async saveSettings(){await this.saveData(this.settings)}};

/* nosourcemap */