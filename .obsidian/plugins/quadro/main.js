/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var K=Object.defineProperty;var Pe=Object.getOwnPropertyDescriptor;var Ne=Object.getOwnPropertyNames;var Me=Object.prototype.hasOwnProperty;var _e=(t,e)=>{for(var o in e)K(t,o,{get:e[o],enumerable:!0})},$e=(t,e,o,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ne(e))!Me.call(t,i)&&i!==o&&K(t,i,{get:()=>e[i],enumerable:!(n=Pe(e,i))||n.enumerable});return t};var Be=t=>$e(K({},"__esModule",{value:!0}),t);var Ye={};_e(Ye,{default:()=>q});module.exports=Be(Ye);var ke=require("obsidian");var I=require("obsidian");function Ue(t){return Math.ceil(Math.random()*10**t).toString().padStart(t,"0")}var We=/\^[\w-]+(?=\n|$)/g,X=/\^[\w-]+$/,ce=/^!\[\[(.+?)#(\^[\w-]+)\]\]$/;async function U(t,e){let[o]=e.match(X)||[];if(o){let s=e.slice(0,-o.length).trim();return{blockId:o,lineWithoutId:s}}let i=(await t.vault.cachedRead(t)).match(We)||[],r;do r="^id-"+Ue(6);while(i.includes(r));return{blockId:r,lineWithoutId:e.trim()}}var u="Codes",C="Extractions",W="Analysis",de={char:"\u{1FB0B}",charsPerBlock:100,maxLength:100},Ge={alphabeticalByCodeName:(t,e)=>t.basename.localeCompare(e.basename),alphabeticalByFullCode:(t,e)=>{let o=t.path.slice(u.length+1),n=e.path.slice(u.length+1);return o.localeCompare(n)},lastUsedFirst:(t,e)=>e.stat.mtime-t.stat.mtime,oldestUsedFirst:(t,e)=>t.stat.mtime-e.stat.mtime,frequentlyUsedFirst:(t,e)=>e.stat.size-t.stat.size,rarelyUsedFirst:(t,e)=>t.stat.size-e.stat.size,randomOrder:()=>Math.random()-.5},me=Ge.lastUsedFirst;var P=require("obsidian");function f(t,e){let o=e==="Codes"?u:C,n=t.workspace.getActiveFile();return n?!!n.path.startsWith(o+"/"):!1}function y(t){let e=t.workspace.getActiveViewOfType(P.MarkdownView);return e?e.editor:(new P.Notice("No active editor."),null)}var E=[{command:"\u2191\u2193",purpose:"Navigate"},{command:"\u23CE",purpose:"Select"},{command:"esc",purpose:"Dismiss"}];function G(t){let e=`.workspace-leaf.mod-active .metadata-property:first-of-type .metadata-property-${t} :is([contenteditable='true'], input)`,o=document.querySelector(e);o instanceof HTMLElement&&je(o,0),o instanceof HTMLInputElement&&o.select()}function je(t,e){if(t instanceof HTMLInputElement){t.focus();let o=t.getAttribute("type")==="number";o&&t.setAttribute("type","text"),t.setSelectionRange(e,e),o&&t.setAttribute("type","number")}else{let o=document.createRange(),n=window.getSelection();o.setStart(t,e),o.collapse(!0),n?.removeAllRanges(),n?.addRange(o)}}var Y={state:{source:!1,mode:"source"}};async function N(t,e){let o=t.workspace.getLeaf();await(t.workspace.getAdjacentLeafInDirection(o,"right")||t.workspace.createLeafBySplit(o,"vertical",!1)).openFile(e,Y)}function O(t){let e=t.getCursor("head").line!==t.getCursor("anchor").line,o=t.listSelections().length>1;return e||o?(new P.Notice(`Paragraph not unambiguous since multiple lines are selected.

Unselect, move your cursor to the paragraph you want to affect, and use the command again.`,5e3),!0):!1}function M(t){return t.path.slice(u.length+1,-3)}var p=require("obsidian");var J=class extends p.Modal{constructor(o,n){super(o);this.fullCode="";this.codeDesc="";this.confirmationButton=null;this.onSubmit=n,this.modalEl.addClass("quadro")}onOpen(){let{contentEl:o}=this;o.createEl("h4",{text:"New code creation"}),new p.Setting(o).setName("Name of the Code").setDesc('Use a slash ("/") in the name to create the Code File in a subfolder (group).').addText(n=>n.onChange(i=>{this.fullCode=i.trim(),this.confirmationButton?.setDisabled(this.fullCode==="")})),new p.Setting(o).setName("Code Description").setDesc('Will be added as metadata with the key "description".').addText(n=>n.onChange(i=>{this.codeDesc=i.trim()})),new p.Setting(o).addButton(n=>{this.confirmationButton=n.setButtonText("Create").setCta().setDisabled(!0).onClick(()=>{this.close(),this.onSubmit(this.fullCode,this.codeDesc)})}).addButton(n=>n.setButtonText("Cancel").onClick(()=>this.close()))}onClose(){let{contentEl:o}=this;o.empty()}},Q=class extends p.Modal{constructor(o,n){super(o);this.input="";this.confirmationButton=null;this.onSubmit=n,this.modalEl.addClass("quadro")}onOpen(){let{contentEl:o}=this;o.createEl("h4",{text:"Bulk-create new codes"}),o.createEl("p",{text:"Every line will result in a new code file."}),o.createEl("p",{text:'Use a slash ("/") in the name to create the Code File in a subfolder (group).'}),new p.Setting(o).setClass("quadro-bulk-code-creation").addTextArea(n=>n.onChange(i=>{this.input=i.trim(),this.confirmationButton?.setDisabled(this.input==="")})),new p.Setting(o).addButton(n=>{this.confirmationButton=n.setButtonText("Create").setCta().setDisabled(!0).onClick(()=>{this.close(),this.onSubmit(this.input)})}).addButton(n=>n.setButtonText("Cancel").onClick(()=>this.close()))}onClose(){let{contentEl:o}=this;o.empty()}};async function ue(t,e,o){e=e.replace(/\.md$/,"").replace(/[:#^?!"*<>|[\]\\]/g,"-").replace(/^\.|\/\./g,"");let n=(0,p.normalizePath)(`${u}/${e}.md`);if(t.vault.getAbstractFileByPath(n)instanceof p.TFile)return new p.Notice(`Code "${e}" already exists, Code File not created.`),!1;let r=e.split("/"),s=r.pop(),l=r.length?"/"+r.join("/"):"",a=u+l;t.vault.getFolderByPath(a)||await t.vault.createFolder(a),o=o.replaceAll('"',"'");let d=`---
description: "${o}"
---


---

`;return await t.vault.create(`${a}/${s}.md`,d)}function pe(t,e){new J(t,async(o,n)=>{let i=await ue(t,o,n);i?(new p.Notice(`Created new code file: "${o}"`),e(i)):new p.Notice("File creation failed.")}).open()}async function fe(t){new Q(t,async e=>{let o=0,n=[];for(let r of e.split(`
`))await ue(t,r,"")?o++:n.push(r);let i=`${o} file(s) created`;n.length>0&&(i+=`
Could not create: `+n.join(", ")),new p.Notice(i,(n.length+2)*1e3)}).open()}var Z=class extends I.FuzzySuggestModal{constructor(e,o,n,i){super(e),this.editor=o,this.codesInPara=n,this.dataFile=i,this.setPlaceholder("Select code to assign"),this.setInstructions([...E,{command:'type "new"',purpose:"Create new code"}]),this.modalEl.addClass("quadro")}getItems(){let e=this.app.vault.getMarkdownFiles().filter(o=>{let n=o.path.startsWith(u+"/"),i=this.codesInPara.find(r=>r.path===o.path);return n&&!i}).sort(me);return e.push("new-code-file"),e}getItemText(e){if(e==="new-code-file")return"\u{1F79C} Create new code";let{char:o,charsPerBlock:n,maxLength:i}=de,r="    "+o.repeat(Math.min(i,e.stat.size/n));return M(e)+r}onChooseItem(e){e instanceof I.TFile?this.assignCode(e,this.dataFile):pe(this.app,o=>this.assignCode(o,this.dataFile))}async assignCode(e,o){let n=this.editor.getCursor(),i=M(e),r=this.editor.getLine(n.line),s=this.editor.getSelection();if(s){let F=s.replace(/^( ?)(.+?)( ?)$/g,"$1==$2==$3");this.editor.replaceSelection(F),r=this.editor.getLine(n.line)}let{blockId:l,lineWithoutId:a}=await U(o,r),c=`${a} [[${i}]] ${l}`;this.editor.setLine(n.line,c),this.editor.setCursor(n);let m=`![[${o.path.slice(0,-3)}#${l}]]
`;await this.app.vault.append(e,m)}};function he(t){let e=y(t);if(!e||O(e))return;if(f(t,"Codes")||f(t,"Extractions")){new I.Notice("You must be in a Data File to assign a code.",3e3);return}if(e.getSelection().includes("==")){new I.Notice(`Selection contains highlights.
Overlapping highlights are not supported.`);return}let n=e.editorComponent.view.file,s=(e.getLine(e.getCursor().line).match(/\[\[.+?\]\]/g)||[]).reduce((l,a)=>{a=a.slice(2,-2);let c=t.metadataCache.getFirstLinkpathDest(a,n.path);return c?.path.startsWith(u+"/")&&l.push(c),l},[]);new Z(t,e,s,n).open()}var w=require("obsidian");var h=require("obsidian");var ee=class extends h.FuzzySuggestModal{constructor(e,o,n,i){super(e),this.codesInParagraph=i,this.dataFile=n,this.editor=o,this.setPlaceholder("Select code to remove from paragraph"),this.setInstructions(E),this.modalEl.addClass("quadro")}getItems(){return this.codesInParagraph}getItemText(e){return M(e.tFile)}onChooseItem(e){ge(this.editor,this.dataFile,e)}};async function te(t,e,o,n){let i=(await t.vault.read(o)).split(`
`),r=i.findIndex(c=>c.endsWith(n));if(r<0)return`Data File "${o.basename}", has no line with the ID "${n}".`;let s=i[r]||"",a=(s.match(/\[\[.+?\]\]/g)||[]).find(c=>{c=c.slice(2,-2);let d=t.metadataCache.getFirstLinkpathDest(c,o.path);return d instanceof h.TFile&&d.path===e.path});return a?(i[r]=s.replace(a,"").replace(/ {2,}/g," "),await t.vault.modify(o,i.join(`
`)),""):`Data File "${o.basename}", line "${n}" has no valid link to the Code File.`}async function ge(t,e,o){let n=t.editorComponent.app,i=t.getCursor().line,r=t.getLine(i),s=new RegExp(" ?\\[\\["+o.wikilink+"\\]\\]");t.setLine(i,r.replace(s,""));let[l]=r.match(X)||[];if(!l){new h.Notice(`No ID found in current line.
Reference in Code File thus not deleted.`);return}let a=(await n.vault.read(o.tFile)).split(`
`),c=a.findIndex(d=>{if(!d.includes(l))return!1;let m=d.match(/\[\[.+?\]\]/g)||[];for(let F of m){let b=F.slice(2,-2).split("#")[0]||"";if(n.metadataCache.getFirstLinkpathDest(b,o.tFile.path)?.path===e.path)return!0}return!1});if(c<0){new h.Notice(`"Code File "${o.tFile.basename}" contains not reference to Data File "${e.basename}" with the ID "${l}". Reference in Code File is thus not deleted.`,7e3);return}a.splice(c,1),await n.vault.modify(o.tFile,a.join(`
`)),new h.Notice(`Assignment of code "${o.tFile.basename}" removed.`)}async function ze(t,e){let o=e.getLine(e.getCursor().line),[n,i,r]=o.match(ce)||[],s=e.editorComponent.view.file,l=t.metadataCache.getFirstLinkpathDest(i||"",s.path);if(!r||!i||!l){new h.Notice("Current line has no correct reference.");return}let a=await te(t,s,l,r);if(a){new h.Notice(a+`

Aborting removal of Code.`,4e3);return}t.commands.executeCommandById("editor:delete-paragraph"),e.setCursor({line:e.getCursor().line,ch:0}),new h.Notice(`Assignment of code "${s.basename}" removed.`)}async function Ce(t){let e=y(t);if(!(!e||O(e)))if(f(t,"Codes"))ze(t,e);else{let o=e.editorComponent.view.file,r=(e.getLine(e.getCursor().line).match(/\[\[.+?\]\]/g)||[]).reduce((s,l)=>{l=l.slice(2,-2);let a=t.metadataCache.getFirstLinkpathDest(l,o.path);return a instanceof h.TFile&&a.path.startsWith(u+"/")&&s.push({tFile:a,wikilink:l}),s},[]);r.length===0?new h.Notice("Line does not contain any valid codes."):r.length===1?ge(e,o,r[0]):new ee(t,e,o,r).open()}}var oe=!1;async function Fe(t,e){if(!(e instanceof w.TFile)||!e.path.startsWith(u+"/")||oe)return;if(t.vault.config.trashOption!=="local"){let n=`\u26A0\uFE0F Code Files must be deleted via the "Delete Code Everywhere" command to ensure that references to it are correctly deleted as well. Alternatively, you can set the trash location to "local" in your Obsidian config to have Quadro automatically handle deletions.

Please restore the file and do one of the above to correctly remove the code.
(Click to dismiss.)`;new w.Notice(n,0);return}let o=".trash/"+e.name;if(!await t.vault.adapter.exists(o)){let n=`Could not remove references to the Code File.

Please restore the file and use the "Delete Code Everywhere" command.`;new w.Notice(n,8e3);return}await t.vault.adapter.rename(o,e.path),setTimeout(async()=>{oe=!0,await xe(t,e),oe=!1},1e3)}async function Te(t){let e=y(t);if(!e)return;if(!f(t,"Codes")){new w.Notice("Must be in Code File to delete the code everywhere.");return}let o=e.editorComponent.view.file;xe(t,o)}async function xe(t,e){let n=(t.metadataCache.getFileCache(e)?.embeds||[]).map(l=>l.link).reduce((l,a)=>{let[c,d]=a.split("#");if(!c||!d)return l;let m=t.metadataCache.getFirstLinkpathDest(c,e.path);return m instanceof w.TFile&&l.push({file:m,blockId:d}),l},[]),i=[];for(let{file:l,blockId:a}of n){let c=await te(t,e,l,a);c&&i.push(c)}await t.vault.trash(e,!0);let r=n.length-i.length,s=`Code File "${e.basename}" and ${r} references to it deleted.
`;i.length>0&&(s+=`
\u26A0\uFE0F ${i.length} references could not be deleted:
- `+i.join(`
- `)),new w.Notice(s,(5+i.length)*1700)}var ye=require("obsidian");function Ee(t){f(t,"Codes")?t.commands.executeCommandById("workspace:edit-file-title"):new ye.Notice("You must be in a code file.")}var we=[{id:"assign-code",name:"Assign code to paragraph",func:he,hotkeyLetter:"a",ribbonIcon:"plus-circle"},{id:"rename-code",name:"Rename code",func:Ee,hotkeyLetter:"r",ribbonIcon:"circle-slash"},{id:"unassign-code",name:"Delete code from paragraph",func:Ce,hotkeyLetter:"d",ribbonIcon:"minus-circle"},{id:"delete-code-everywhere",name:"Delete code file and all references to it",func:Te,ribbonIcon:"x-circle"},{id:"bulk-create-new-code-files",name:"Bulk create new code files",func:fe,ribbonIcon:"circle-dashed"}];var L=require("obsidian");var Ve="8.15.12",qe="200px",be={pluginVersion:Ve,model:{columns:[{id:"UUID",width:"50px",content:"Source",sortDir:"default",isVisible:!1,type:"source",numberPrefix:"",numberSuffix:"",numberSeparator:"",numberFormat:"number",currencyType:"USD",dateFormat:"mmddyyyy",dateFormatSeparator:"-",hour12:!1,includeTime:!1,shouldWrapOverflow:!1,tags:[],calculationType:"none",aspectRatio:"unset",horizontalPadding:"unset",verticalPadding:"unset",frontmatterKey:null},{id:"UUID",width:"40px",content:"Extraction File",sortDir:"default",isVisible:!0,type:"source-file",numberPrefix:"",numberSuffix:"",numberSeparator:"",numberFormat:"number",currencyType:"USD",dateFormat:"mmddyyyy",dateFormatSeparator:"-",hour12:!1,includeTime:!1,shouldWrapOverflow:!0,tags:[],calculationType:"count-all",aspectRatio:"unset",horizontalPadding:"unset",verticalPadding:"unset",frontmatterKey:null}],rows:[],filters:[{id:"UUID",columnId:"UUID",operator:"or",isEnabled:!0,type:"source-file",condition:"is-not",text:"Template"}],sources:[{id:"UUID",type:"folder",path:"PATH",includeSubfolders:!1}],settings:{numFrozenColumns:1,showCalculationRow:!1},externalRowOrder:[]}},ve={id:"UUID",type:"LOOM_TYPE",frontmatterKey:"DIMENSION",sortDir:"default",isVisible:!0,width:qe,numberPrefix:"",numberSuffix:"",numberSeparator:"",content:"",numberFormat:"number",currencyType:"USD",dateFormat:"mmddyyyy",dateFormatSeparator:"-",hour12:!1,includeTime:!1,shouldWrapOverflow:!0,tags:[],calculationType:"none",aspectRatio:"unset",horizontalPadding:"unset",verticalPadding:"unset"};var A=require("obsidian");function j(t,e){let o=t.vault.getFileByPath(`${e.path}/Template.md`);if(!o){new A.Notice(`ERROR: Could not find "Template.md" for Extraction Type "${e.name}".`,5e3);return}let n=t.metadataCache.getFileCache(o)?.frontmatter;if(!n){new A.Notice(`ERROR: Properties of "Template.md" for Extraction Type "${e.name}" are invalid.`,5e3);return}return n}function z(t){let e=t.vault.getFolderByPath(C);if(!e){new A.Notice("ERROR: Could not find Extraction Folder.",4e3);return}let o=e.children.filter(n=>n instanceof A.TFolder);if(o.length===0){new A.Notice("ERROR: Could not find any Extraction Types.",4e3);return}return o}function He(t,e){let o={text:"text",date:"date",number:"number",datetime:"date",checkbox:"checkbox",multitext:"multi-tag"},n=t.metadataTypeManager.getPropertyInfo(e.toLowerCase())?.type;return o[n]||"text"}var ne=class extends L.FuzzySuggestModal{constructor(e,o){super(e),this.extractionTypes=o,this.setPlaceholder("Select extraction type to create aggregation for"),this.setInstructions(E),this.modalEl.addClass("quadro")}getItems(){return this.extractionTypes}getItemText(e){let o=e.children.length-1;return`${e.name} (${o})`}async onChooseItem(e){let o=j(this.app,e);if(!o)return;let n=[...Object.keys(o),"extraction source","extraction date"],i=structuredClone(be);if(!i.model?.filters[0]||!i.model?.sources[0]||!i.model?.columns[0]||!i.model?.columns[1]){new L.Notice("ERROR: Loom Template invalid.",4e3);return}i.model.sources[0].path=e.path,i.model.sources[0].id=crypto.randomUUID(),i.model.filters[0].id=crypto.randomUUID(),i.model.columns[0].id=crypto.randomUUID();let r=crypto.randomUUID();i.model.filters[0].columnId=r,i.model.columns[1].id=r;for(let d of n){let m=structuredClone(ve);m.id=crypto.randomUUID(),m.frontmatterKey=d,m.content=d,m.type=He(this.app,d),i.model.columns.push(m)}let s=this.app.vault.getFolderByPath(W);if(s||(s=await this.app.vault.createFolder(W)),!s){new L.Notice("ERROR: Could not create Analysis Folder.",4e3);return}let l=e.name,a;for(;a=`${W}/${l} (Aggregation).loom`,!!this.app.vault.getFileByPath(a);)l+="_1";let c=await this.app.vault.create(a,JSON.stringify(i));await this.app.workspace.getLeaf().openFile(c,Y),this.app.commands.executeCommandById("file-explorer:reveal-active-file")}};async function Ie(t){if(![...t.plugins.enabledPlugins].includes("notion-like-tables")){if(!Object.keys(t.plugins.plugins).includes("notion-like-tables")){new L.Notice(`Plugin "DataLoom" not installed.

Please install it from the Obsidian Community Store.`,7e3);return}if(!await t.plugins.enablePluginAndSave("dataview")){new L.Notice("ERROR: DataLoom plugin could not be enabled.",4e3);return}}let o=z(t);o&&new ne(t,o).open()}var g=require("obsidian");var ie=class extends g.Modal{constructor(o,n){super(o);this.nameOfNewType="";this.confirmationButton=null;this.onSubmit=n,this.modalEl.addClass("quadro")}onOpen(){let{contentEl:o}=this;o.createEl("h4",{text:"New Extraction Type"}),new g.Setting(o).setName("Name of the new type").addText(n=>n.onChange(i=>{this.nameOfNewType=i.trim(),this.confirmationButton?.setDisabled(this.nameOfNewType==="")})),new g.Setting(o).addButton(n=>{this.confirmationButton=n.setButtonText("Create").setCta().setDisabled(!0).onClick(()=>{this.close(),this.onSubmit(this.nameOfNewType)})}).addButton(n=>n.setButtonText("Cancel").onClick(()=>this.close()))}onClose(){let{contentEl:o}=this;o.empty()}};function re(t){new ie(t,async e=>{e=e.replace(/\.md$/,"").replaceAll("/","_").replace(/[:#^?!"*<>|[\]\\]/g,"-").replace(/^\./,"");let o=(0,g.normalizePath)(C+"/"+e);if(!(await t.vault.createFolder(o)instanceof g.TFolder)){new g.Notice("ERROR: Could not create Extraction Type Folder.",3e3);return}ae(t,e)}).open()}async function ae(t,e){new g.Notice(`Creating New Template for Extraction Type "${e}"`,6e3);let o=(0,g.normalizePath)(`${C}/${e}/Template.md`),n=`---
dimension: 
---

`,i=["> [!NOTE] ",'Due to a bug in DataLoom, properties of the type "List" must not have a space in them. You can work around that issue by using underscros or hyphens instead of a space.',"See <https://github.com/trey-wallis/obsidian-dataloom/issues/932>"].join(`
`),r=await t.vault.create(o,n+i);await N(t,r),t.commands.executeCommandById("file-explorer:reveal-active-file"),G("key")}function Ae(t){re(t)}var S=require("obsidian");var Ke=",",Xe="-",se="CSV Export";function Le(t){return t.map(o=>`"${o.replaceAll('"','""')}"`).join(Ke)}async function De(t){let e=z(t);if(!e)return;let o;for(let n of e){let i=[],r=j(t,n);if(!r){new S.Notice(`Export of Extraction Type "${n.name}" is skipped.`,5e3);continue}let s=["File",...Object.keys(r),"extraction date","extraction source"],l=Le(s);i.push(l);let a=n.children.filter(x=>x instanceof S.TFile&&x.name!=="Template.md");for(let x of a){let _=t.metadataCache.getFileCache(x)?.frontmatter;if(!_)continue;let $=[];for(let R of s){if(R==="File"){$.push(x.basename);continue}let v=_[R]??Xe,k=typeof v!="object"?v.toString():Array.isArray(v)?v.join("; "):JSON.stringify(v);R==="extraction source"&&(k=k.slice(2,-2)),$.push(k)}let H=Le($);i.push(H)}t.vault.getFolderByPath(se)||await t.vault.createFolder(se);let d=i.join(`
`),m,F=n.name;for(;m=`${se}/${F}.csv`,!!t.vault.getFileByPath(m);)F+="_1";let b=await t.vault.create(m,d),D=b?`Successfully exported "${n.name}".`:`ERROR: Export for "${n.name}" failed.`;new S.Notice(D,5e3),!o&&b&&(o=b)}new S.Notice("All CSV exports finished.",5e3),o&&t.showInFolder(o.path)}var T=require("obsidian");var le=class extends T.FuzzySuggestModal{constructor(e,o,n,i){super(e),this.extractionTypes=n,this.editor=o,this.dataFile=i,this.setPlaceholder("Select extraction type"),this.setInstructions(E),this.modalEl.addClass("quadro")}getItems(){return this.extractionTypes}getItemText(e){let o=e.children.find(r=>r instanceof T.TFile&&r.name==="Template.md"),n=e.children.length-1,i=o?`  (${n})`:'  [Select to create "Template.md"]';return e.name+i}onChooseItem(e){Oe(this.editor,this.dataFile,e)}};async function Oe(t,e,o){let n=t.editorComponent.app,i=o.name,r=o.path,s=n.vault.getFileByPath(`${r}/Template.md`);if(!s){ae(n,i);return}let a=(await n.vault.cachedRead(s)).trim().split(`
`);if(!(a.filter(B=>B==="---").length===2)){new T.Notice(`The file "Template.md" in the folder "${r}" does not contain valid metadata fields.

You need to add valid fields before you can make extractions.`,6e3),N(n,s);return}let d,m=o.children.length-1;for(;m++,d=`${r}/${m}.md`,!!n.vault.getFileByPath(d););let F=t.getCursor(),b=t.getLine(F.line),{blockId:D,lineWithoutId:x}=await U(e,b),_=`${x} [[${i}/${m}]] ${D}`;t.setLine(F.line,_),t.setCursor(F);let H=`extraction date: ${new Date().toISOString().slice(0,-5)}`,R=`extraction source: "[[${e.path}#${D}]]"`,v=a.findLastIndex(B=>B==="---");a.splice(v,0,H,R),a.push("",`**Paragraph extracted from:** ![[${e.path}#${D}]]`);let k=await n.vault.create(d,a.join(`
`));await N(n,k),G("value")}async function Se(t){let e=y(t);if(!e||O(e))return;if(f(t,"Codes")||f(t,"Extractions")){new T.Notice("You must be in a Data File to make an extraction.",3e3);return}let o=t.vault.getFolderByPath(C);if(o||(o=await t.vault.createFolder(C)),!o){new T.Notice("ERROR: Could not create Extraction Folder.",4e3);return}let n=o.children.filter(r=>r instanceof T.TFolder),i=e.editorComponent.view.file;n.length===0?re(t):n.length===1&&n[0]?Oe(e,i,n[0]):new le(t,e,n,i).open()}var Re=[{id:"extract-from-paragraph",name:"Extract from paragraph",func:Se,hotkeyLetter:"e",ribbonIcon:"plus-square"},{id:"create-new-extraction-type",name:"Create new extraction type",func:Ae,ribbonIcon:"box-select"},{id:"aggregate-extractions",name:"Aggregate extractions",func:Ie,ribbonIcon:"sigma-square"},{id:"export-all-extractions-as-csv",name:"Export all extractions as .csv",func:De,ribbonIcon:"arrow-up-square"}];function V(t,e){let o=t.workspace.getActiveFile();if(!o){e.setText("");return}let n=[],i=t.metadataCache.resolvedLinks[o.path]||{};if(f(t,"Codes")){let a=0;for(let[c,d]of Object.entries(i))a+=d;n.push(`Code ${a}x assigned`)}else if(f(t,"Extractions")){let c=o.parent.children.length-1;n.push(`${c}x extracted`)}else{let a=0,c=0;for(let[d,m]of Object.entries(i))d.startsWith(u+"/")&&(a+=m),d.startsWith(C+"/")&&c++;a>0&&n.push(`${a} Codes`),c>0&&n.push(`${c} Extractions`)}let r=t.metadataCache.unresolvedLinks[o.path]||{},s=0;for(let[a,c]of Object.entries(r))s+=c;s>0&&n.push(`${s} invalid links`);let l=n.map(a=>a.replace(/^(1 .*)s$/,"$1")).join(", ");e.setText(l)}var q=class extends ke.Plugin{constructor(){super(...arguments);this.statusbar=this.addStatusBarItem()}onload(){console.info(this.manifest.name+" Plugin loaded.");for(let o of[...we,...Re]){this.addRibbonIcon(o.ribbonIcon,`Quadro: ${o.name}`,()=>o.func(this.app));let n={id:o.id,name:o.name,editorCallback:()=>o.func(this.app)};o.hotkeyLetter&&(n.hotkeys=[{modifiers:["Mod","Shift"],key:o.hotkeyLetter}]),this.addCommand(n)}V(this.app,this.statusbar),this.registerEvent(this.app.workspace.on("file-open",()=>V(this.app,this.statusbar))),this.registerEvent(this.app.metadataCache.on("resolved",()=>V(this.app,this.statusbar))),this.registerEvent(this.app.vault.on("delete",o=>Fe(this.app,o)))}onunload(){console.info(this.manifest.name+" Plugin unloaded.")}};
